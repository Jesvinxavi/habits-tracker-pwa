const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CWk_d2Bu.js","assets/vendor-DbHZnqlu.js","assets/index-COOhAAvL.css","assets/manage-DOS3jjNQ.js"])))=>i.map(i=>d[i]);
import{_}from"./vendor-DbHZnqlu.js";import{j as Q,g as d,b as se,k as q,l as E,A as S,n as pe,o as ue,u as he,p as ge,q as D,t as $,v as G,w as me,x as ye,y as fe,s as be}from"./index-CWk_d2Bu.js";const Z={daily:"today",weekly:"view_week",monthly:"date_range",yearly:"event"},j={mount(e,t={}){this.container=e,this.callbacks=t,this._createHeader(),this._bindEvents()},_createHeader(){this.titleContainer=this.container,this.headerEl=this.container.closest(".habits-header"),this._buildGroupPill(),this._buildHolidayToggle()},_buildGroupPill(){if(!this.titleContainer||this.titleContainer.querySelector("#group-pill"))return;this.titleContainer.innerHTML="";const e=document.createElement("div");e.id="group-pill",e.className="flex items-center gap-2 px-4 py-1.5 bg-blue-50 dark:bg-gray-800 rounded-full cursor-pointer select-none w-full justify-center text-lg font-bold home-inset",this.titleContainer.style.display="flex",this.titleContainer.style.justifyContent="center",e.innerHTML=`
      <span id="group-icon" class="material-icons text-xl">${Z[d().selectedGroup]}</span>
      <span id="group-title" class="text-xl font-bold">${Q(d().selectedGroup)} Habits</span>
    `,this.titleContainer.appendChild(e),this.headerEl&&(this.headerEl.style.paddingBottom="8px")},_buildHolidayToggle(){if(!this.headerEl)return;this.headerEl.classList.add("justify-between");let e=document.getElementById("holiday-toggle");e||(e=document.createElement("button"),e.id="holiday-toggle",e.className="relative flex items-center justify-center h-9 bg-gray-200 text-gray-500 rounded-full overflow-hidden select-none mr-4",e.style.width="36px",e.innerHTML='<span class="plane material-icons absolute left-2 top-1/2 -translate-y-1/2 transition-transform text-2xl">flight</span><span class="label whitespace-nowrap ml-1 text-sm font-medium opacity-0 transition-opacity">Holiday Mode</span>',this.headerEl.appendChild(e)),this._updateHolidayToggle()},_updateHolidayToggle(){const e=document.getElementById("holiday-toggle");e&&_(async()=>{const{isHoliday:t}=await import("./index-CWk_d2Bu.js").then(s=>s.Q);return{isHoliday:t}},__vite__mapDeps([0,1,2])).then(({isHoliday:t})=>{if((d().selectedGroup||"daily")!=="daily"){e.style.display="none";return}e.style.display="";const n=q(new Date(d().selectedDate)),o=t(n);e.classList.toggle("bg-ios-orange",o),e.classList.toggle("bg-gray-200",!o),e.classList.toggle("text-white",o),e.classList.toggle("text-gray-500",!o);const i=e.querySelector(".plane"),a=e.querySelector(".label");i&&(o?(i.style.left="8px",i.style.transform="translateY(-50%) rotate(-90deg)"):(i.style.left="50%",i.style.transform="translate(-50%, -50%) rotate(-90deg)")),a&&(o?(a.classList.add("opacity-100"),e.classList.add("pl-9","pr-4"),e.classList.remove("justify-center"),e.style.width="140px"):(a.classList.remove("opacity-100"),e.classList.remove("pl-9","pr-4"),e.classList.add("justify-center"),e.style.width="36px"))})},_bindEvents(){const e=document.getElementById("holiday-toggle");e&&e.addEventListener("click",this._handleHolidayToggle.bind(this));const t=document.getElementById("group-pill");t&&this._bindGroupPillEvents(t)},_handleHolidayToggle(){const e=q(new Date(d().selectedDate));Promise.all([_(()=>import("./index-CWk_d2Bu.js").then(t=>t.Q),__vite__mapDeps([0,1,2])),_(()=>import("./index-CWk_d2Bu.js").then(t=>t.S),__vite__mapDeps([0,1,2]))]).then(([t,{showConfirm:s}])=>{const{toggleSingleHoliday:n}=t;if(d().holidayPeriods.some(i=>e>=i.startISO&&e<=i.endISO)){s({title:"Managed by Holiday Period",message:"This date is set as a holiday through a holiday period. Please edit using the Holiday Period manager.",okText:"OK",cancelText:"",onOK:()=>{}});return}n(e),this.callbacks.onHolidayToggle&&this.callbacks.onHolidayToggle(!0)})},_bindGroupPillEvents(e){let t=0,s=!1,n=!1,o=!1;const i=l=>{l.target.tagName!=="BUTTON"&&(t=l.touches?l.touches[0].clientX:l.clientX,s=!0,n=!1,o=!0)},a=l=>{if(!s||!o)return;const m=l.touches?l.touches[0].clientX:l.clientX;Math.abs(m-t)>5&&(n=!0,l.preventDefault())},r=async l=>{if(!s)return;const p=(l.changedTouches?l.changedTouches[0].clientX:l.clientX)-t;if(n&&Math.abs(p)>=40){const v=p<0?1:-1,u=this._findNextGroupWithHabits(d().selectedGroup,v);E(S.setSelectedGroup(u));const c=new Date;let k;switch(u){case"weekly":{const w=(c.getDay()+6)%7;k=new Date(c),k.setDate(c.getDate()-w),k.setHours(0,0,0,0);break}case"monthly":{k=new Date(c.getFullYear(),c.getMonth(),1),k.setHours(0,0,0,0);break}case"yearly":{k=new Date(c.getFullYear(),0,1),k.setHours(0,0,0,0);break}case"daily":default:{k=new Date(c),k.setHours(0,0,0,0);break}}const{getLocalMidnightISOString:C}=await _(async()=>{const{getLocalMidnightISOString:H}=await import("./index-CWk_d2Bu.js").then(w=>w.O);return{getLocalMidnightISOString:H}},__vite__mapDeps([0,1,2]));E(S.setSelectedDate(C(k))),this.callbacks.onGroupChange&&this.callbacks.onGroupChange(u)}s=!1,n=!1,o=!1};e.addEventListener("touchstart",i,{passive:!0}),e.addEventListener("touchmove",a,{passive:!1}),e.addEventListener("touchend",r,{passive:!0}),e.addEventListener("mousedown",i),e.addEventListener("mousemove",a),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",r)},_findNextGroupWithHabits(e,t){const s=["daily","weekly","monthly","yearly"],n=s.indexOf(e);for(let o=1;o<=s.length;o++){const i=(n+t*o+s.length)%s.length,a=s[i];if(a==="daily"?!0:d().habits.some(l=>se(l,a)&&!l.paused))return a}return e},render(){this._updateGroupPill(),this._updateHolidayToggle()},_updateGroupPill(){const e=document.getElementById("group-title"),t=document.getElementById("group-icon");e&&(e.textContent=`${Q(d().selectedGroup)} Habits`),t&&(t.classList.add("material-icons"),t.textContent=Z[d().selectedGroup])},unmount(){const e=document.getElementById("holiday-toggle");e&&e.removeEventListener("click",this._handleHolidayToggle),this.container&&(this.container.innerHTML="")}},W={mount(e,t={}){this.container=e,this.callbacks=t,e.innerHTML="";const s=document.createElement("hh-calendar");return s.setAttribute("state-key","selectedDate"),s.addEventListener("select",n=>{this.callbacks.onDateChange&&this.callbacks.onDateChange(n.detail.date)}),e.appendChild(s),this.calendarEl=s,pe(s),s},render(){var e,t;(t=(e=this.calendarEl)==null?void 0:e.refresh)==null||t.call(e),this._updateSelectedDay()},_updateSelectedDay(){this.calendarEl&&_(async()=>{const{isSameDay:e}=await import("./index-CWk_d2Bu.js").then(t=>t.O);return{isSameDay:e}},__vite__mapDeps([0,1,2])).then(({isSameDay:e})=>{_(async()=>{const{getState:t}=await import("./index-CWk_d2Bu.js").then(s=>s.P);return{getState:t}},__vite__mapDeps([0,1,2])).then(({getState:t})=>{this.calendarEl.querySelectorAll(".day-item").forEach(n=>{const o=e(new Date(n.dataset.date),new Date(t().selectedDate));n.classList.toggle("current-day",o);const i=e(new Date(n.dataset.date),new Date);n.classList.toggle("today",i&&!o)}),this.calendarEl.scrollToSelected&&setTimeout(()=>{this.calendarEl.scrollToSelected()},10)})})},unmount(){this.container&&(this.container.innerHTML=""),this.calendarEl=null}},X={mount(e){this.container=e,this.render()},render(){const e=ue();he(e),ge()},unmount(){}};function ve(e,t){const s=["health","productivity","learning","social","finance","spiritual"],n=s.indexOf(e);let o=n;for(let i=1;i<=6;i++){o=(n+t*i+s.length)%s.length;const a=s[o];if(d().habits.some(l=>se(l,a)))return a}return e}let b={Completed:!0,Skipped:!0};try{const e=localStorage.getItem("homeSectionVisibility");e&&(b={...b,...JSON.parse(e)})}catch(e){console.warn("Failed to load section visibility:",e)}function ee(e,t){b.Completed=e,b.Skipped=t}const{belongsToSelectedGroup:Ce,isHabitScheduledOnDate:xe,isHabitCompleted:P,isHabitSkippedToday:B}=me,z={Completed:!1,Skipped:!1},T={test(){return!0},mount(e,t={}){this.container=e,this.callbacks=t,this.isInEditMode=!1,this._createContainer(),this.render()},_createContainer(){this.container&&(this.container.classList.remove("bg-white","dark:bg-gray-800","shadow-ios","rounded-2xl"),this.container.style.background="transparent",this.container.style.boxShadow="none",this.container.style.borderRadius="0"),this.container.querySelectorAll(".habit-card").forEach(e=>e.remove())},render(){if(!this.container)return;this.container.innerHTML="";const e=new Date(d().selectedDate),t=d().selectedGroup,s=d().habits.filter(c=>Ce(c,t)&&xe(c,e));if(s.length===0){this._renderEmptyPlaceholder(t);return}const n=s.filter(c=>!P(c,e)&&B(c,e)),o=s.filter(c=>!P(c,e)&&!B(c,e)),i=o.filter(c=>!c.scheduledTime),a=o.filter(c=>c.scheduledTime),r=s.filter(c=>P(c,e)),l=document.createDocumentFragment(),m=this._buildSection("Anytime",i),p=this._buildSection("Scheduled",a),v=this._buildSection("Completed",r),u=this._buildSection("Skipped",n);m&&l.appendChild(m),p&&l.appendChild(p),v&&l.appendChild(v),u&&l.appendChild(u),this.container.appendChild(l),this._adjustContainerHeight()},_adjustContainerHeight(){if(typeof window>"u")return;const e=this.container.getBoundingClientRect();let t=0;const s=this.container.closest(".content-area");if(s){const o=window.getComputedStyle(s);t=parseFloat(o.paddingBottom)||0}const n=window.innerHeight-e.top-t;n>0&&(this.container.style.maxHeight=n+"px",this.container.style.overflowY="auto")},_renderEmptyPlaceholder(e){const t=document.createElement("div");t.className="empty-placeholder flex flex-col items-center justify-center py-10 mt-6 text-gray-400";const n={daily:"No Scheduled Habits Today",weekly:"No Scheduled Habits This Week",monthly:"No Scheduled Habits This Month",yearly:"No Scheduled Habits This Year"}[e]||"No Scheduled Habits";t.innerHTML=`
      <div class="w-[4.5rem] h-[4.5rem] rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4">
        <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24">
          <path d="M9 17l-4-4 1.41-1.41L9 14.17l8.59-8.59L19 7l-10 10z"/>
        </svg>
      </div>
      <p class="text-lg font-medium">${n}</p>`,this.container.appendChild(t)},_buildSection(e,t){if(e==="Completed"&&!b.Completed||e==="Skipped"&&!b.Skipped)return null;const s=document.createElement("div"),n=e==="Completed"||e==="Skipped";s.className="habits-section"+(n?" collapsible":""),n&&(s.id=e.toLowerCase()+"-section"),s.style.paddingTop="0.5rem",s.style.paddingBottom="0.5rem";let o=`<h3 class="section-label text-base font-semibold m-0">${e}${n?` <span class="opacity-60">(${t.length})</span>`:""}</h3>`;if(n){const i=z[e]||!1;o+=`<button class="toggle-section flex items-center gap-1 text-sm font-medium select-none ml-auto self-start p-0 bg-none border-none outline-none cursor-pointer" style="user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;"><span style="user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;">${i?"Show":"Hide"}</span><svg class="w-4 h-4 transition-transform duration-200" viewBox="0 0 24 24" stroke="currentColor" fill="none" ${i?"transform rotate-180":""}>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>`}if(s.innerHTML=`<div class="section-header flex items-center mb-0.5 home-inset">${o}</div>`,t.length===0)return null;if(n&&z[e]&&s.classList.add("collapsed"),t.forEach(i=>{const a=this._buildHabitCard(i);if(a){const r=new Date(d().selectedDate);let l=a;P(i,r)||B(i,r)?l=this._createSwipeToRestoreContainer(a,i):l=this._createSwipeToSkipContainer(a,i),s.appendChild(l)}}),n){const i=s.querySelector(".toggle-section");i&&i.addEventListener("click",a=>{a.stopPropagation();const r=s.classList.toggle("collapsed");z[e]=r;const l=i.querySelector("svg");l&&(l.style.transform=r?"rotate(180deg)":"rotate(0deg)");const m=i.querySelector("span");m&&(m.textContent=r?"Show":"Hide")})}return s},_buildHabitCard(e){const t=new Date(d().selectedDate),s=typeof e.target=="number"&&e.target>0,n=d().categories.find(v=>v.id===e.categoryId)||{color:"#888",name:""},o=document.createElement("div");o.className="habit-card flex items-center px-4 py-2 rounded-xl",o.style.marginBottom="0.25rem",o.dataset.habitId=e.id,o.style.width="100%";const i=D(e,t);let a=s&&e.progress&&e.progress[i]||0;const r=`<div class="habit-icon w-9 h-9 flex-shrink-0 rounded-full flex items-center justify-center mr-1 text-xl" style="border:2px solid ${n.color}; color:${n.color}">${e.icon||"📋"}</div>`;let l=`<div class="habit-content flex-grow">
        <div class="habit-name font-semibold leading-tight">${e.name}</div>`;l+=`<span class="category-pill inline-block whitespace-nowrap px-2 py-0.5 rounded-lg text-xs font-medium mt-0" style="display:inline-block;width:max-content;background:${n.color};color:#fff;border-radius:8px;">${n.name||""}</span>`;let m="",p=null;if(s){o.style.position="relative";const v=C=>{o.style.background=fe(n.color,C)};v(e.target?Math.min(a/e.target,1):0);const u=document.createElement("div");u.className="progress-box px-2 py-0.5 text-xs font-bold rounded-md mb-1",u.style.border=`1px solid ${n.color}`,u.style.color="#000",u.style.background="#FFFFFF",u.textContent=`${a}/${e.target}`;const c=e.targetUnit&&e.targetUnit!=="none"?e.targetUnit:null;if(p=document.createElement("div"),p.className="ml-auto flex flex-col items-end",p.style.position="relative",p.style.zIndex="1",p.appendChild(u),c){const C=document.createElement("span");C.className="unit-pill whitespace-nowrap px-2 py-0.5 rounded-lg text-xs font-medium",C.style.background=`${n.color}`,C.style.color="#fff",C.textContent=c,p.appendChild(C)}const k=()=>{if(o.dataset.editing==="1")return;o.dataset.editing="1",this.isInEditMode=!0;const C=o.querySelector(".habit-content");C&&(C.style.display="none"),p.style.display="none";const H=document.createElement("div");H.className="edit-controls flex items-center gap-2 mx-auto",H.style.transform="translateX(-28px)";const w=document.createElement("button");w.className="minus-edit rounded-full flex items-center justify-center font-extrabold text-white border-2 border-black",w.style.background="#DC2626",w.style.fontSize="1.8rem",w.style.width="44px",w.style.height="44px",w.textContent="−";let I=e.defaultIncrement||1;const h=document.createElement("div");h.className="value-box px-4 border-2 border-black bg-white text-xl font-bold rounded-lg cursor-pointer select-none flex items-center justify-center",h.textContent=a,h.style.height="44px";const V=(y=>{const f=document.createElement("span");f.style.visibility="hidden",f.style.font="inherit",f.textContent=y,document.body.appendChild(f);const g=f.getBoundingClientRect().width;return f.remove(),g})("88")+16;let M=V;h.style.minWidth=M+"px",h.classList.add("text-center","font-mono"),h.onclick=y=>{if(y.stopPropagation(),h.querySelector("input"))return;M=h.getBoundingClientRect().width,h.style.width=M+"px",h.style.minWidth=M+"px";const g=document.createElement("input");g.type="text",g.inputMode="numeric",g.pattern="[0-9]*",g.className="w-full text-center outline-none",g.placeholder=a,g.style.MozAppearance="textfield",g.style.WebkitAppearance="none",g.style.appearance="textfield",g.style.border="none",g.style.background="transparent",h.textContent="",h.appendChild(g),g.focus(),I=0;const J=()=>{const x=parseInt(g.value,10);!isNaN(x)&&x>0?I=x:I=e.defaultIncrement||1,h.textContent=a};g.addEventListener("keydown",x=>{x.key==="Enter"&&J()}),g.addEventListener("blur",J);const ae=()=>{const x=document.createElement("span");x.style.visibility="hidden",x.style.position="absolute",x.style.whiteSpace="pre",x.style.font=getComputedStyle(g).font,x.textContent=g.value||"0",document.body.appendChild(x);const le=x.getBoundingClientRect().width;x.remove();const N=getComputedStyle(h),re=parseFloat(N.paddingLeft)+parseFloat(N.paddingRight),de=parseFloat(N.borderLeftWidth)+parseFloat(N.borderRightWidth),ce=Math.max(V,le+re+de+4);h.style.width=ce+"px"};g.addEventListener("input",()=>requestAnimationFrame(ae))};const L=document.createElement("button");L.className="plus-edit rounded-full flex items-center justify-center font-extrabold text-white border-2 border-black",L.style.background="#16A34A",L.style.fontSize="1.8rem",L.style.width="44px",L.style.height="44px",L.textContent="+";const A=document.createElement("button");A.className="confirm-edit w-8 h-8 rounded-full flex items-center justify-center text-white border-2 border-black absolute right-0",A.style.background="#16A34A",A.textContent="✔",H.appendChild(w),H.appendChild(h),H.appendChild(L);const F=document.createElement("div");F.className="flex items-center relative w-full",F.appendChild(H),F.appendChild(A),o.appendChild(F);const ie=y=>{h.textContent=y,u.textContent=`${y}/${e.target}`;const f=h.scrollWidth+1;f>M&&(M=f,h.style.minWidth=M+"px");const g=e.target?Math.min(y/e.target,1):0;v(g)},Y=y=>{if(I===0)return;const f=y*I;a+=f,a<0&&(a=0),a>e.target&&(a=e.target),ie(a),this._adjustProgress(e.id,e.target,f),I=e.defaultIncrement||1};L.addEventListener("click",y=>{y.stopPropagation(),Y(1)}),w.addEventListener("click",y=>{y.stopPropagation(),Y(-1)}),A.addEventListener("click",y=>{y.stopPropagation(),o.dataset.editing="0",this.isInEditMode=!1,F.remove();const f=o.querySelector(".habit-content");f&&(f.style.display=""),p.style.display="",E(S.setHabitProgress(e.id,i,a)),e.target&&a>=e.target&&E(S.toggleHabitCompleted(e.id,D(e,t))),this.callbacks.onHabitComplete&&this.callbacks.onHabitComplete(e.id,a>=e.target)});const K=h.offsetHeight,U=K+"px";[w,L].forEach(y=>{y.style.width=U,y.style.height=U,y.style.fontSize=K*.6+"px"}),h.style.pointerEvents="auto",h.style.zIndex="5"};p.addEventListener("click",C=>{C.stopPropagation(),k()})}else{const v=P(e,t)?"✔️":"";let u="";e.scheduledTime&&(u=`<span class="time-pill whitespace-nowrap px-3 py-1 rounded-lg text-sm font-semibold mr-1" style="background:${n.color}; color:#fff;border-radius:8px;font-size:0.875rem;">${e.scheduledTime}</span>`),m=`<div class="ml-auto flex items-center gap-1">${u}<button class="complete-toggle w-8 h-8 rounded-full flex items-center justify-center" style="border:2px solid ${n.color}; color:${n.color}">${v}</button></div>`}if(l+="</div>",o.innerHTML=r+l+m,p&&o.appendChild(p),s||(o.style.background=ye(n.color,.07)),o.style.border=`3px solid ${n.color}`,!s){const v=o.querySelector(".complete-toggle");v&&v.addEventListener("click",u=>{u.stopPropagation(),E(S.toggleHabitCompleted(e.id,D(e,t))),G(),this.callbacks.onHabitComplete&&this.callbacks.onHabitComplete(e.id,!P(e,t))})}return P(e,t)?this._applyCompletedStyling(o,e):B(e,t)&&this._applySkippedStyling(o,e),o},_applyCompletedStyling(e,t){e.style.border="3px solid #4B5563",e.style.background="#F3F4F6";const s=e.querySelector(".category-pill");s&&(s.style.background="#9CA3AF",s.style.color="#fff"),e.querySelectorAll(".ml-auto, .habit-counter, .target-pill, .complete-toggle, .time-pill, .progress-box").forEach(i=>i.remove());const n=document.createElement("div");n.className="completed-pill flex items-center gap-1 px-3 py-1 rounded-lg",n.style.border="2px solid #16A34A",n.style.background="#DCFCE7",n.style.color="#16A34A",n.innerHTML='<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9 16.2l-3.5-3.5 1.42-1.42L9 13.34 17.59 4.75 19 6.17z"/></svg><span class="text-sm font-semibold">Completed</span>',e.appendChild(n);const o=e.querySelector(".habit-icon");o&&(o.style.border="2px solid #9CA3AF",o.style.color="#9CA3AF")},_applySkippedStyling(e,t){e.style.border="3px solid #4B5563",e.style.background="#F3F4F6";const s=e.querySelector(".habit-icon");s&&(s.style.border="2px solid #9CA3AF",s.style.color="#9CA3AF");const n=e.querySelector(".category-pill");n&&(n.style.background="#9CA3AF",n.style.color="#fff"),e.querySelectorAll(".ml-auto, .habit-counter, .target-pill, .complete-toggle, .time-pill, .progress-box").forEach(i=>i.remove());const o=document.createElement("div");o.className="skipped-pill flex items-center gap-1 px-3 py-1 rounded-lg",o.style.border="2px solid #F97316",o.style.background="#FFEDD5",o.style.color="#F97316",o.innerHTML='<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/></svg><span class="text-sm font-semibold">Skipped</span>',e.appendChild(o)},_createSwipeToRestoreContainer(e,t){const s=document.createElement("div");s.className="swipe-container relative overflow-visible home-inset";const n=document.createElement("button");n.className="restore-btn absolute top-0 right-0 h-full",n.style.width="20%",n.style.background="#16A34A",n.style.color="#fff",n.style.borderRadius="0.75rem",n.style.fontWeight="600",n.textContent="Restore";const o=document.createElement("div");o.className="swipe-slide transition-transform",o.style.width="100%",o.style.position="relative",o.style.zIndex="1",o.style.background="#FFFFFF",o.style.borderRadius="0.75rem",s.appendChild(n),s.appendChild(o),o.appendChild(e);const i=new Date(d().selectedDate),a=P(t,i),r=B(t,i);return a?$(s,o,t,{onRestore:()=>{E(S.toggleHabitCompleted(t.id,D(t,new Date(d().selectedDate))));const l=D(t,new Date(d().selectedDate));E(S.updateHabit(t.id,{progress:{[l]:0}})),G()}}):r&&$(s,o,t,{onRestore:()=>{const l=q(new Date(d().selectedDate));E(S.updateHabit(t.id,{skippedDates:d().habits.find(p=>p.id===t.id).skippedDates.filter(p=>p!==l)}));const m=D(t,new Date(d().selectedDate));E(S.updateHabit(t.id,{progress:{[m]:0}})),G()}}),s},_createSwipeToSkipContainer(e,t){const s=document.createElement("div");s.className="swipe-container relative overflow-visible home-inset";const n=document.createElement("button");n.className="skip-btn absolute top-0 right-0 h-full",n.style.width="20%",n.style.background="#F97316",n.style.color="#fff",n.style.borderRadius="0.75rem",n.style.fontWeight="600",n.textContent="Skip";const o=document.createElement("div");return o.className="swipe-slide transition-transform",o.style.width="100%",o.style.position="relative",o.style.zIndex="1",o.style.background="#FFFFFF",o.style.borderRadius="0.75rem",s.appendChild(n),s.appendChild(o),o.appendChild(e),$(s,o),n.addEventListener("click",()=>{const i=q(new Date(d().selectedDate));E(S.updateHabit(t.id,{skippedDates:[...d().habits.find(a=>a.id===t.id).skippedDates,i]})),G()}),s},unmount(){this.container&&(this.container.innerHTML="")},_adjustProgress(e,t,s){var r;if(this.isInEditMode){const l=d(),m=l.habits.find(c=>c.id===e);if(!m)return;const p=D(m,new Date(l.selectedDate));(typeof m.progress!="object"||m.progress===null)&&(m.progress={});let u=(m.progress[p]||0)+s;u<0&&(u=0),u>t&&(u=t),m.progress[p]=u;return}const n=d().habits.find(l=>l.id===e);if(!n)return;const o=D(n,new Date(d().selectedDate));let a=(((r=n.progress)==null?void 0:r[o])||0)+s;a<0&&(a=0),a>t&&(a=t),E(S.updateHabit(n.id,{progress:{[o]:a}}))}},te={mount(e,t={}){this.container=e,this.callbacks=t},render(){},unmount(){this.container&&(this.container.innerHTML="")}},R={mount(e,t={}){this.container=e,this.callbacks=t,this._createStructure(),this._mountComponents(),this.setupResponsiveBehavior()},_createStructure(){this.headerContainer=this.container.querySelector(".habits-header .habits-title"),this.calendarContainer=this.container.querySelector(".week-calendar"),this.progressContainer=this.container.querySelector(".progress-section"),this.habitsContainer=this.container.querySelector(".habits-container"),this.controlsContainer=this.container.querySelector(".habits-header")},_mountComponents(){j.mount(this.headerContainer,{onGroupChange:this.callbacks.onGroupChange,onHolidayToggle:this.callbacks.onHolidayToggle}),W.mount(this.calendarContainer,{onDateChange:this.callbacks.onDateChange}),X.mount(this.progressContainer),T.mount(this.habitsContainer,{onHabitComplete:this.callbacks.onHabitComplete,onHabitEdit:this.callbacks.onHabitEdit,onSectionToggle:this.callbacks.onSectionToggle}),te.mount(this.controlsContainer,{onHabitComplete:this.callbacks.onHabitComplete,onHabitEdit:this.callbacks.onHabitEdit})},render(){j.render(),W.render(),X.render(),T.render()},setupResponsiveBehavior(){this._adjustHabitsContainerHeight(),window.addEventListener("resize",()=>{this._adjustHabitsContainerHeight()})},_adjustHabitsContainerHeight(){if(typeof window>"u")return;const e=this.habitsContainer;if(!e)return;const t=e.getBoundingClientRect();let s=0;const n=this.container.closest(".content-area");if(n){const i=window.getComputedStyle(n);s=parseFloat(i.paddingBottom)||0}const o=window.innerHeight-t.top-s;o>0&&(e.style.maxHeight=o+"px",e.style.overflowY="auto")},unmount(){j.unmount(),W.unmount(),X.unmount(),T.unmount(),te.unmount(),this.container&&(this.container.innerHTML="")}};function we(e,t,s,n){t.value=e.type==="touchstart"?e.touches[0].clientX:e.clientX,s.value=e.type==="touchstart"?e.touches[0].clientY:e.clientY,n.value=!1}function ke(e,t,s,n){if(!t.value)return;const o=e.type==="touchmove"?e.touches[0].clientX:e.clientX,i=e.type==="touchmove"?e.touches[0].clientY:e.clientY,a=Math.abs(o-t.value),r=Math.abs(i-s.value);a>50&&a>r*2&&(n.value=!0,e.preventDefault())}function Ee(e,t,s,n){if(!n.value||!t.value)return;const i=(e.type==="touchend"?e.changedTouches[0].clientX:e.clientX)-t.value;if(Math.abs(i)>50){const a=i>0?-1:1,r=ve(d().selectedGroup,a);r!==d().selectedGroup&&E(S.setSelectedGroup(r))}t.value=0,s.value=0,n.value=!1}function Se(){const e=document.getElementById("group-pill");if(e){const t={value:0},s={value:0},n={value:!1},o=r=>we(r,t,s,n),i=r=>ke(r,t,s,n),a=r=>Ee(r,t,s,n);e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("touchmove",i,{passive:!1}),e.addEventListener("touchend",a),e.addEventListener("mousedown",o),e.addEventListener("mousemove",i),e.addEventListener("mouseup",a),e.addEventListener("mouseleave",a)}}function ne(e){localStorage.setItem("homeSectionVisibility",JSON.stringify(e))}function _e(e){typeof window<"u"&&(window.sectionVisibility=e)}function O(e=b){const t=document.querySelector('[data-action="toggle-completed"] span:last-child'),s=document.querySelector('[data-action="toggle-skipped"] span:last-child'),n='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke-width="2"/></svg>',o='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17.94 17.94A10.37 10.37 0 0 1 12 20c-7 0-11-8-11-8a19.77 19.77 0 0 1 5-5" stroke-width="2"/><path d="M1 1l22 22" stroke-width="2"/></svg>';if(t){const i=t.parentElement.querySelector("span:first-child");i&&(i.innerHTML=e.Completed?o:n),t.textContent=(e.Completed?"Hide":"Show")+" Completed"}if(s){const i=s.parentElement.querySelector("span:first-child");i&&(i.innerHTML=e.Skipped?o:n),s.textContent=(e.Skipped?"Hide":"Show")+" Skipped"}}function He(){const e=document.getElementById("menu-toggle"),t=document.getElementById("dropdown-menu");if(e&&t){t.classList.add("hidden");const s=async()=>{const n=t.querySelector('[data-action="add-habit"]');if(!n)return;const{getState:o}=await _(async()=>{const{getState:a}=await import("./index-CWk_d2Bu.js").then(r=>r.P);return{getState:a}},__vite__mapDeps([0,1,2]));o().categories.length>0?(n.classList.remove("opacity-50","cursor-not-allowed","pointer-events-none"),n.title=""):(n.classList.add("opacity-50","cursor-not-allowed","pointer-events-none"),n.title="Create a category first before adding habits")};s(),_(()=>import("./index-CWk_d2Bu.js").then(n=>n.P),__vite__mapDeps([0,1,2])).then(n=>{n.subscribe(()=>{s()})}),e.addEventListener("click",n=>{n.stopPropagation(),s(),t.classList.toggle("hidden")}),document.addEventListener("click",n=>{!t.contains(n.target)&&!e.contains(n.target)&&t.classList.add("hidden")}),t.addEventListener("click",async n=>{var a,r;const o=n.target.closest(".dropdown-item");if(!o)return;const i=o.dataset.action;if(i&&!o.classList.contains("pointer-events-none"))switch(t.classList.add("hidden"),i){case"add-habit":_(()=>import("./index-CWk_d2Bu.js").then(l=>l.T),__vite__mapDeps([0,1,2])).then(l=>l.openAddHabitModal());break;case"manage-holidays":_(()=>import("./manage-DOS3jjNQ.js"),__vite__mapDeps([3,0,1,2])).then(l=>l.openHolidayModal());break;case"toggle-completed":{ee(!b.Completed,b.Skipped),ne(b),O(),(a=T.render)==null||a.call(T);break}case"toggle-skipped":{ee(b.Completed,!b.Skipped),ne(b),O(),(r=T.render)==null||r.call(T);break}}})}}const oe={async init(){const e=document.getElementById("home-view");if(!e){console.error("Home view container not found");return}R.mount(e,{onHabitComplete:this._handleHabitComplete,onHabitEdit:this._handleHabitEdit,onGroupChange:this._handleGroupChange,onDateChange:this._handleDateChange,onHolidayToggle:this._handleHolidayToggle,onSectionToggle:this._handleSectionToggle}),Se(),He(),_e(b),O(),be(()=>{this._handleStateChange()}),R.setupResponsiveBehavior(),this._handleStateChange()},_handleHabitComplete(){},_handleHabitEdit(){},_handleGroupChange(){},_handleDateChange(){},_handleHolidayToggle(){this._handleStateChange()},_handleSectionToggle(e,t){e==="completed"?b.Completed=!t:e==="skipped"&&(b.Skipped=!t),O()},_handleStateChange(){R.render()}};async function Pe(){await oe.init(),typeof window<"u"&&(window.HomeModule=oe,window.HomeView=R)}export{oe as HomeModule,Pe as init};
