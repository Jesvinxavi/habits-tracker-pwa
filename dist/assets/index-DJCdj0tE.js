(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();document.documentElement.classList.add("js-loading");function Jo(){document.documentElement.classList.remove("js-loading")}const Zo="modulepreload",Qo=function(e){return"/"+e},fn={},M=function(t,n,o){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(n.map(l=>{if(l=Qo(l),l in fn)return;fn[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const g=document.createElement("link");if(g.rel=c?"stylesheet":Zo,c||(g.as="script"),g.crossOrigin="",g.href=l,r&&g.setAttribute("nonce",r),document.head.appendChild(g),c)return new Promise((y,u)=>{g.addEventListener("load",y),g.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return a.then(i=>{for(const r of i||[])r.status==="rejected"&&s(r.reason);return t().catch(s)})};function Dt(){const e=new Date;return e.setHours(0,0,0,0),e.toISOString()}const f={categories:[],habits:[],currentDate:Dt(),selectedDate:Dt(),fitnessSelectedDate:Dt(),selectedGroup:"daily",holidayDates:[],holidayPeriods:[],settings:{darkMode:!1,hideCompleted:!1,hideSkipped:!1,holidayMode:!1},foodLog:[],stats:{},activities:[],activityCategories:[{id:"cardio",name:"Cardio",color:"#EF4444",icon:"üèÉ‚Äç‚ôÇÔ∏è"},{id:"strength",name:"Strength Training",color:"#2563EB",icon:"üí™"},{id:"stretching",name:"Stretching",color:"#22C55E",icon:"üßò‚Äç‚ôÄÔ∏è"},{id:"sports",name:"Sports",color:"#F97316",icon:"‚öΩ"},{id:"other",name:"Other",color:"#EAB308",icon:"üéØ"}],recordedActivities:{}};typeof window<"u"&&(window.appData=f);const lt=new Set;function Ue(e){return lt.add(e),()=>lt.delete(e)}function pt(){lt.forEach(e=>e(f))}function C(e){e(f),pt()}function Un(e){e&&((typeof e.progress!="object"||e.progress===null)&&(e.progress={}),Array.isArray(e.skippedDates)||(e.skippedDates=[]))}f.habits.forEach(Un);function Ot(e=f){Array.isArray(e.holidayDates)||(e.holidayDates=[]),Array.isArray(e.holidayPeriods)||(e.holidayPeriods=[])}Ot(f);const ea=Object.freeze(Object.defineProperty({__proto__:null,appData:f,ensureHabitIntegrity:Un,ensureHolidayIntegrity:Ot,listeners:lt,mutate:C,notify:pt,subscribe:Ue},Symbol.toStringTag,{value:"Module"})),jt="healthyHabitsAppData";function Wn(){try{if(typeof localStorage>"u")return!1;const e="__storage_test__";return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch{return!1}}const ta=(()=>{let e={};return{getItem:t=>e[t]??null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}})(),Xn=Wn()?localStorage:ta;function na(e,t=300){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}const oa="healthyHabitsDB",Ae="state";let Qe=null;function Kn(){return Qe||(Qe=new Promise((e,t)=>{if(!("indexedDB"in window))return e(null);const n=indexedDB.open(oa,1);n.onupgradeneeded=()=>{const o=n.result;o.objectStoreNames.contains(Ae)||o.createObjectStore(Ae)},n.onsuccess=()=>e(n.result),n.onerror=()=>e(null)}),Qe)}async function aa(e){const t=await Kn();return t?new Promise(n=>{const s=t.transaction(Ae,"readonly").objectStore(Ae).get(e);s.onsuccess=()=>n(s.result||null),s.onerror=()=>n(null)}):null}async function sa(e,t){const n=await Kn();if(n)return new Promise(o=>{const a=n.transaction(Ae,"readwrite");a.objectStore(Ae).put(t,e),a.oncomplete=()=>o(),a.onerror=()=>o()})}let Vt=!1;function ia(){return new Promise(e=>{const t=Xn.getItem(jt);if(t)try{const n=JSON.parse(t);Object.assign(f,n);const o=f.settings.darkMode;f.settings.darkMode=o;const a=new Date;a.setHours(0,0,0,0);const s=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0"),l=`${s}-${i}-${r}T00:00:00.000Z`;f.selectedDate=l,f.currentDate&&(f.currentDate=l),f.fitnessSelectedDate=l,f.selectedGroup="daily",Ot(f),M(()=>Promise.resolve().then(()=>dt),void 0).then(c=>c.initializeHolidays())}catch(n){typeof process>"u"&&console.error("[storage] Error parsing stored data:",n)}else M(()=>Promise.resolve().then(()=>dt),void 0).then(n=>n.initializeHolidays());Vt=!0,aa("appData").then(n=>{if(n&&typeof n=="object"){Object.assign(f,n);const o=f.settings.darkMode;f.settings.darkMode=o;const a=new Date;a.setHours(0,0,0,0);const s=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0"),l=`${s}-${i}-${r}T00:00:00.000Z`;f.selectedDate=l,f.currentDate&&(f.currentDate=l),f.fitnessSelectedDate=l,f.selectedGroup="daily",pt()}e()}).catch(n=>{e()})})}function ra(){try{const e=JSON.stringify(f);Xn.setItem(jt,e),sa("appData",f)}catch(e){typeof process>"u"&&console.error("[storage] Error saving data to localStorage:",e)}}const la=na(()=>{Vt&&ra()},250);Ue(la);typeof window<"u"&&Wn()&&window.addEventListener("storage",e=>{if(e.key===jt&&e.newValue&&Vt)try{Object.assign(f,JSON.parse(e.newValue)),pt()}catch{}});function ca(){f.settings.darkMode=!1,localStorage.removeItem("theme"),localStorage.setItem("theme","light"),zt()}function da(){const e=localStorage.getItem("theme");e===null?(f.settings.darkMode=!1,localStorage.setItem("theme","light")):f.settings.darkMode=e==="dark",zt()}function ua(){f.settings.darkMode=!f.settings.darkMode,zt(),localStorage.setItem("theme",f.settings.darkMode?"dark":"light")}function zt(){const e=f.settings.darkMode?"dark":"light";document.documentElement.setAttribute("data-theme",e);const t=document.getElementById("theme-toggle");if(t){const n=t.querySelector("svg");if(!n)return;f.settings.darkMode?n.innerHTML='<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" fill="none"/>':n.innerHTML='<circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>'}}function ga(){const e=document.querySelectorAll(".tab-item"),t=document.querySelectorAll(".view"),n={"fitness-view":`
      <header class="app-header flex justify-between items-center h-11 px-4 sm:px-6 lg:px-8 border-b border-gray-200 dark:border-gray-700 w-full">
        <button class="back-btn text-ios-blue text-lg lg:text-xl">‚Üê</button>
        <h1 class="app-title text-lg font-semibold lg:text-xl">Fitness</h1>
        <button class="add-btn text-ios-blue text-2xl lg:text-3xl">+</button>
      </header>
      <div class="placeholder-content text-center py-16 px-4 sm:px-6 lg:px-8 text-gray-500">
        <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center lg:w-20 lg:h-20">
          <svg class="w-8 h-8 lg:w-10 lg:h-10" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
          </svg>
        </div>
        <p class="text-lg font-medium lg:text-xl">Fitness tracking will be built here</p>
      </div>`,"food-view":`
      <header class="app-header flex justify-between items-center h-11 px-4 sm:px-6 lg:px-8 border-b border-gray-200 dark:border-gray-700 w-full">
        <button class="back-btn text-ios-blue text-lg lg:text-xl">‚Üê</button>
        <h1 class="app-title text-lg font-semibold lg:text-xl">Food Log</h1>
        <button class="add-btn text-ios-blue text-2xl lg:text-3xl">+</button>
      </header>
      <div class="placeholder-content text-center py-16 px-4 sm:px-6 lg:px-8 text-gray-500">
        <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center lg:w-20 lg:h-20">
          <svg class="w-8 h-8 lg:w-10 lg:h-10" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
          </svg>
        </div>
        <p class="text-lg font-medium lg:text-xl">Food logging will be built here</p>
      </div>`};function o(g){var u;let y=document.getElementById(g);y||(y=document.createElement("div"),y.id=g,y.className="view w-full h-full flex flex-col overflow-hidden",(u=document.querySelector("main.content-area"))==null||u.appendChild(y)),y.childElementCount===0&&n[g]&&y.insertAdjacentHTML("beforeend",n[g])}let a=!1;async function s(){if(a)return;a=!0;const g=document.getElementById("habits-view");let y;g&&!g.querySelector("#habits-loading")&&(y=document.createElement("div"),y.id="habits-loading",y.className="flex flex-col items-center justify-center flex-grow py-10 text-gray-400",y.innerHTML=`
        <svg class="animate-spin w-8 h-8 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg>
        <p class="text-sm">Loading‚Ä¶</p>`,g.appendChild(y));try{const[{init:u},{init:m},{init:b}]=await Promise.all([M(()=>import("./HabitsListView-DETtI4gh.js"),[]),M(()=>import("./CategoriesView-6Y8Xi-XH.js"),[]),M(()=>import("./ReorderView-RQXjg8C-.js"),[])]);await m(),await u(),M(()=>import("./search-BHc29jTI.js"),[]).then(p=>p.initializeSearch()),b()}catch(u){console.error("Error loading habits modules:",u)}y==null||y.remove()}async function i(g){if(o(g),document.getElementById(g),t.forEach(y=>{y.id===g?(y.classList.add("active-view"),y.classList.remove("hidden"),y.classList.add("block")):(y.classList.remove("active-view"),y.classList.add("hidden"),y.classList.remove("block"))}),e.forEach(y=>{y.classList.contains("active"),y.classList.toggle("active",y.dataset.view===g),y.classList.contains("active")}),localStorage.setItem("activeHabitTrackerTab",g),g==="fitness-view"){const y=new Date;y.setHours(0,0,0,0);const{getLocalISODate:u}=await M(async()=>{const{getLocalISODate:b}=await Promise.resolve().then(()=>Ba);return{getLocalISODate:b}},void 0),m=u(y)+"T00:00:00.000Z";f.fitnessSelectedDate=m,window.fitnessCalendarApi&&typeof window.fitnessCalendarApi.refresh=="function"&&window.fitnessCalendarApi.refresh()}g==="habits-view"&&s()}const r=localStorage.getItem("activeHabitTrackerTab")||"home-view";i(r),e.forEach(g=>{g.addEventListener("click",async y=>{const u=g.dataset.view;if(!u){console.error("No view ID found in dataset!");return}y.preventDefault(),await i(u)})});let l=!1;function c(){l||a||(l=!0,M(()=>import("./HabitsListView-DETtI4gh.js"),[]),M(()=>import("./CategoriesView-6Y8Xi-XH.js"),[]),M(()=>import("./ReorderView-RQXjg8C-.js"),[]))}const d=document.querySelector('.tab-item[data-view="habits-view"]');d&&d.addEventListener("pointerenter",c,{once:!0}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&c()})}function Z(e){const t=document.querySelectorAll(`#${e}`),n=t[t.length-1];if(!n)return;document.body.style.overflow="hidden",n.classList.remove("hidden"),n.classList.remove("animate-in","fade-in"),n.style.display="flex";const o=n.querySelector(".overflow-y-auto");o&&(o.scrollTop=0),n.parentNode!==document.body&&document.body.appendChild(n)}function z(e){const t=document.getElementById(e);t&&(t.classList.add("hidden"),t.style.display="none",document.body.style.overflow="")}const Jn=Object.freeze(Object.defineProperty({__proto__:null,closeModal:z,openModal:Z},Symbol.toStringTag,{value:"Module"}));function We(){return Date.now()+Math.random().toString(36).substr(2,9)}function Gt({title:e="Are you sure?",message:t="",okText:n="OK",cancelText:o="Cancel",onOK:a}={}){let s=document.getElementById("global-confirm-modal");s||(s=document.createElement("div"),s.id="global-confirm-modal",s.className="modal-overlay fixed inset-0 bg-black/70 backdrop-blur-sm z-[1100] hidden items-center justify-center p-4",document.body.appendChild(s));const i=!o;s.innerHTML=`<div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-sm w-full p-6 text-center">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">${e}</h2>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">${t}</p>
      <div class="flex ${i?"justify-center":"gap-3"}">
        ${i?"":`<button class='confirm-cancel-btn flex-1 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors'>${o}</button>`}
        <button class='confirm-ok-btn ${i?"w-full":"flex-1"} py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors'>${n}</button>
      </div>
    </div>`,s.querySelector(".confirm-ok-btn").onclick=()=>{z("global-confirm-modal"),typeof a=="function"&&a()};const r=s.querySelector(".confirm-cancel-btn");r&&(r.onclick=()=>z("global-confirm-modal")),Z("global-confirm-modal")}const Zn=Object.freeze(Object.defineProperty({__proto__:null,showConfirm:Gt},Symbol.toStringTag,{value:"Module"})),ma=["times","minutes","hours","steps","pages","cups","glasses","miles","kilometers","pounds","kilograms","repetitions","sets"],ya=["first","second","third","fourth","last"],fa=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],Qn=["daily","weekly","biweekly","monthly","yearly"],pa=[{hex:"#EF4444",gradient:"from-red-400 to-red-600",shadow:"hover:shadow-red-500/25"},{hex:"#F97316",gradient:"from-orange-400 to-orange-600",shadow:"hover:shadow-orange-500/25"},{hex:"#EAB308",gradient:"from-amber-400 to-amber-600",shadow:"hover:shadow-amber-500/25"},{hex:"#22C55E",gradient:"from-green-400 to-green-600",shadow:"hover:shadow-green-500/25"},{hex:"#14B8A6",gradient:"from-teal-400 to-teal-600",shadow:"hover:shadow-teal-500/25"},{hex:"#06B6D4",gradient:"from-cyan-400 to-cyan-600",shadow:"hover:shadow-cyan-500/25"},{hex:"#0EA5E9",gradient:"from-sky-400 to-sky-600",shadow:"hover:shadow-sky-500/25"},{hex:"#2563EB",gradient:"from-blue-400 to-blue-600",shadow:"hover:shadow-blue-500/25"},{hex:"#4F46E5",gradient:"from-indigo-400 to-indigo-600",shadow:"hover:shadow-indigo-500/25"},{hex:"#9333EA",gradient:"from-purple-400 to-purple-600",shadow:"hover:shadow-purple-500/25"},{hex:"#EC4899",gradient:"from-pink-400 to-pink-600",shadow:"hover:shadow-pink-500/25"},{hex:"#F43F5E",gradient:"from-rose-400 to-rose-600",shadow:"hover:shadow-rose-500/25"}],eo=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Yt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let pn=!1;function Ut(){if(pn)return;const e=document.querySelector(".color-grid"),t=document.querySelector(".edit-color-grid");!e&&!t||(pa.forEach(({hex:n,gradient:o,shadow:a})=>{const s=document.createElement("button");s.className=`color-option w-10 h-10 rounded-xl bg-gradient-to-br ${o} shadow-lg hover:scale-110 transition-all duration-200 ${a}`,s.dataset.color=n,e&&e.appendChild(s);const i=document.createElement("button");i.className=`edit-color-option w-10 h-10 rounded-xl bg-gradient-to-br ${o} shadow-lg hover:scale-110 transition-all duration-200 ${a}`,i.dataset.color=n,t&&t.appendChild(i)}),pn=!0)}function ha(){const e=document.getElementById("category-name-input"),t=document.querySelectorAll(".color-option");e&&(e.value=""),t.forEach(n=>n.classList.remove("ring-2","ring-black","ring-offset-2"))}function Se(){const e=document.getElementById("habit-category-select"),t=document.getElementById("no-categories-message");if(!e)return;e.innerHTML='<option value="" disabled selected>Select Category</option>',f.categories.forEach(a=>{const s=document.createElement("option");s.value=a.id,s.textContent=a.name,e.appendChild(s)});const n=f.categories.length>0;e.classList.toggle("hidden",!n);const o=e.nextElementSibling;o&&o.tagName.toLowerCase()==="svg"&&o.classList.toggle("hidden",!n),t&&t.classList.toggle("hidden",n)}function to(){Ut(),ha(),Z("add-category-modal")}function Wt(){z("add-category-modal")}function va(e){Ut();const t=f.categories.find(o=>o.id===e);if(!t)return;const n=document.getElementById("edit-category-name-input");n&&(n.value=t.name),document.getElementById("edit-category-modal").dataset.categoryId=e,document.querySelectorAll(".edit-color-option").forEach(o=>{o.classList.toggle("ring-2",o.dataset.color===t.color)}),Z("edit-category-modal")}function Xt(){z("edit-category-modal")}function ba(){const e=document.getElementById("category-name-input"),t=document.querySelector(".color-option.ring-2");if(!e||!t)return;const n={id:We(),name:e.value.trim(),color:t.dataset.color};C(o=>o.categories.push(n)),window._preselectCategoryId=n.id,Wt(),Se(),M(()=>Promise.resolve().then(()=>en),void 0).then(o=>o.renderHabitsView()),window._returnToHabit&&(window._returnToHabit=!1,M(()=>Promise.resolve().then(()=>ho),void 0).then(o=>o.openAddHabitModal()))}function xa(){const e=document.getElementById("edit-category-modal"),t=e==null?void 0:e.dataset.categoryId;if(!t)return;const n=document.getElementById("edit-category-name-input"),o=document.querySelector(".edit-color-option.ring-2");!n||!o||(C(a=>{const s=a.categories.find(i=>i.id===t);s&&(s.name=n.value.trim(),s.color=o.dataset.color)}),Xt(),Se(),M(()=>Promise.resolve().then(()=>en),void 0).then(a=>a.renderHabitsView()))}function wa(){const e=document.getElementById("edit-category-modal"),t=e==null?void 0:e.dataset.categoryId;t&&Gt({title:"Delete Category?",message:"Deleting this category will also remove all habits it contains. This action cannot be undone.",okText:"Delete",onOK:()=>{C(n=>{n.categories=n.categories.filter(o=>o.id!==t),n.habits=n.habits.filter(o=>o.categoryId!==t)}),Xt(),Se(),M(()=>Promise.resolve().then(()=>en),void 0).then(n=>n.renderHabitsView())}})}function ka(){Ut();const e=document.querySelector(".new-category-btn");e&&e.addEventListener("click",to);const t=document.getElementById("category-name-input");t&&t.addEventListener("input",hn);const n=document.getElementById("cancel-category"),o=document.getElementById("save-category");n&&n.addEventListener("click",Wt),o&&o.addEventListener("click",ba);const a=document.getElementById("edit-category-name-input");a&&a.addEventListener("input",vn);const s=document.getElementById("cancel-edit-category"),i=document.getElementById("save-edit-category"),r=document.getElementById("delete-category-btn");s&&s.addEventListener("click",Xt),i&&i.addEventListener("click",xa),r&&r.addEventListener("click",wa),document.addEventListener("click",l=>{l.target.classList.contains("color-option")?(document.querySelectorAll(".color-option").forEach(c=>c.classList.remove("ring-2","ring-black","ring-offset-2")),l.target.classList.add("ring-2","ring-black","ring-offset-2"),hn()):l.target.classList.contains("edit-color-option")&&(document.querySelectorAll(".edit-color-option").forEach(c=>c.classList.remove("ring-2","ring-black","ring-offset-2")),l.target.classList.add("ring-2","ring-black","ring-offset-2"),vn())}),document.addEventListener("click",l=>{const c=l.target.closest(".edit-category-btn");if(c){const d=c.dataset.categoryId;d&&va(d)}}),Se()}function hn(){const e=document.getElementById("save-category"),t=document.getElementById("category-name-input"),n=t&&t.value.trim().length>0,o=!!document.querySelector(".color-option.ring-2"),a=n&&o;e&&(e.disabled=!a,e.classList.toggle("opacity-50",!a))}function vn(){const e=document.getElementById("save-edit-category"),t=document.getElementById("edit-category-name-input"),n=t&&t.value.trim().length>0,o=!!document.querySelector(".edit-color-option.ring-2"),a=n&&o;e&&(e.disabled=!a,e.classList.toggle("opacity-50",!a))}const no=Object.freeze(Object.defineProperty({__proto__:null,closeAddCategoryModal:Wt,initializeCategories:ka,openAddCategoryModal:to,populateCategoryDropdown:Se},Symbol.toStringTag,{value:"Module"}));function Ea(){const e=document.getElementById("time-picker-btn"),t=document.getElementById("time-picker-popup"),n=document.getElementById("selected-time"),o=document.getElementById("hour-select"),a=document.getElementById("minute-select"),s=document.getElementById("hour-picker"),i=document.getElementById("minute-picker");if(!e||!t||!s||!i)return;let r=o?o.value:"09",l=a?a.value:"00";function c(v,x){const L=v.getBoundingClientRect(),E=L.top+L.height/2;let h=null,k=1/0;if(v.querySelectorAll(`.${x}`).forEach(T=>{const H=T.getBoundingClientRect(),D=H.top+H.height/2,F=Math.abs(E-D);F<k&&(k=F,h=T)}),!h)return null;const w=x.replace("-option","");return h.dataset[w]??null}function d(v,x){const L=v.getBoundingClientRect(),E=L.top+L.height/2;let h=null,k=1/0;v.querySelectorAll(`.${x}`).forEach(w=>{const T=w.getBoundingClientRect(),H=T.top+T.height/2,D=Math.abs(E-H);D<k&&(k=D,h=w)}),h&&k>2&&h.scrollIntoView({behavior:"smooth",block:"center"})}function g(){const v=document.getElementById("hour-options-container");if(v&&v.childElementCount===0)for(let L=0;L<3;L++)for(let E=0;E<24;E++){const h=E.toString().padStart(2,"0"),k=document.createElement("div");k.className="hour-option py-1 text-center text-sm transition-colors",k.setAttribute("data-hour",h),k.textContent=h,v.appendChild(k)}const x=document.getElementById("minute-options-container");if(x){x.innerHTML="";for(let L=0;L<3;L++)for(let E=0;E<60;E++){const h=E.toString().padStart(2,"0"),k=document.createElement("div");k.className="minute-option py-1 text-center text-sm transition-colors",k.setAttribute("data-minute",h),k.textContent=h,x.appendChild(k)}}}function y(v,x){const E=v.scrollTop,h=x*28;E<h*.1?v.scrollTop=E+h:E>h*1.9&&(v.scrollTop=E-h)}function u(){const v=s.querySelectorAll(`[data-hour="${r}"]`);v.length>=2&&v[1].scrollIntoView({behavior:"instant",block:"center"});const x=i.querySelectorAll(`[data-minute="${l}"]`);x.length>=2&&x[1].scrollIntoView({behavior:"instant",block:"center"})}function m(){const v=c(s,"hour-option"),x=c(i,"minute-option");v!==null&&(r=v),x!==null&&(l=x),n&&(n.textContent=`${r}:${l}`)}e.addEventListener("click",v=>{v.stopPropagation(),o&&(r=o.value),a&&(l=a.value),g(),t.classList.remove("hidden"),setTimeout(u,10)}),document.addEventListener("click",v=>{!t.contains(v.target)&&!e.contains(v.target)&&(t.classList.contains("hidden")||(o&&(o.value=r),a&&(a.value=l),n&&(n.textContent=`${r}:${l}`),t.classList.add("hidden")))}),t.addEventListener("click",v=>v.stopPropagation());let b,p;s.addEventListener("scroll",()=>{y(s,24),m(),clearTimeout(b),b=setTimeout(()=>{d(s,"hour-option")},150)}),i.addEventListener("scroll",()=>{y(i,60),m(),clearTimeout(p),p=setTimeout(()=>{d(i,"minute-option")},150)})}const De=new Set;function oo(){De.clear(),Array.isArray(f.holidayDates)&&f.holidayDates.forEach(e=>De.add(e))}function Sa(){oo(),qe()}function qe(){const e=new Set(De);f.holidayPeriods.forEach(t=>{const n=new Date(t.startISO),o=new Date(t.endISO);for(;n<=o;)e.add(U(n)),n.setDate(n.getDate()+1)}),C(t=>{t.holidayDates=Array.from(e)})}function ct(e){const t=U(e);return f.holidayDates.includes(t)?!0:f.holidayPeriods.some(n=>t>=n.startISO&&t<=n.endISO)}function Ia(e){const t=U(e);De.has(t)?De.delete(t):De.add(t),qe()}function La({startISO:e,endISO:t,label:n="Holiday"}){!e||!t||(t<e&&([e,t]=[t,e]),C(o=>{o.holidayPeriods.push({id:We(),startISO:U(e),endISO:U(t),label:n})}),qe())}function Ca(e){C(t=>{t.holidayPeriods=t.holidayPeriods.filter(n=>n.id!==e)}),qe()}function Da(){C(e=>{e.holidayPeriods=[]}),qe()}function U(e){e instanceof Date||(e=new Date(e));const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}const dt=Object.freeze(Object.defineProperty({__proto__:null,addPeriod:La,dateToKey:U,deleteAllPeriods:Da,deletePeriod:Ca,initializeHolidays:Sa,isHoliday:ct,recalcHolidayDates:qe,syncSinglesFromState:oo,toggleSingleHoliday:Ia},Symbol.toStringTag,{value:"Module"}));function $e(e){const t=new Date(e.getTime());t.setHours(0,0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));const n=new Date(t.getFullYear(),0,1);return Math.ceil(((t-n)/864e5+1)/7)}function Le(e,t,n="daily"){switch(n){case"weekly":return e.getFullYear()===t.getFullYear()&&$e(e)===$e(t);case"monthly":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth();case"yearly":return e.getFullYear()===t.getFullYear();case"daily":default:return e.toDateString()===t.toDateString()}}function Ht(e,t){return e.toDateString()===t.toDateString()}function qt(e){const t=new Date(e),n=t.getDay(),o=n===0?-6:1-n;return t.setDate(t.getDate()+o),t.setHours(0,0,0,0),t}function ut(e,t){return Math.floor((qt(t)-qt(e))/6048e5)}function ao(e,t="daily",n=1){switch(t){case"weekly":e.setDate(e.getDate()+n*7);break;case"monthly":e.setMonth(e.getMonth()+n);break;case"yearly":e.setFullYear(e.getFullYear()+n);break;case"daily":default:e.setDate(e.getDate()+n)}return e}function ie(e){let t;if(typeof e=="string")e.includes("T")?t=e.slice(0,10):t=e;else{const n=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");t=`${n}-${o}-${a}`}return t}const Ba=Object.freeze(Object.defineProperty({__proto__:null,advanceDate:ao,getISOWeekNumber:$e,getLocalISODate:ie,isSameDay:Ht,isSamePeriod:Le,mondayStart:qt,weeksBetween:ut},Symbol.toStringTag,{value:"Module"}));function Oe(e){if(e.anchorDate){const t=new Date(e.anchorDate);if(!isNaN(t))return t}if(e.createdAt){const t=new Date(e.createdAt);if(!isNaN(t))return t}if(typeof e.id=="string"&&/^[0-9]{13}/.test(e.id)){const t=parseInt(e.id.slice(0,13),10);if(!Number.isNaN(t))return new Date(t)}return new Date(0)}const Ta={first:1,second:2,third:3,fourth:4,fifth:5};function Aa(e,t){if(t==="last"){const o=new Date(e);return o.setDate(e.getDate()+7),o.getMonth()!==e.getMonth()}const n=Ta[t];return n?Math.floor((e.getDate()-1)/7)+1===n:!1}function K(e,t){if(e.paused===!0)return!1;const n=new Date(t);if(isNaN(n))return!1;const o=e.targetFrequency||e.frequency||"daily",a=typeof o=="string"?o.toLowerCase():o;if(typeof e.target=="number"&&e.target>0){if(a==="biweekly"){const r=Oe(e);return ut(r,n)%2===0}return!0}const s=n.getDay(),i=U(n);if(ct(i)&&a==="daily"&&!e.activeOnHolidays)return!1;if(a==="daily"||!a)return!0;if(a==="weekly")return Array.isArray(e.days)&&e.days.length>0?e.days.includes(s):!0;if(a==="biweekly"){if(Array.isArray(e.days)&&e.days.length>0&&!e.days.includes(s))return!1;const r=Oe(e),l=ut(r,n);if(l%2!==0)return!1;if(l===0){const c=r.getDay();if(s<c)return!1}return!0}if(a==="monthly"){const r=e.monthly||{},l=Math.max(1,parseInt(r.interval||1,10)),c=Oe(e);if(((n.getFullYear()-c.getFullYear())*12+(n.getMonth()-c.getMonth()))%l!==0)return!1;if(!r.mode||r.mode==="each"){const g=Array.isArray(r.dates)&&r.dates.length>0?r.dates:null;return g?g.includes(n.getDate()):!0}if(r.mode==="on"){const g=Array.isArray(r.combinations)?r.combinations:[];return g.length===0?!0:g.some(y=>{const[u,m]=y.split("-");if(!u||!m)return!1;const b={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6}[m.toLowerCase()];return b===void 0||b!==s?!1:Aa(n,u.toLowerCase())})}return!0}if(a==="yearly"){const r=Array.isArray(e.months)&&e.months.length>0?e.months:null,l=Math.max(1,parseInt(e.yearInterval||1,10)),c=Oe(e);return!((n.getFullYear()-c.getFullYear())%l!==0||r&&!r.includes(n.getMonth())||Array.isArray(e.yearlyDates)&&e.yearlyDates.length>0&&!e.yearlyDates.includes(n.getDate()))}return!0}function Kt(e,t){const n=typeof e.target=="number"&&e.target>0,o=e.targetFrequency||e.frequency||"daily",a=typeof o=="string"?o.toLowerCase():o,s=e.frequency||e.targetFrequency||"daily",i=typeof s=="string"?s.toLowerCase():s;return t==="daily"?n?a==="daily":["daily","weekly","biweekly","monthly"].includes(i):t==="weekly"?n?a==="weekly"||a==="biweekly":i==="weekly":t==="monthly"?n?a==="monthly":i==="yearly":t==="yearly"?n&&a==="yearly":!1}function Jt(e,t){const n=new Date(t),o=e.targetFrequency||e.frequency||"daily";if(o==="daily"){const a=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0");return`${a}-${s}-${i}`}if(o==="weekly"){const a=$e(n);return`${n.getFullYear()}-W${a}`}if(o==="monthly")return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;if(o==="yearly")return`${n.getFullYear()}`;if(o==="biweekly"){const a=Oe(e),s=ut(a,n),i=new Date(a);i.setDate(a.getDate()+Math.floor(s/2)*14);const r=$e(i);return`${i.getFullYear()}-BW${r}`}return n.toISOString().slice(0,10)}function G(e,t){if(e.completed===!0)return!0;if(typeof e.completed!="object"||e.completed===null)return!1;const n=Jt(e,t);return e.completed[n]===!0}function so(e,t,n){const o=Jt(e,t);(typeof e.completed!="object"||e.completed===null)&&(e.completed={}),e.completed[o]=n}function io(e,t){const n=G(e,t);so(e,t,!n)}function Zt(e,t=new Date){const n=t instanceof Date?t:new Date(t),o=U(n);return Array.isArray(e.skippedDates)&&e.skippedDates.includes(o)}const $a=Object.freeze(Object.defineProperty({__proto__:null,belongsToSelectedGroup:Kt,getPeriodKey:Jt,isHabitCompleted:G,isHabitScheduledOnDate:K,isHabitSkippedToday:Zt,setHabitCompleted:so,toggleHabitCompleted:io},Symbol.toStringTag,{value:"Module"}));function ro(e){return e<34?getComputedStyle(document.documentElement).getPropertyValue("--danger-color").trim()||"#ff3b30":e<67?getComputedStyle(document.documentElement).getPropertyValue("--warning-color").trim()||"#ff9500":getComputedStyle(document.documentElement).getPropertyValue("--success-color").trim()||"#34c759"}function lo(e){const t=document.querySelector(".progress-ring-fg"),n=document.querySelector(".progress-number");if(!t||!n)return;const o=t.r.baseVal.value,a=2*Math.PI*o,s=a-e/100*a;t.style.strokeDashoffset=s,t.style.stroke=ro(e),n.textContent=`${Math.round(e)}%`}function W(e=""){return e.charAt(0).toUpperCase()+e.slice(1)}function Ma(e){const t=["th","st","nd","rd"],n=e%100;return e+(t[(n-20)%10]||t[n]||t[0])}function Ha(e=[],t){return e.length===0?"":e.length<=3?e.join(", "):`${e.length} ${t}`}function qa(e={}){if(!e)return"Monthly";const t=e.interval||1,n=t>1?`Every ${t} Months`:"Monthly";if(e.mode==="on"){const a=Array.isArray(e.combinations)?e.combinations:[];if(a.length===0)return n;const s=a.map(i=>{const[r,l]=i.split("-");return`${W(r)} ${W(l)}`});return _t(s,"dates",n)}const o=Array.isArray(e.dates)?e.dates.map(Ma):[];return _t(o,"dates",n)}function _a({months:e=[],yearInterval:t=1}={}){const n=t>1?`Every ${t} Years`:"Yearly";if(!e||e.length===0)return n;const o=e.map(a=>Yt[a]);return _t(o,"months",n)}function _t(e,t,n){return e.length===1?`${e[0]} ${n}`.trim():e.length>1?`${e.length} ${t} ${n}`.trim():n}function Fa(e){return e&&typeof e.target=="number"&&e.target>0?`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10" stroke-width="2"/>
      <circle cx="12" cy="12" r="6" stroke-width="2"/>
      <circle cx="12" cy="12" r="2" fill="currentColor" stroke="currentColor" stroke-width="2"/>
    </svg>`:`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`}function Pa(e){const t=eo,n=W;let o="";switch(e.frequency){case"daily":o="Daily";break;case"weekly":case"biweekly":{const a=Array.isArray(e.days)?e.days.map(i=>t[i]):[],s=Ha(a,"days");o=s?`${s} ${n(e.frequency)}`:n(e.frequency);break}case"monthly":{o=qa(e.monthly);break}case"yearly":{o=_a({months:e.months,yearInterval:e.yearInterval});break}default:o=e.frequency}if(e.target){const a=e.targetUnit&&e.targetUnit!=="none"?e.targetUnit:"",s=n(e.targetFrequency||e.frequency);o=`${e.target} ${a} ${s}`.replace(/\s+/g," ").trim()}return e.scheduledTime&&(o+=` ‚Ä¢ ${e.scheduledTime}`),e.paused&&(o+=" ‚Ä¢ Paused"),o}function Xe(e="#000000",t=1){let n=e.replace("#","");n.length===3&&(n=n.split("").map(r=>r+r).join(""));const o=parseInt(n,16),a=o>>16&255,s=o>>8&255,i=o&255;return`rgba(${a},${s},${i},${t})`}function Ra(e,t=0,n=.07){const o=Math.max(0,Math.min(t,1))*100,a=Xe(e,n);return`linear-gradient(to right, ${e} ${o}%, transparent ${o}% ), ${a}`}function Na(e){const t=f.habits.find(c=>c.id===e);if(!t)return null;const n=new Date,o={totalCompletions:0,currentStreak:0,longestStreak:0,completionRate7d:0,completionRate30d:0,completionRateTotal:0,recentActivity:0,lastCompleted:null,targetProgress:null,weeklyAverage:0,daysTracked:0},a=parseInt(t.id.toString(),10),s=new Date(a),i=Math.floor((n-s)/(1e3*60*60*24))+1;o.daysTracked=i,o.completionRate7d=Bt(t,7),o.completionRate30d=Bt(t,30),o.completionRateTotal=Bt(t,i),o.currentStreak=Oa(t),o.longestStreak=ja(t);let r=0;for(let c=0;c<Math.min(30,i);c++){const d=new Date(n);d.setDate(n.getDate()-c),!(d<s)&&K(t,d)&&G(t,d)&&(r++,(!o.lastCompleted||d>new Date(o.lastCompleted))&&(o.lastCompleted=d.toISOString()))}o.recentActivity=r;for(let c=0;c<i;c++){const d=new Date(n);d.setDate(n.getDate()-c),!(d<s)&&K(t,d)&&G(t,d)&&o.totalCompletions++}const l=i/7;if(o.weeklyAverage=l>0?o.totalCompletions/l:0,t.target&&typeof t.target=="number"){const c=t.targetFrequency||t.frequency||"daily",d=G(t,n);K(t,n),c==="daily"&&(o.targetProgress={completed:d?1:0,target:t.target,unit:t.targetUnit||"",isComplete:d})}return o}function Bt(e,t=30){const n=new Date;let o=0,a=0;const s=parseInt(e.id.toString(),10),i=new Date(s),r=Math.min(t,Math.floor((n-i)/(1e3*60*60*24))+1);for(let l=0;l<r;l++){const c=new Date(n);c.setDate(n.getDate()-l),!(c<i)&&K(e,c)&&(a++,G(e,c)&&o++)}return a>0?o/a*100:0}function Oa(e){const t=new Date;let n=0,o=new Date(t);const a=parseInt(e.id.toString(),10),s=new Date(a);for(;o>=s;){if(K(e,o))if(G(e,o))n++;else break;o.setDate(o.getDate()-1)}return n}function ja(e){const t=new Date;let n=0,o=0;const a=parseInt(e.id.toString(),10),s=new Date(a),i=Math.floor((t-s)/(1e3*60*60*24))+1;for(let r=i-1;r>=0;r--){const l=new Date(t);l.setDate(t.getDate()-r),!(l<s)&&K(e,l)&&(G(e,l)?(o++,n=Math.max(n,o)):o=0)}return n}function Va(e){const t=f.habits.find(o=>o.id===e);if(!t)return;const n=Na(e);za(t,n)}function za(e,t){const n=f.categories.find(l=>l.id===e.categoryId),o=`
    <div id="habit-stats-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="modal-content bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-hidden">
        <div class="modal-header flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
          <div class="flex items-center gap-3">
            <div class="habit-icon w-10 h-10 rounded-full flex items-center justify-center text-xl" style="background-color: ${n==null?void 0:n.color}20; color: ${n==null?void 0:n.color};">
              ${e.icon||"üìã"}
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">${e.name}</h3>
              <p class="text-sm text-gray-500 dark:text-gray-400">Habit Statistics</p>
            </div>
          </div>
          <button id="close-habit-stats-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        
        <div class="modal-body p-4 overflow-y-auto">
          ${Ga(e,t,n)}
        </div>
      </div>
    </div>
  `,a=document.getElementById("habit-stats-modal");a&&a.remove(),document.body.insertAdjacentHTML("beforeend",o);const s=document.getElementById("habit-stats-modal"),i=document.getElementById("close-habit-stats-modal"),r=()=>{s&&(s.classList.add("hidden"),setTimeout(()=>s.remove(),300))};i&&i.addEventListener("click",r),s&&s.addEventListener("click",l=>{l.target===s&&r()}),s&&s.classList.remove("hidden")}function Ga(e,t,n){if(!t||t.daysTracked===0)return`
      <div class="text-center py-8">
        <span class="material-icons text-4xl text-gray-400 mb-4">bar_chart</span>
        <p class="text-gray-600 dark:text-gray-400">No data available yet</p>
        <p class="text-sm text-gray-500 mt-2">Start completing this habit to see statistics</p>
      </div>
    `;let o=`
    <div class="stats-grid space-y-4">
      <!-- Overview Stats -->
      <div class="stats-section">
        <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Overview</h4>
        <div class="grid grid-cols-2 gap-4">
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-2xl font-bold text-gray-900 dark:text-white">${t.totalCompletions}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Total Completions</div>
          </div>
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-2xl font-bold text-gray-900 dark:text-white">${t.weeklyAverage.toFixed(1)}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Per Week Average</div>
          </div>
        </div>
      </div>
  `;return o+=`
    <div class="stats-section">
      <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Completion Rates</h4>
      <div class="grid grid-cols-2 gap-4">
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.completionRate7d.toFixed(1)}%</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Last 7 Days</div>
        </div>
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.completionRate30d.toFixed(1)}%</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Last 30 Days</div>
        </div>
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.completionRateTotal.toFixed(1)}%</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">All Time</div>
        </div>
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.daysTracked}</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Days Tracked</div>
        </div>
      </div>
    </div>
  `,o+=`
    <div class="stats-section">
      <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Streaks</h4>
      <div class="grid grid-cols-2 gap-4">
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.currentStreak}</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Current Streak</div>
        </div>
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.longestStreak}</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Longest Streak</div>
        </div>
      </div>
    </div>
  `,t.targetProgress&&(o+=`
      <div class="stats-section">
        <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Target Progress</h4>
        <div class="stat-card bg-gradient-to-r ${t.targetProgress.isComplete?"from-green-50 to-green-100 dark:from-green-900 dark:to-green-800":"from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600"} p-4 rounded-lg border-2" style="border-color: ${n==null?void 0:n.color}40;">
          <div class="text-sm font-semibold text-gray-900 dark:text-white">
            ${t.targetProgress.completed}/${t.targetProgress.target} ${t.targetProgress.unit}
          </div>
          <div class="text-xs text-gray-600 dark:text-gray-300 mt-1">
            ${t.targetProgress.isComplete?"Completed today!":"In progress"}
          </div>
        </div>
      </div>
    `),o+=`
    <div class="stats-section">
      <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Recent Activity</h4>
      <div class="grid grid-cols-2 gap-4">
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.recentActivity}</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Last 30 Days</div>
        </div>
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-sm font-bold text-gray-900 dark:text-white">${Ya(t.lastCompleted)}</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Last Completed</div>
        </div>
      </div>
    </div>
  `,o+="</div>",o}function Ya(e){if(!e)return"Never";const t=new Date(e),o=Math.floor((new Date-t)/(1e3*60*60*24));return o===0?"Today":o===1?"Yesterday":o<7?`${o} days ago`:o<30?`${Math.floor(o/7)} weeks ago`:t.toLocaleDateString()}function Qt(){const e=document.getElementById("completed-section"),t=document.getElementById("skipped-section");e&&e.classList.toggle("collapsed",f.settings.hideCompleted),t&&t.classList.toggle("collapsed",f.settings.hideSkipped);const n=new Date(f.selectedDate),a=f.habits.filter(r=>Kt(r,f.selectedGroup)&&K(r,n)).filter(r=>!Zt(r,n)),s=a.filter(r=>G(r,n)),i=a.length?s.length/a.length*100:0;lo(i)}function co(e){C(t=>{const n=t.habits.find(a=>a.id===e);if(!n)return;const o=new Date(t.selectedDate||Date.now());io(n,o)}),Qt()}function uo(e){const t=document.getElementById(`${e}-section`);if(!t)return;const n=!t.classList.toggle("collapsed");e==="completed"?f.settings.hideCompleted=n:e==="skipped"&&(f.settings.hideSkipped=n);const o=t.querySelector(".toggle-section");o&&(o.textContent=n?"Show ‚åÑ":"Hide ‚åÑ")}function Ua(e,t,n){const o=n?"rounded-b-2xl":"";function a(r){return`<span class="flex items-center gap-1 px-1.5 py-0.5 rounded-md text-black" style="background-color:${t.color}20; color:#000">${r}</span>`}const s=[];if(e.paused)s.push(a("Paused"));else{const r=Pa(e).split(" ‚Ä¢ ")[0];s.push(a(`${Fa(e)} ${r}`)),e.scheduledTime&&s.push(a(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> ${e.scheduledTime}`)),e.activeOnHolidays&&s.push(a('<span class="material-icons text-base leading-none">flight</span>'))}const i=`<div class="habit-meta flex flex-wrap gap-1 text-gray-600 dark:text-gray-400 text-xs -mt-1">${s.join("")}</div>`;return`
    <div class="flex flex-row items-stretch habit-row w-full mb-1">
      <div class="habit-drag-handle drag-handle hidden w-7 h-12 flex items-center justify-center cursor-grab text-gray-400 mr-1">
        <span class="material-icons text-2xl leading-none">drag_handle</span>
      </div>
      <div class="habit-item flex items-center px-4 py-1.5 bg-white dark:bg-gray-800 border-[3px] rounded-xl ${o} flex-grow w-full" style="border-color: ${t.color}" data-habit-id="${e.id}">
        <div class="habit-icon w-8 h-8 rounded-lg flex items-center justify-center mr-4 text-xl" style="background-color: ${t.color}20;">
          ${e.icon||"üìã"}
        </div>
        <div class="habit-content flex-grow">
          <div class="habit-name text-sm font-semibold text-gray-900 dark:text-white">${e.name}</div>
          ${i}
        </div>
        <div class="habit-actions flex items-center gap-2 ml-2">
          <button class="stats-habit-btn w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors" data-habit-id="${e.id}" title="View Stats">
            <span class="material-icons text-lg">bar_chart</span>
          </button>
          <button class="edit-habit-btn flex-shrink-0 w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center" data-habit-id="${e.id}">
            <svg class="w-4 h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/></svg>
          </button>
        </div>
      </div>
    </div>`}function Wa(e,t){let n="";t.length?n=t.map((s,i)=>Ua(s,e,i===t.length-1)).join(""):n='<div class="p-6 text-center text-gray-400 dark:text-gray-500">No habits yet</div>';const o=`<button class="expand-btn h-5 w-5 flex items-center justify-center text-black">
      <span class="material-icons transition-transform leading-none">expand_more</span>
    </button>`,a=`<button class="edit-category-btn w-8 h-8 rounded-full flex items-center justify-center" data-category-id="${e.id}" style="background-color:${e.color}">
      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2"/>
        <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
      </svg>
    </button>`;return`<div class="category-section mb-4" data-category-id="${e.id}">
      <div class="flex items-center gap-2">
        <div class="category-drag-handle drag-handle hidden w-7 h-12 flex items-center justify-center cursor-grab text-gray-400">
          <span class="material-icons text-2xl leading-none">drag_handle</span>
        </div>
        <div class="category-header flex items-center justify-between px-4 py-0 rounded-t-2xl cursor-pointer select-none flex-grow" style="background:${Xe(e.color,.25)};">
          <div class="category-title flex items-center gap-3">
            <span class="font-semibold text-lg leading-none text-black py-1.5">${e.name}</span>
          </div>
          ${o}
        </div>
        ${a}
      </div>
      <div class="category-habits pl-6">${n}</div>
    </div>`}function ht(){var r,l;const e=document.querySelector("#habits-view .habits-content");if(!e)return;let t=e.querySelector("#habits-list-container");t?(t.classList.remove("pb-24","pb-16"),t.classList.add("pb-8")):(t=document.createElement("div"),t.id="habits-list-container",t.className="habits-list flex-grow overflow-y-auto pb-8",e.appendChild(t));const n=(r=e.querySelector("h1.app-title"))==null?void 0:r.parentElement,o=e.querySelector(".action-buttons"),a=e.querySelector(".search-container");t.innerHTML="",e.innerHTML="",n&&e.appendChild(n),e.querySelectorAll("h1.app-title").forEach(c=>{c.classList.remove("text-center","flex-grow"),c.classList.add("text-left","mr-auto")}),o&&(o.querySelectorAll(".new-category-btn, .new-habit-btn").forEach(c=>c.classList.add("font-semibold")),e.appendChild(o)),a&&e.appendChild(a),e.appendChild(t);const s=new Map;f.categories.forEach(c=>s.set(c.id,[])),f.habits.forEach(c=>{s.has(c.categoryId)&&s.get(c.categoryId).push(c)}),f.categories.forEach(c=>{const d=Wa(c,s.get(c.id));t.insertAdjacentHTML("beforeend",d)}),f.categories.length===0&&(t.insertAdjacentHTML("beforeend",`
      <div class="w-full flex flex-col items-center justify-center py-12 mt-6 text-center space-y-2" id="no-category-cta">
        <span class="material-icons text-5xl text-gray-400">create_new_folder</span>
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">No categories yet</h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 max-w-xs mx-auto">Start by creating a category to organise your habits.</p>
        <button class="create-first-category-btn bg-ios-orange text-white px-4 py-3 rounded-xl font-medium hover:bg-orange-600 transition-colors">Create Your First Category</button>
      </div>`),(l=t.querySelector(".create-first-category-btn"))==null||l.addEventListener("click",()=>{M(()=>Promise.resolve().then(()=>no),void 0).then(d=>d.openAddCategoryModal())})),t.querySelectorAll(".habit-item").forEach(c=>{c.addEventListener("click",()=>{const d=c.dataset.habitId;d&&co(d)})}),t.querySelectorAll(".stats-habit-btn").forEach(c=>{c.addEventListener("click",d=>{d.stopPropagation();const g=c.dataset.habitId;g&&Va(g)})}),t.querySelectorAll(".edit-habit-btn").forEach(c=>{c.addEventListener("click",d=>{d.stopPropagation();const g=c.dataset.habitId;g&&M(()=>Promise.resolve().then(()=>ho),void 0).then(y=>y.openEditHabitModal(g))})});function i(c){if(!c)return;const d=c.querySelector(".category-habits");if(!d)return;const g=d.classList.toggle("hidden"),y=c.querySelector(".expand-btn .material-icons");y&&y.classList.toggle("rotate-180",g)}t.querySelectorAll(".expand-btn").forEach(c=>{c.addEventListener("click",d=>{d.stopPropagation(),i(c.closest(".category-section"))})}),t.querySelectorAll(".category-header").forEach(c=>{c.addEventListener("click",d=>{d.target.closest(".expand-btn")||d.target.closest(".edit-category-btn")||i(c.closest(".category-section"))})})}function Xa(){Qt(),ht(),document.querySelectorAll(".toggle-section").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".habits-section");if(t&&t.id){const n=t.id.replace("-section","");uo(n)}})})}const en=Object.freeze(Object.defineProperty({__proto__:null,initializeHabitsList:Xa,renderHabitsView:ht,renderHomeView:Qt,toggleHabitCompletion:co,toggleSectionVisibility:uo},Symbol.toStringTag,{value:"Module"}));let tn="üìã";function vt(){return tn}function nn(e){tn=e}const Ka=["üí™","üèÉ","üö¥","üèä","üßò","‚öñÔ∏è","üçé","ü•ó","üíß","‚òï","ü•õ","üçä","üìö","üìñ","‚úèÔ∏è","üéì","üí°","üß†","üíº","üíª","üì±","üìä","üìù","üìã","üò¥","üõèÔ∏è","üåô","‚è∞","üïê","‚è±Ô∏è","üéµ","üé∏","üé®","üì∑","üéÆ","üéØ","üå±","üå≥","üå∏","üåû","üåç","‚ôªÔ∏è","üë•","üë™","‚ù§Ô∏è","ü§ù","üìû","üí¨","üßº","ü™•","üöø","üíä","üß¥","üéØ","‚úàÔ∏è","üöó","üö∂","üó∫Ô∏è","üéí","üìç","üí∞","üí≥","üíé","üìà","üè¶","üí∏","‚≠ê","üéâ","üî•","‚ö°","‚ú®","üöÄ"];let bn=!1;function xn(e){if(bn)return;const t=e.querySelector("#icon-grid");if(!t)return;const n=document.createDocumentFragment();Ka.forEach(o=>{const a=document.createElement("button");a.className="icon-option w-12 h-12 rounded-xl bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-xl hover:bg-ios-blue hover:text-white transition-all duration-200 hover:scale-105",a.dataset.icon=o,a.textContent=o,n.appendChild(a)}),t.appendChild(n),bn=!0}function Ja(){const e=document.getElementById("icon-selector-btn"),t=document.getElementById("icon-selection-modal"),n=document.getElementById("selected-icon-display");if(!e||!t||!n)return;xn(t);function o(){n.textContent=tn}e.addEventListener("click",()=>{xn(t),t.classList.remove("hidden")}),t.addEventListener("click",r=>{r.target===t&&t.classList.add("hidden")});const a=document.getElementById("select-icon"),s=document.getElementById("cancel-icon");function i(){t.querySelectorAll(".icon-option").forEach(r=>r.classList.remove("ring","ring-ios-blue","ring-2"))}t.addEventListener("click",r=>{const l=r.target.closest(".icon-option");l&&(nn(l.dataset.icon||"üìã"),i(),l.classList.add("ring","ring-ios-blue","ring-2"),a.disabled=!1)}),a==null||a.addEventListener("click",()=>{o(),t.classList.add("hidden")}),s==null||s.addEventListener("click",()=>t.classList.add("hidden")),o()}const _e=new Set,Fe=new Set,ge=new Set,le=new Set,me=new Set,ke=new Set;let ot="each";function gt(e){var t,n,o,a;ot=e,mt(),(t=document.getElementById("monthly-each-btn"))==null||t.classList.toggle("font-semibold",e==="each"),(n=document.getElementById("monthly-on-btn"))==null||n.classList.toggle("font-semibold",e==="on"),(o=document.getElementById("monthly-dates-section"))==null||o.classList.toggle("hidden",e!=="each"),(a=document.getElementById("monthly-combinations-section"))==null||a.classList.toggle("hidden",e!=="on")}function wn(e){document.querySelectorAll(".day-button").forEach(t=>{const n=parseInt(t.dataset.day,10);e.has(n)?t.classList.add("selected"):t.classList.remove("selected")})}function mt(){var a;const e=(a=document.getElementById("frequency-select"))==null?void 0:a.value,t=document.getElementById("days-selection"),n=document.getElementById("monthly-details"),o=document.getElementById("yearly-details");t&&t.classList.toggle("hidden",!(e==="weekly"||e==="biweekly")),n&&n.classList.toggle("hidden",e!=="monthly"),o&&o.classList.toggle("hidden",e!=="yearly"),e==="weekly"?wn(_e):e==="biweekly"&&wn(Fe),e==="monthly"&&xt(),e==="yearly"&&(bt(),Ke())}function Za(e){var s;const t=e.target.closest(".day-button");if(!t)return;const n=parseInt(t.dataset.day,10),o=(s=document.getElementById("frequency-select"))==null?void 0:s.value;if(isNaN(n)||!(o==="weekly"||o==="biweekly"))return;const a=o==="weekly"?_e:Fe;t.classList.toggle("selected")?a.add(n):a.delete(n)}function kn(e){var o;const t=(o=document.getElementById("frequency-select"))==null?void 0:o.value;if(!(t==="weekly"||t==="biweekly"))return;const n=t==="weekly"?_e:Fe;n.clear(),document.querySelectorAll(".day-button").forEach(a=>{e?(a.classList.add("selected"),n.add(parseInt(a.dataset.day,10))):a.classList.remove("selected")})}function Qa(e){if(!e.target.classList.contains("date-button"))return;const t=parseInt(e.target.dataset.date,10);e.target.classList.toggle("selected"),e.target.classList.contains("selected")?ge.add(t):ge.delete(t),xt()}function En(e){ge.clear(),document.querySelectorAll(".date-button").forEach(t=>{e?(t.classList.add("selected"),ge.add(parseInt(t.dataset.date,10))):t.classList.remove("selected")}),xt()}function es(e){if(!e.target.classList.contains("month-button"))return;const t=parseInt(e.target.dataset.month,10);e.target.classList.toggle("selected"),e.target.classList.contains("selected")?me.add(t):me.delete(t),bt()}function ts(e){if(!e.target.classList.contains("yearly-date-button"))return;const t=parseInt(e.target.dataset.date,10);e.target.classList.toggle("selected"),e.target.classList.contains("selected")?ke.add(t):ke.delete(t),Ke()}function Sn(e){me.clear(),document.querySelectorAll(".month-button").forEach(t=>{e?(t.classList.add("selected"),me.add(parseInt(t.dataset.month,10))):t.classList.remove("selected")}),bt()}function In(e){ke.clear(),document.querySelectorAll(".yearly-date-button").forEach(t=>{e?(t.classList.add("selected"),ke.add(parseInt(t.dataset.date,10))):t.classList.remove("selected")}),Ke()}function ns(){var o,a;const e=(o=document.getElementById("ordinal-select"))==null?void 0:o.value,t=(a=document.getElementById("day-of-week-select"))==null?void 0:a.value;if(!e||!t)return;const n=`${e}-${t}`;le.has(n)||(le.add(n),Me())}function Me(){const e=document.getElementById("combinations-list");if(!e)return;if(e.innerHTML="",le.size===0){const n=document.createElement("span");n.textContent="No combinations added yet",n.className="text-gray-500 text-sm",e.appendChild(n);return}const t=document.createElement("div");t.className="space-y-2",le.forEach(n=>{const[o,a]=n.split("-"),s=document.createElement("div");s.className="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 w-full";const i=document.createElement("span");i.className="text-gray-900 dark:text-white text-sm font-semibold",i.textContent=`${W(o)} ${W(a)}`;const r=document.createElement("button");r.className="w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center flex-shrink-0 ml-3",r.innerHTML="√ó",r.onclick=()=>{le.delete(n),Me()},s.appendChild(i),s.appendChild(r),t.appendChild(s)}),e.appendChild(t)}function bt(){const e=document.getElementById("selected-months-count");e&&(e.textContent=me.size)}function xt(){const e=document.getElementById("selected-dates-count");e&&(e.textContent=ge.size)}function Ke(){const e=document.getElementById("selected-yearly-dates-count");e&&(e.textContent=ke.size)}function os(){var e,t,n,o,a,s,i,r,l,c,d,g,y,u,m,b;go(),mo(),as(),ss(),rs(),Cn("month-interval-select",12),Cn("year-interval-select",5),is(),et("month-interval-select","month-text","month","months"),et("year-interval-select","year-text","year","years"),(e=document.getElementById("frequency-select"))==null||e.addEventListener("change",mt),document.addEventListener("click",Za),(t=document.getElementById("select-all-days"))==null||t.addEventListener("click",()=>kn(!0)),(n=document.getElementById("clear-all-days"))==null||n.addEventListener("click",()=>kn(!1)),(o=document.getElementById("monthly-each-btn"))==null||o.addEventListener("click",()=>gt("each")),(a=document.getElementById("monthly-on-btn"))==null||a.addEventListener("click",()=>gt("on")),document.addEventListener("click",Qa),(s=document.getElementById("select-all-dates"))==null||s.addEventListener("click",()=>En(!0)),(i=document.getElementById("clear-dates"))==null||i.addEventListener("click",()=>En(!1)),(r=document.getElementById("add-combination-btn"))==null||r.addEventListener("click",ns),(l=document.getElementById("clear-all-combinations"))==null||l.addEventListener("click",()=>{le.clear(),Me()}),document.addEventListener("click",es),document.addEventListener("click",ts),(c=document.getElementById("select-all-months"))==null||c.addEventListener("click",()=>Sn(!0)),(d=document.getElementById("clear-months"))==null||d.addEventListener("click",()=>Sn(!1)),(g=document.getElementById("select-all-yearly-dates"))==null||g.addEventListener("click",()=>In(!0)),(y=document.getElementById("clear-yearly-dates"))==null||y.addEventListener("click",()=>In(!1)),(u=document.getElementById("yearly-specify-dates-toggle"))==null||u.addEventListener("change",Ln),mt(),Ln(),Me(),bt(),xt(),Ke(),(m=document.getElementById("month-interval-select"))==null||m.addEventListener("change",()=>et("month-interval-select","month-text","month","months")),(b=document.getElementById("year-interval-select"))==null||b.addEventListener("change",()=>et("year-interval-select","year-text","year","years"))}function go(){const e=document.getElementById("monthly-date-grid");if(!e||e.childElementCount)return;const t=document.createDocumentFragment();for(let n=1;n<=31;n++){const o=document.createElement("button");o.className="date-button w-full aspect-square rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white font-medium text-sm hover:border-ios-blue hover:bg-ios-blue/5 transition-all",o.dataset.date=n,o.textContent=n,t.appendChild(o)}e.appendChild(t)}function mo(){const e=document.getElementById("yearly-month-grid");if(!e||e.childElementCount)return;const t=Yt,n=document.createDocumentFragment();t.forEach((o,a)=>{const s=document.createElement("button");s.className="month-button w-full py-3 rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white font-medium text-sm hover:border-ios-blue hover:bg-ios-blue/10 transition-colors selected:border-[#007AFF] selected:bg-[#007AFF] selected:text-white",s.dataset.month=a,s.textContent=o,n.appendChild(s)}),e.appendChild(n)}function as(){const e=document.getElementById("yearly-date-grid");if(!e||e.childElementCount)return;const t=document.createDocumentFragment();for(let n=1;n<=31;n++){const o=document.createElement("button");o.className="yearly-date-button w-full aspect-square rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white font-medium text-sm hover:border-ios-blue hover:bg-ios-blue/10 transition-colors selected:border-[#007AFF] selected:bg-[#007AFF] selected:text-white",o.dataset.date=n,o.textContent=n,t.appendChild(o)}e.appendChild(t)}function ss(){const e=document.getElementById("weekly-day-grid");if(!e||e.childElementCount)return;const t=["S","M","T","W","T","F","S"],n=document.createDocumentFragment();t.forEach((o,a)=>{const s=document.createElement("button");s.className="day-button flex-1 h-12 rounded-lg border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-medium text-sm hover:border-ios-blue transition-colors selected:border-[#007AFF] selected:bg-[#007AFF] selected:text-white",s.dataset.day=a,s.textContent=o,n.appendChild(s)}),e.appendChild(n)}function Ln(){var t,n;const e=((t=document.getElementById("yearly-specify-dates-toggle"))==null?void 0:t.checked)??!1;(n=document.getElementById("yearly-dates-section"))==null||n.classList.toggle("hidden",!e),e||(ke.clear(),document.querySelectorAll(".yearly-date-button.selected").forEach(o=>o.classList.remove("selected")),Ke())}function Cn(e,t){const n=document.getElementById(e);if(!(!n||n.dataset.enhanced)){for(let o=1;o<=t;o++){const a=document.createElement("option");a.value=o,a.textContent=o,n.appendChild(a)}n.dataset.enhanced="1"}}function et(e,t,n,o){var i;const a=parseInt(((i=document.getElementById(e))==null?void 0:i.value)||"1",10),s=document.getElementById(t);s&&(s.textContent=a===1?n:o)}function is(){const e=document.getElementById("ordinal-select"),t=document.getElementById("day-of-week-select");e&&!e.dataset.enhanced&&(e.innerHTML="",ya.forEach(n=>{const o=document.createElement("option");o.value=n,o.textContent=W(n),e.appendChild(o)}),e.dataset.enhanced="1"),t&&!t.dataset.enhanced&&(t.innerHTML="",fa.forEach(n=>{const o=document.createElement("option");o.value=n,o.textContent=W(n),t.appendChild(o)}),t.dataset.enhanced="1")}function rs(){const e=document.getElementById("frequency-select");!e||e.dataset.enhanced||(e.innerHTML="",Qn.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=W(t),e.appendChild(n)}),e.dataset.enhanced="1")}function ls(){const e=document.getElementById("target-unit-select");!e||e.dataset.enhanced||(ma.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=W(t),e.appendChild(n)}),e.dataset.enhanced="1")}function cs(){const e=document.getElementById("target-frequency-select");!e||e.dataset.enhanced||(e.innerHTML="",Qn.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=W(t),e.appendChild(n)}),e.dataset.enhanced="1")}function at(){var s,i,r;const e=document.getElementById("target-example-text");if(!e)return;const t=((s=document.getElementById("target-frequency-select"))==null?void 0:s.value)||"daily",n=((i=document.getElementById("target-value-input"))==null?void 0:i.value)||"1",o=((r=document.getElementById("target-unit-select"))==null?void 0:r.value)||"none",a=o==="none"?"":` ${o}`;e.textContent=`Example: ${n}${a} each ${t}`}function ds(){cs(),ls(),["target-frequency-select","target-value-input","target-unit-select"].forEach(e=>{var t,n;(t=document.getElementById(e))==null||t.addEventListener("input",at),(n=document.getElementById(e))==null||n.addEventListener("change",at)}),at()}let ue=null;function yo(){ue=null,fo();const e=document.getElementById("delete-habit-btn");e&&e.classList.add("hidden"),Z("add-habit-modal")}function ze(){z("add-habit-modal"),ue=null}function us(e){var s;const t=f.habits.find(i=>i.id===e);if(!t)return;ue=e,fo();const n=ys();n&&n.classList.remove("hidden"),document.getElementById("habit-modal-title").textContent="Edit Habit",document.getElementById("habit-modal-desc").textContent="Update habit details",document.getElementById("habit-name-input").value=t.name,document.getElementById("habit-category-select").value=t.categoryId,document.getElementById("frequency-select").value=t.frequency;const o=document.getElementById("frequency-select");if(o){const i=typeof t.target=="number"&&t.target>0;o.value=i?"daily":t.frequency}if(t.days){const i=t.frequency==="biweekly"?Fe:_e;t.days.forEach(r=>i.add(r)),document.querySelectorAll(".day-button").forEach(r=>{t.days.includes(parseInt(r.dataset.day,10))&&r.classList.add("selected")})}if(t.monthly&&(gt(t.monthly.mode||"each"),document.getElementById("month-interval-select").value=t.monthly.interval||1,t.monthly.mode==="each"&&t.monthly.dates?(t.monthly.dates.forEach(i=>ge.add(i)),document.querySelectorAll(".date-button").forEach(i=>{t.monthly.dates.includes(parseInt(i.dataset.date,10))&&i.classList.add("selected")})):t.monthly.mode==="on"&&t.monthly.combinations&&(t.monthly.combinations.forEach(i=>le.add(i)),Me())),t.months&&(t.months.forEach(i=>me.add(i)),document.querySelectorAll(".month-button").forEach(i=>{t.months.includes(parseInt(i.dataset.month,10))&&i.classList.add("selected")}),document.getElementById("year-interval-select").value=t.yearInterval||1),t.scheduledTime){document.getElementById("anytime-toggle").checked=!1;const[i,r]=t.scheduledTime.split(":");document.getElementById("hour-select").value=i,document.getElementById("minute-select").value=r,document.getElementById("selected-time").textContent=t.scheduledTime,document.getElementById("time-selection").classList.remove("hidden")}document.getElementById("pause-habit-toggle").checked=!!t.paused,document.getElementById("holidays-toggle").checked=!!t.activeOnHolidays,nn(t.icon||"üìã");const a=document.getElementById("selected-icon-display");if(a&&(a.textContent=vt()),t.target){document.getElementById("completion-target-section").classList.remove("hidden"),document.getElementById("target-frequency-select").value=t.targetFrequency||t.frequency,document.getElementById("target-value-input").value=t.target,document.getElementById("target-unit-select").value=t.targetUnit||"none";const i=document.getElementById("default-increment-input");i&&(i.value=t.defaultIncrement||1),(s=document.getElementById("completion-target-tab"))==null||s.click()}mt(),at(),st(),Z("add-habit-modal")}function fo(){var t;document.getElementById("habit-modal-title").textContent="New Habit",document.getElementById("habit-modal-desc").textContent="Add a new habit to track your progress",document.getElementById("habit-name-input").value="",document.getElementById("habit-category-select").value="",document.getElementById("frequency-select").value="daily",document.getElementById("anytime-toggle").checked=!0,document.getElementById("time-selection").classList.add("hidden"),document.getElementById("selected-time").textContent="09:00",document.getElementById("hour-select").value="09",document.getElementById("minute-select").value="00",_e.clear(),Fe.clear(),ge.clear(),le.clear(),me.clear(),ke.clear(),document.querySelectorAll(".day-button, .date-button, .month-button, .yearly-date-button").forEach(n=>n.classList.remove("selected")),Me(),gt("each"),document.getElementById("month-interval-select").value="1",document.getElementById("year-interval-select").value="1",document.getElementById("completion-target-section").classList.add("hidden"),document.getElementById("target-frequency-select").value="daily",document.getElementById("target-value-input").value="1",document.getElementById("target-unit-select").value="none",document.getElementById("default-increment-input").value="1",document.getElementById("pause-habit-toggle").checked=!1,document.getElementById("holidays-toggle").checked=!1,nn("üìã");const e=document.getElementById("selected-icon-display");if(e&&(e.textContent=vt()),(t=document.getElementById("schedule-tab"))==null||t.click(),window._preselectCategoryId){const n=document.getElementById("habit-category-select");n&&(n.value=window._preselectCategoryId),window._preselectCategoryId=void 0}Se()}function po(){var c,d,g;Se(),Ea(),go(),mo(),document.addEventListener("click",y=>{y.target.closest(".new-habit-btn")&&(y.preventDefault(),yo())}),(c=document.getElementById("cancel-habit"))==null||c.addEventListener("click",ze),(d=document.getElementById("save-habit"))==null||d.addEventListener("click",ms);const e=document.getElementById("create-category-btn");e&&e.addEventListener("click",()=>{window._returnToHabit=!0,ze(),M(()=>Promise.resolve().then(()=>no),void 0).then(y=>y.openAddCategoryModal())});const t=document.getElementById("habit-name-input"),n=document.getElementById("habit-category-select");t==null||t.addEventListener("input",st),n==null||n.addEventListener("change",st),os(),ds();function o(){var u,m;const y=((u=document.getElementById("anytime-toggle"))==null?void 0:u.checked)??!0;(m=document.getElementById("time-selection"))==null||m.classList.toggle("hidden",y)}(g=document.getElementById("anytime-toggle"))==null||g.addEventListener("change",o),o();const a=document.getElementById("schedule-tab"),s=document.getElementById("completion-target-tab"),i=document.getElementById("schedule-section"),r=document.getElementById("completion-target-section");function l(y){if(!a||!s||!i||!r)return;const u=["bg-white","dark:bg-gray-600","text-gray-900","dark:text-white","shadow-sm"],m=["text-gray-600","dark:text-gray-400"];y==="schedule"?(a.classList.add(...u),a.classList.remove(...m),s.classList.remove(...u),s.classList.add(...m),i.classList.remove("hidden"),r.classList.add("hidden")):(s.classList.add(...u),s.classList.remove(...m),a.classList.remove(...u),a.classList.add(...m),r.classList.remove("hidden"),i.classList.add("hidden"))}a==null||a.addEventListener("click",()=>l("schedule")),s==null||s.addEventListener("click",()=>l("target")),l("schedule"),st(),Ja()}function st(){const e=document.getElementById("save-habit"),t=document.getElementById("habit-name-input"),n=document.getElementById("habit-category-select");if(!e||!t||!n)return;const o=t.value.trim().length>0&&n.value!=="";e.disabled=!o,e.classList.toggle("opacity-50",!o)}function gs(){var e,t,n,o,a,s,i,r,l,c;return{name:(e=document.getElementById("habit-name-input"))==null?void 0:e.value.trim(),categoryId:((t=document.getElementById("habit-category-select"))==null?void 0:t.value)||null,frequency:((n=document.getElementById("frequency-select"))==null?void 0:n.value)||"daily",anytime:((o=document.getElementById("anytime-toggle"))==null?void 0:o.checked)??!0,hour:((a=document.getElementById("hour-select"))==null?void 0:a.value)||"09",minute:((s=document.getElementById("minute-select"))==null?void 0:s.value)||"00",monthInterval:parseInt(((i=document.getElementById("month-interval-select"))==null?void 0:i.value)||"1",10),yearInterval:parseInt(((r=document.getElementById("year-interval-select"))==null?void 0:r.value)||"1",10),paused:((l=document.getElementById("pause-habit-toggle"))==null?void 0:l.checked)??!1,activeOnHolidays:((c=document.getElementById("holidays-toggle"))==null?void 0:c.checked)??!1,icon:vt(),progress:{},skippedDates:[]}}function ms(){var r,l,c;const e=gs();if(!e.name||!e.categoryId)return;const t=document.getElementById("completion-target-section"),n=document.getElementById("target-value-input"),o=t&&!t.classList.contains("hidden")&&n&&parseInt(n.value||"0",10)>0,a=document.getElementById("default-increment-input"),s=a?parseInt(a.value||"1",10):1,i={id:We(),name:e.name,categoryId:e.categoryId,frequency:e.frequency,days:e.frequency==="weekly"?Array.from(_e):e.frequency==="biweekly"?Array.from(Fe):void 0,scheduledTime:e.anytime?null:`${e.hour}:${e.minute}`,monthly:e.frequency==="monthly"?{interval:e.monthInterval,mode:ot,dates:ot==="each"?Array.from(ge):void 0,combinations:ot==="on"?Array.from(le):void 0}:void 0,months:e.frequency==="yearly"?Array.from(me):void 0,yearInterval:e.frequency==="yearly"?e.yearInterval:void 0,completed:!1,paused:e.paused,activeOnHolidays:e.activeOnHolidays,icon:vt(),progress:e.progress,skippedDates:e.skippedDates};o?(i.target=parseInt(((r=document.getElementById("target-value-input"))==null?void 0:r.value)||"1",10),i.targetFrequency=((l=document.getElementById("target-frequency-select"))==null?void 0:l.value)||void 0,i.targetUnit=((c=document.getElementById("target-unit-select"))==null?void 0:c.value)||"none",i.defaultIncrement=s,delete i.days,delete i.monthly,delete i.months,delete i.yearInterval):(delete i.target,delete i.targetFrequency,delete i.targetUnit,delete i.defaultIncrement),C(ue?d=>{const g=d.habits.findIndex(y=>y.id===ue);if(g>=0){const y={...d.habits[g],...i,id:ue};y.progress=d.habits[g].progress,y.skippedDates=d.habits[g].skippedDates,o?(delete y.days,delete y.monthly,delete y.months,delete y.yearInterval):(delete y.target,delete y.targetFrequency,delete y.targetUnit,delete y.defaultIncrement),d.habits[g]=y}}:d=>d.habits.push(i)),ze(),ht()}function ys(){const e=document.querySelector("#add-habit-modal .flex-1");if(!e)return null;let t=document.getElementById("delete-habit-btn");if(!t){t=document.createElement("button"),t.id="delete-habit-btn",t.textContent="Delete Habit",t.className="w-full py-3 px-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl text-red-600 dark:text-red-400 font-medium hover:bg-red-100 dark:hover:bg-red-900/30 transition-all duration-200 mt-4",t.addEventListener("click",fs);const n=e.querySelector(".h-4:last-child");n?n.before(t):e.appendChild(t)}return t}function fs(){ue&&Gt({title:"Delete Habit?",message:"This habit will be permanently removed. This action cannot be undone.",okText:"Delete",onOK:()=>{C(e=>{e.habits=e.habits.filter(t=>t.id!==ue)}),ze(),ht()}})}const ho=Object.freeze(Object.defineProperty({__proto__:null,closeAddHabitModal:ze,initializeHabitsForm:po,openAddHabitModal:yo,openEditHabitModal:us},Symbol.toStringTag,{value:"Module"}));function vo(e){if(!e)return;const t=e.parentElement;if(!t)return;const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=o.left-n.left-(n.width/2-o.width/2);let s=t.scrollLeft+a;if(s<0){const i=parseFloat(getComputedStyle(t).paddingLeft)||0;t.style.paddingLeft=`${i+Math.abs(s)}px`,s=0}t.scrollTo({left:s,behavior:"smooth"})}const bo="fitnessRestDays";function xo(){try{const e=localStorage.getItem(bo);return e?JSON.parse(e):[]}catch{return[]}}function ps(e){localStorage.setItem(bo,JSON.stringify(e))}function Y(e){return xo().includes(e)}function pe(e){const t=xo(),n=t.indexOf(e);n===-1?t.push(e):t.splice(n,1),ps(t)}var Vn,zn;if(typeof window<"u"&&((zn=(Vn=window.process)==null?void 0:Vn.env)==null?void 0:zn.NODE_ENV)==="test"){console.group("üß™ Testing restDays utility...");const e="2099-01-01";pe(e),console.assert(Y(e),"Should be rest day after toggle on"),pe(e),console.assert(!Y(e),"Should not be rest day after toggle off");const t=["2024-01-01","2024-01-02","2024-01-03"];t.forEach(i=>pe(i)),t.forEach(i=>{console.assert(Y(i),`Day ${i} should be rest day`)}),["2024-01-04","2024-01-05"].forEach(i=>{console.assert(!Y(i),`Day ${i} should not be rest day`)}),console.assert(!Y("invalid-date"),"Invalid date should not be rest day"),console.assert(!Y(""),"Empty string should not be rest day"),console.assert(!Y(null),"Null should not be rest day");const o=localStorage.getItem,a=localStorage.setItem,s={};localStorage.getItem=i=>s[i],localStorage.setItem=(i,r)=>{s[i]=r},pe("2024-12-25"),console.assert(Y("2024-12-25"),"Rest day should persist in storage"),localStorage.getItem=o,localStorage.setItem=a,t.forEach(i=>pe(i)),pe("2024-12-25"),console.log("‚úÖ All restDays utility tests passed!"),console.groupEnd()}const de={};function wo({container:e,stateKey:t="currentDate",onDateChange:n}={}){if(!e)throw new Error("[calendar] mountCalendar: container is required");let o=e.querySelector(".week-days");o||(o=document.createElement("div"),o.className="week-days",e.appendChild(o));function a(){return new Date(f[t])}function s(u){C(m=>{if(t==="fitnessSelectedDate"){const b=u.getFullYear(),p=String(u.getMonth()+1).padStart(2,"0"),v=String(u.getDate()).padStart(2,"0"),x=`${b}-${p}-${v}T00:00:00.000Z`;m[t]=x}else m[t]=u.toISOString()}),typeof n=="function"&&n(u)}function i(u){vo(u)}function r(){o.innerHTML="";const u=a(),m=f.selectedGroup||"daily";de[m]||(de[m]=Bn(u,m));const b=new Date(de[m]);let p=new Date(b);const v=new Date(b);m==="yearly"?v.setFullYear(v.getFullYear()+15):m==="monthly"?v.setMonth(v.getMonth()+24):v.setDate(v.getDate()+730);const x=h=>ao(h,m,1),L=Bn(u,m);for(L<de[m]&&(de[m]=new Date(L),p=new Date(de[m]));p<=v;){const h=Dn(p),k=document.createElement("div");if(k.className="day-item",m==="yearly"&&(k.style.paddingTop="16px",k.style.paddingBottom="16px"),t==="fitnessSelectedDate"){const H=p.getFullYear(),D=String(p.getMonth()+1).padStart(2,"0"),F=String(p.getDate()).padStart(2,"0"),St=`${H}-${D}-${F}T00:00:00.000Z`;k.dataset.date=St}else k.dataset.date=p.toISOString();k.innerHTML=`<span class="day-name block text-xs">${h.name}</span>
                      <span class="day-number block text-lg font-semibold">${h.number}</span>
                      <span class="day-month text-xs mt-0.5 ${h.month?"":"hidden"}">${h.month}</span>`;const w=Le(p,new Date,m),T=Le(p,u,m);if(T?k.classList.add("current-day"):w&&k.classList.add("today"),Tn(k,m,T),t!=="fitnessSelectedDate"){const H=m==="daily"&&ct(U(p));k.classList.toggle("holiday",H);const D=!!k.querySelector(".holiday-icon");H&&!D?k.insertAdjacentHTML("beforeend",'<span class="material-icons holiday-icon">flight</span>'):!H&&D&&k.querySelector(".holiday-icon").remove()}if(t==="fitnessSelectedDate"){const H=ie(p),D=Y(H);k.classList.toggle("rest-day",D);const F=k.querySelector(".rest-icon");D&&!F?k.insertAdjacentHTML("beforeend",'<span class="material-icons rest-icon block mt-0.5 text-lg">bed</span>'):!D&&F&&F.remove()}o.appendChild(k),x(p)}o.scrollLeft=0;const E=o.querySelector(".day-item");if(E){const h=e.getBoundingClientRect().width,k=E.getBoundingClientRect().width;o.style.paddingLeft=`${Math.max(0,h/2-k/2)}px`}}function l(){const u=f.selectedGroup||"daily";e.classList.toggle("weekly-group",u==="weekly");const m=a(),b=new Date;o.querySelectorAll(".day-item").forEach(p=>{const v=new Date(p.dataset.date),x=Le(v,m,u),L=Le(v,b,u);p.classList.toggle("current-day",x),p.classList.toggle("today",L&&!x);const E=Dn(new Date(p.dataset.date)),h=p.querySelector(".day-name"),k=p.querySelector(".day-number"),w=p.querySelector(".day-month");if(h&&(h.textContent=E.name,h.style.display=E.name?"":"none"),k&&(k.textContent=E.number),w&&(w.textContent=E.month,w.style.display=E.month?"":"none"),f.selectedGroup==="daily"&&w&&(v.getDate()===1||x||L?(w.textContent=new Date(v).toLocaleString("en-US",{month:"short"}),w.style.display=""):w.style.display="none"),t!=="fitnessSelectedDate"){const T=u==="daily"&&ct(U(v));p.classList.toggle("holiday",T);const H=!!p.querySelector(".holiday-icon");T&&!H?p.insertAdjacentHTML("beforeend",'<span class="material-icons holiday-icon">flight</span>'):!T&&H&&p.querySelector(".holiday-icon").remove()}if(t==="fitnessSelectedDate"){const T=ie(v),H=Y(T);p.classList.toggle("rest-day",H);const D=p.querySelector(".rest-icon");H&&!D?p.insertAdjacentHTML("beforeend",'<span class="material-icons rest-icon block mt-0.5 text-lg">bed</span>'):!H&&D&&D.remove()}if(f.selectedGroup==="yearly"){const T=x?22:16;p.style.paddingTop=T+"px",p.style.paddingBottom=T+"px"}Tn(p,f.selectedGroup,x)})}function c(u){const m=u.target.closest(".day-item");if(!m)return;const b=new Date(m.dataset.date);s(b),l(),i(m)}r(),l();const d=o.querySelector(".day-item.current-day");d&&setTimeout(()=>i(d),10),o.addEventListener("click",c),e.querySelectorAll(".nav-arrow").forEach(u=>{u.addEventListener("click",()=>{let m=a();const b=f.selectedGroup||"daily",p=u.classList.contains("prev-week"),v=u.classList.contains("next-week");if(p||v){const E=p?-1:1;switch(b){case"weekly":m.setDate(m.getDate()+E*28);break;case"monthly":m.setMonth(m.getMonth()+E*6);break;case"yearly":m.setFullYear(m.getFullYear()+E*5);break;case"daily":default:m.setDate(m.getDate()+E*7);break}}else if(u.classList.contains("prev-day")||u.classList.contains("next-day")){const E=u.classList.contains("prev-day")?-1:1;switch(b){case"weekly":m.setDate(m.getDate()+E*7);break;case"monthly":m.setMonth(m.getMonth()+E);break;case"yearly":m.setFullYear(m.getFullYear()+E);break;case"daily":default:m.setDate(m.getDate()+E)}}const x=de[b]?new Date(de[b]):null;x&&m<x&&(m=new Date(x)),s(m),l();const L=o.querySelector(".day-item.current-day");L&&i(L)})});const g=e.querySelector(".today-btn");g&&g.addEventListener("click",()=>{s(new Date),l();const m=o.querySelector(".day-item.current-day");m&&i(m)});let y=f.selectedGroup;return{refresh:()=>{const u=f.selectedGroup;u!==y&&(r(),y=u),l();const m=o.querySelector(".day-item.current-day");m&&i(m)}}}function Dn(e){const t=f.selectedGroup||"daily",n=e.getFullYear(),o=String(n).slice(-2),a=Yt[e.getMonth()];switch(t){case"weekly":return{name:String(n),number:`W${$e(e)}`,month:""};case"monthly":return{name:a,number:o,month:""};case"yearly":return{name:"",number:o,month:""};case"daily":default:return{name:eo[e.getDay()],number:e.getDate(),month:e.getDate()===1?a:""}}}function Bn(e,t=f.selectedGroup||"daily"){const n=new Date(e);switch(t){case"weekly":{const a=(n.getDay()+6)%7;return n.setDate(n.getDate()-a),n.setHours(0,0,0,0),n}case"monthly":return n.setDate(1),n.setHours(0,0,0,0),n;case"yearly":return n.setMonth(0,1),n.setHours(0,0,0,0),n;case"daily":default:return n.setHours(0,0,0,0),n}}function Tn(e,t,n=!1){if(e&&t!=="daily"){if(t==="weekly"){const o=n?8:4;e.style.paddingTop=o+"px",e.style.paddingBottom=o+"px";return}if(t==="monthly"){const o=n?16:12;e.style.paddingTop=o+"px",e.style.paddingBottom=o+"px";return}if(t==="yearly"){const o=n?"22px":"18px";e.style.paddingTop=o,e.style.paddingBottom=o}}}function ko(e,t,n,{onRestore:o=()=>{}}={}){var m;let a=0,s=0,i=0,r=!1,l=0,c=null;function d(b){t.style.transform=`translateX(${b}px)`}function g(b){const p=b.touches?b.touches[0]:b;a=p.clientX,s=p.clientY,i=0,r=!1,l=e.offsetWidth*.2,c=b.pointerId!==void 0?b.pointerId:null,b.pointerId!==void 0&&t.setPointerCapture&&t.setPointerCapture(b.pointerId)}function y(b){if(c!==null&&b.pointerId!==c)return;const p=b.touches?b.touches[0]:b,v=p.clientX-a,x=p.clientY-s;if(!r)if(Math.abs(v)>12&&Math.abs(v)>Math.abs(x))r=!0,t.style.transition="none";else return;i=v,i>0&&(i=0),i<-l&&(i=-l),d(i)}function u(b){c!==null&&b.pointerId!==c||r&&(r=!1,t.style.transition="transform 0.2s",Math.abs(i)>l/2?d(-l):d(0),b.pointerId!==void 0&&t.releasePointerCapture&&t.releasePointerCapture(b.pointerId),c=null)}t.style.cursor="grab",t.style.touchAction="pan-y",t.addEventListener("pointerdown",g),t.addEventListener("pointermove",y),t.addEventListener("pointerup",u),t.addEventListener("touchmove",b=>{r&&b.preventDefault()},{passive:!1}),(m=e.querySelector(".restore-btn"))==null||m.addEventListener("click",()=>{o(),d(0)})}const hs=["daily","weekly","monthly","yearly"];function vs(){var o;const e=document.querySelector("#home-view .progress-section");if(!e)return;let t=e.querySelector(".progress-pills");t||(t=document.createElement("div"),t.className="progress-pills absolute right-4 top-1/2 -translate-y-1/2 flex flex-col items-center gap-1",e.appendChild(t)),t.innerHTML="";const n=new Date(f.selectedDate);(o=e.querySelector(".weekly-progress"))==null||o.remove(),hs.forEach(a=>{if(a===f.selectedGroup)return;const s=f.habits.filter(u=>Kt(u,a)&&K(u,n));if(s.length===0)return;const i=s.filter(u=>!u.paused);if(i.length===0)return;const r=i.filter(u=>!Zt(u,n));if(r.length===0)return;const l=r.filter(u=>G(u,n)),c=Math.round(l.length/r.length*100),d=document.createElement("span");d.className="progress-pill relative overflow-hidden px-4 py-1.5 rounded-full text-xs font-medium",d.textContent=`${W(a)} (${c}%)`;const g=ro(c),y="#e5e5e7";d.style.background=`linear-gradient(to right, ${g} ${c}%, ${y} ${c}%)`,d.style.color="#000",d.style.border="1px solid #4B5563",t.appendChild(d)}),t.style.display=t.children.length?"flex":"none"}const Ne=["daily","weekly","monthly","yearly"],Eo={daily:"today",weekly:"view_week",monthly:"date_range",yearly:"event"},{belongsToSelectedGroup:wt,isHabitScheduledOnDate:on,getPeriodKey:yt,isHabitCompleted:he,setHabitCompleted:So,toggleHabitCompleted:bs,isHabitSkippedToday:je}=$a,Tt={Completed:!1,Skipped:!1},ee=JSON.parse(localStorage.getItem("sectionVisibility")||'{"Completed":true,"Skipped":true}');function An(){localStorage.setItem("sectionVisibility",JSON.stringify(ee))}let it=null;function Io(){if(typeof window>"u")return;const e=document.querySelector("#home-view .habits-container");if(!e)return;const t=e.getBoundingClientRect();let n=0;const o=document.querySelector("#home-view").closest(".content-area");if(o){const s=window.getComputedStyle(o);n=parseFloat(s.paddingBottom)||0}const a=window.innerHeight-t.top-n;a>0&&(e.style.maxHeight=a+"px",e.style.overflowY="auto")}function Lo(){const e=document.querySelector("#home-view .habits-container");if(!e)return;const t=e.querySelector(".habits-header");e.innerHTML="",t&&e.appendChild(t);const n=new Date(f.selectedDate),o=f.selectedGroup,a=f.habits.filter(p=>wt(p,o)&&on(p,n));if(a.length===0){const p=document.createElement("div");p.className="empty-placeholder flex flex-col items-center justify-center py-10 mt-6 text-gray-400";const x={daily:"No Scheduled Habits Today",weekly:"No Scheduled Habits This Week",monthly:"No Scheduled Habits This Month",yearly:"No Scheduled Habits This Year"}[o]||"No Scheduled Habits";p.innerHTML=`
      <div class="w-[4.5rem] h-[4.5rem] rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4">
        <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24">
          <path d="M9 17l-4-4 1.41-1.41L9 14.17l8.59-8.59L19 7l-10 10z"/>
        </svg>
      </div>
      <p class="text-lg font-medium">${x}</p>`,e.appendChild(p);return}const s=a.filter(p=>!he(p,n)&&je(p,n)),i=a.filter(p=>!he(p,n)&&!je(p,n)),r=i.filter(p=>!p.scheduledTime),l=i.filter(p=>p.scheduledTime),c=a.filter(p=>he(p,n)),d=document.createDocumentFragment();function g(p,v){if(p==="Completed"&&!ee.Completed||p==="Skipped"&&!ee.Skipped)return null;const x=document.createElement("div"),L=p==="Completed"||p==="Skipped";x.className="habits-section"+(L?" collapsible":""),L&&(x.id=p.toLowerCase()+"-section"),x.style.paddingTop="0.5rem",x.style.paddingBottom="0.5rem";let E=`<h3 class="section-label text-base font-semibold m-0">${p}${L?` <span class="opacity-60">(${v.length})</span>`:""}</h3>`;if(L){const h=Tt[p]||!1;E+=`<button class="toggle-section flex items-center gap-1 text-sm font-medium select-none ml-auto self-start p-0 bg-none border-none outline-none cursor-pointer" style="user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;"><span style="user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;">${h?"Show":"Hide"}</span><svg class="w-4 h-4 transition-transform duration-200" viewBox="0 0 24 24" stroke="currentColor" fill="none" ${h?"transform rotate-180":""}>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>`}if(x.innerHTML=`<div class="section-header flex items-center mb-0.5 home-inset">${E}</div>`,v.length===0)return null;if(L&&Tt[p]&&x.classList.add("collapsed"),v.forEach(h=>{let k;const w=document.createElement("div");w.className="habit-card flex items-center px-4 py-2 rounded-xl",w.style.marginBottom="0",w.dataset.habitId=h.id,w.style.width="100%";const T=typeof h.target=="number"&&h.target>0,H=yt(h,n);let D=T&&h.progress&&h.progress[H]||0;const F=f.categories.find(_=>_.id===h.categoryId)||{color:"#888"},St=`<div class="habit-icon w-9 h-9 flex-shrink-0 rounded-full flex items-center justify-center mr-1 text-xl" style="border:2px solid ${F.color}; color:${F.color}">${h.icon||"üìã"}</div>`;let It=`<div class="habit-content flex-grow">
          <div class="habit-name font-semibold leading-tight">${h.name}</div>`;It+=`<span class="category-pill inline-block whitespace-nowrap px-2 py-0.5 rounded-lg text-xs font-medium mt-0" style="display:inline-block;width:max-content;background:${F.color};color:#fff;border-radius:8px;">${F.name||""}</span>`;let cn="",Q=null;if(T){w.style.position="relative";const _=S=>{w.style.background=Ra(F.color,S)};_(h.target?Math.min(D/h.target,1):0);const I=document.createElement("div");I.className="progress-box px-2 py-0.5 text-xs font-bold rounded-md mb-1",I.style.border=`1px solid ${F.color}`,I.style.color="#000",I.textContent=`${D}/${h.target}`;const B=h.targetUnit&&h.targetUnit!=="none"?h.targetUnit:null;if(Q=document.createElement("div"),Q.className="ml-auto flex flex-col items-end",Q.style.position="relative",Q.style.zIndex="1",Q.appendChild(I),I.style.background="#FFFFFF",B){const S=document.createElement("span");S.className="unit-pill whitespace-nowrap px-2 py-0.5 rounded-lg text-xs font-medium",S.style.background=`${F.color}`,S.style.color="#fff",S.textContent=B,Q.appendChild(S)}const P=()=>{if(w.dataset.editing==="1")return;w.dataset.editing="1";const S=w.querySelector(".habit-content");S&&(S.style.display="none"),Q.style.display="none";const A=document.createElement("div");A.className="edit-controls flex items-center gap-2 mx-auto",A.style.transform="translateX(-28px)";const j=document.createElement("button");j.className="minus-edit rounded-full flex items-center justify-center font-extrabold text-white border-2 border-black",j.style.background="#DC2626",j.style.fontSize="1.8rem",j.style.width="44px",j.style.height="44px",j.textContent="‚àí";let ne=h.defaultIncrement||1;const $=document.createElement("div");$.className="value-box px-4 border-2 border-black bg-white text-xl font-bold rounded-lg cursor-pointer select-none flex items-center justify-center",$.textContent=D,$.style.height="44px";const un=(R=>{const N=document.createElement("span");N.style.visibility="hidden",N.style.font="inherit",N.textContent=R,document.body.appendChild(N);const q=N.getBoundingClientRect().width;return N.remove(),q})("88")+16;let fe=un;$.style.minWidth=fe+"px",$.classList.add("text-center","font-mono"),$.onclick=R=>{if(R.stopPropagation(),$.querySelector("input"))return;fe=$.getBoundingClientRect().width,$.style.width=fe+"px",$.style.minWidth=fe+"px";const q=document.createElement("input");q.type="text",q.inputMode="numeric",q.pattern="[0-9]*",q.className="w-full text-center outline-none",q.placeholder=D,q.style.MozAppearance="textfield",q.style.WebkitAppearance="none",q.style.appearance="textfield",q.style.border="none",q.style.background="transparent",$.textContent="",$.appendChild(q),q.focus(),ne=0;const oe=()=>{const O=parseInt(q.value,10);!isNaN(O)&&O>0?ne=O:ne=h.defaultIncrement||1,$.textContent=D};q.addEventListener("keydown",O=>{O.key==="Enter"&&oe()}),q.addEventListener("blur",oe);const Lt=()=>{const O=document.createElement("span");O.style.visibility="hidden",O.style.position="absolute",O.style.whiteSpace="pre",O.style.font=getComputedStyle(q).font,O.textContent=q.value||"0",document.body.appendChild(O);const Ct=O.getBoundingClientRect().width;O.remove();const Ze=getComputedStyle($),Wo=parseFloat(Ze.paddingLeft)+parseFloat(Ze.paddingRight),Xo=parseFloat(Ze.borderLeftWidth)+parseFloat(Ze.borderRightWidth),Ko=Math.max(un,Ct+Wo+Xo+4);$.style.width=Ko+"px"};q.addEventListener("input",()=>requestAnimationFrame(Lt))};const re=document.createElement("button");re.className="plus-edit rounded-full flex items-center justify-center font-extrabold text-white border-2 border-black",re.style.background="#16A34A",re.style.fontSize="1.8rem",re.style.width="44px",re.style.height="44px",re.textContent="+";const Pe=document.createElement("button");Pe.className="confirm-edit w-8 h-8 rounded-full flex items-center justify-center text-white border-2 border-black absolute right-0",Pe.style.background="#16A34A",Pe.textContent="‚úî",A.appendChild(j),A.appendChild($),A.appendChild(re);const Re=document.createElement("div");Re.className="flex items-center relative w-full",Re.appendChild(A),Re.appendChild(Pe),w.appendChild(Re);const Uo=R=>{$.textContent=R,I.textContent=`${R}/${h.target}`;const N=$.scrollWidth+1;N>fe&&(fe=N,$.style.minWidth=fe+"px");const q=h.target?Math.min(R/h.target,1):0;_(q)},gn=R=>{if(ne===0)return;const N=R*ne;D+=N,D<0&&(D=0),D>h.target&&(D=h.target),Uo(D),Ls(h.id,h.target,N),ne=h.defaultIncrement||1};re.addEventListener("click",R=>{R.stopPropagation(),gn(1)}),j.addEventListener("click",R=>{R.stopPropagation(),gn(-1)}),Pe.addEventListener("click",R=>{R.stopPropagation(),w.dataset.editing="0",Re.remove();const N=w.querySelector(".habit-content");N&&(N.style.display=""),Q.style.display="",C(q=>{const oe=q.habits.find(Ct=>Ct.id===h.id);if(!oe)return;const Lt=yt(oe,new Date(f.selectedDate)),O=oe.progress&&oe.progress[Lt]||0;oe.target&&O>=oe.target&&So(oe,new Date(f.selectedDate),!0)}),window._skipHomeRefresh=!1,Ee()}),window._skipHomeRefresh=!0;const mn=$.offsetHeight,yn=mn+"px";[j,re].forEach(R=>{R.style.width=yn,R.style.height=yn,R.style.fontSize=mn*.6+"px"}),$.style.pointerEvents="auto",$.style.zIndex="5"};Q.addEventListener("click",S=>{S.stopPropagation(),P()})}else{const _=he(h,n)?"‚úîÔ∏è":"";let I="";h.scheduledTime&&(I=`<span class="time-pill whitespace-nowrap px-3 py-1 rounded-lg text-sm font-semibold mr-1" style="background:${F.color}; color:#fff;border-radius:8px;font-size:0.875rem;">${h.scheduledTime}</span>`),cn=`<div class="ml-auto flex items-center gap-1">${I}<button class="complete-toggle w-8 h-8 rounded-full flex items-center justify-center" style="border:2px solid ${F.color}; color:${F.color}">${_}</button></div>`}if(It+="</div>",w.innerHTML=St+It+cn,Q&&w.appendChild(Q),T||(w.style.background=Xe(F.color,.07)),w.style.border=`3px solid ${F.color}`,T||w.querySelector(".complete-toggle").addEventListener("click",_=>{_.stopPropagation(),C(I=>{const B=I.habits.find(P=>P.id===h.id);B&&bs(B,new Date(f.selectedDate))})}),he(h,n)){w.style.border="3px solid #4B5563",w.style.background="#F3F4F6";const _=w.querySelector(".category-pill");_&&(_.style.background="#9CA3AF",_.style.color="#fff"),w.querySelectorAll(".ml-auto, .habit-counter, .target-pill, .complete-toggle, .time-pill, .progress-box").forEach(j=>j.remove());const I=document.createElement("div");I.className="completed-pill flex items-center gap-1 px-3 py-1 rounded-lg",I.style.border="2px solid #16A34A",I.style.background="#DCFCE7",I.style.color="#16A34A",I.innerHTML='<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9 16.2l-3.5-3.5 1.42-1.42L9 13.34 17.59 4.75 19 6.17z"/></svg><span class="text-sm font-semibold">Completed</span>';const B=document.createElement("div");B.className="swipe-container relative overflow-visible home-inset";const P=document.createElement("button");P.className="restore-btn absolute top-0 right-0 h-full",P.style.width="20%",P.style.background="#16A34A",P.style.color="#fff",P.style.borderRadius="0.75rem",P.textContent="Restore",P.style.fontWeight="600";const S=document.createElement("div");S.className="swipe-slide transition-transform",S.style.width="100%",S.style.position="relative",S.style.zIndex="1",S.style.background="#FFFFFF",S.style.borderRadius="0.75rem",S.appendChild(w),B.appendChild(P),B.appendChild(S),S.style.borderRadius="0.75rem",k=B,At(B,S,h),w.appendChild(I);const A=w.querySelector(".habit-icon");A&&(A.style.border="2px solid #9CA3AF",A.style.color="#9CA3AF")}else if(je(h,n)){w.style.border="3px solid #4B5563",w.style.background="#F3F4F6";const _=w.querySelector(".habit-icon");_&&(_.style.border="2px solid #9CA3AF",_.style.color="#9CA3AF");const I=w.querySelector(".category-pill");I&&(I.style.background="#9CA3AF",I.style.color="#fff"),w.querySelectorAll(".ml-auto, .habit-counter, .target-pill, .complete-toggle, .time-pill, .progress-box").forEach(ne=>ne.remove());const B=document.createElement("div");B.className="skipped-pill flex items-center gap-1 px-3 py-1 rounded-lg",B.style.border="2px solid #F97316",B.style.background="#FFEDD5",B.style.color="#F97316",B.innerHTML='<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/></svg><span class="text-sm font-semibold">Skipped</span>',w.appendChild(B);const P=document.createElement("div");P.className="swipe-container relative overflow-visible home-inset";const S=document.createElement("button");S.className="restore-btn absolute top-0 right-0 h-full",S.style.width="20%",S.style.background="#16A34A",S.style.color="#fff",S.style.borderRadius="0.75rem",S.style.fontWeight="600",S.textContent="Restore";const A=document.createElement("div");A.className="swipe-slide transition-transform",A.style.width="100%",A.style.position="relative",A.style.zIndex="1",A.style.borderRadius="0.75rem",A.style.background="#FFFFFF",A.appendChild(w),P.appendChild(S),P.appendChild(A),k=P,At(P,A,h);const j=U(new Date(f.selectedDate));S.addEventListener("click",()=>{C(ne=>{const $=ne.habits.find(Je=>Je.id===h.id);$&&($.skippedDates=$.skippedDates.filter(Je=>Je!==j))})})}if(!he(h,n)&&!je(h,n)){const _=document.createElement("div");_.className="swipe-container relative overflow-visible home-inset";const I=document.createElement("button");I.className="skip-btn absolute top-0 right-0 h-full",I.style.width="20%",I.style.background="#F97316",I.style.color="#fff",I.style.borderRadius="0.75rem",I.style.fontWeight="600",I.textContent="Skip";const B=document.createElement("div");B.className="swipe-slide transition-transform",B.style.width="100%",B.style.position="relative",B.style.zIndex="1",B.style.background="#FFFFFF",B.style.borderRadius="0.75rem",B.appendChild(w),_.appendChild(I),_.appendChild(B),k=_,At(_,B,h),I.addEventListener("click",()=>{const P=U(new Date(f.selectedDate));C(S=>{const A=S.habits.find(j=>j.id===h.id);A&&(Array.isArray(A.skippedDates)||(A.skippedDates=[]),A.skippedDates.includes(P)||A.skippedDates.push(P))})})}const dn=k||w;dn.style.marginBottom="0.25rem",x.appendChild(dn)}),L){const h=x.querySelector(".toggle-section");h&&h.addEventListener("click",k=>{k.stopPropagation();const w=x.classList.toggle("collapsed");Tt[p]=w;const T=h.querySelector("svg");T&&(T.style.transform=w?"rotate(180deg)":"rotate(0deg)");const H=h.querySelector("span");H&&(H.textContent=w?"Show":"Hide"),h&&(h.style.alignSelf="flex-start",h.style.padding="0",h.style.border="none",h.style.outline="none")})}return x}const y=g("Anytime",r),u=g("Scheduled",l),m=g("Completed",c),b=g("Skipped",s);y&&d.appendChild(y),u&&d.appendChild(u),m&&d.appendChild(m),b&&d.appendChild(b),e.appendChild(d),document.querySelectorAll("#home-view .category-pill").forEach(p=>{p.getBoundingClientRect(),p.parentElement.getBoundingClientRect()})}function xs(){ws(),Es();const e=document.querySelector("#home-view .habits-container");e&&(e.classList.remove("bg-white","dark:bg-gray-800","shadow-ios","rounded-2xl"),e.style.background="transparent",e.style.boxShadow="none",e.style.borderRadius="0"),document.querySelectorAll("#home-view .habit-card").forEach(t=>t.remove()),Ss(),Ue(Ee),Ee(),typeof window<"u"&&window.addEventListener("resize",Io)}function ws(){const e=document.querySelector("#home-view .habits-header .habits-title");if(!e||e.querySelector("#group-pill"))return;e.innerHTML="";const t=document.createElement("div");t.id="group-pill",t.className="flex items-center gap-2 px-4 py-1.5 bg-blue-50 dark:bg-gray-800 rounded-full cursor-pointer select-none w-full justify-center text-lg font-bold home-inset",e.style.display="flex",e.style.justifyContent="center",t.innerHTML=`<span id="group-icon" class="material-icons text-xl">${Eo[f.selectedGroup]}</span>
                    <span id="group-title" class="text-xl font-bold">${W(f.selectedGroup)} Habits</span>`,e.appendChild(t),ks();const n=e.closest(".habits-header");n&&(n.style.paddingBottom="8px")}function ks(){const e=document.querySelector("#home-view .habits-header");if(!e)return;e.classList.add("justify-between");let t=document.getElementById("holiday-toggle");t||(t=document.createElement("button"),t.id="holiday-toggle",t.className="relative flex items-center justify-center h-9 bg-gray-200 text-gray-500 rounded-full overflow-hidden select-none mr-4",t.style.width="36px",t.innerHTML='<span class="plane material-icons absolute left-2 top-1/2 -translate-y-1/2 transition-transform text-2xl">flight</span><span class="label whitespace-nowrap ml-1 text-sm font-medium opacity-0 transition-opacity">Holiday Mode</span>',t.addEventListener("click",()=>{const n=U(new Date(f.selectedDate));Promise.all([M(()=>Promise.resolve().then(()=>dt),void 0),M(()=>Promise.resolve().then(()=>Zn),void 0)]).then(([o,{showConfirm:a}])=>{const{toggleSingleHoliday:s}=o;if(f.holidayPeriods.some(r=>n>=r.startISO&&n<=r.endISO)){a({title:"Managed by Holiday Period",message:"This date is set as a holiday through a holiday period. Please edit using the Holiday Period manager.",okText:"OK",cancelText:"",onOK:()=>{}});return}s(n),Ee()})}),e.appendChild(t)),an()}function an(){const e=document.getElementById("holiday-toggle");e&&M(async()=>{const{isHoliday:t,dateToKey:n}=await Promise.resolve().then(()=>dt);return{isHoliday:t,dateToKey:n}},void 0).then(({isHoliday:t,dateToKey:n})=>{if((f.selectedGroup||"daily")!=="daily"){e.style.display="none";return}e.style.display="";const a=n(new Date(f.selectedDate)),s=t(a);e.classList.toggle("bg-ios-orange",s),e.classList.toggle("bg-gray-200",!s),e.classList.toggle("text-white",s),e.classList.toggle("text-gray-500",!s);const i=e.querySelector(".plane"),r=e.querySelector(".label");i&&(s?(i.style.left="8px",i.style.transform="translateY(-50%) rotate(-90deg)"):(i.style.left="50%",i.style.transform="translate(-50%, -50%) rotate(-90deg)")),r&&(s?(r.classList.add("opacity-100"),e.classList.add("pl-9","pr-4"),e.classList.remove("justify-center"),e.style.width="140px"):(r.classList.remove("opacity-100"),e.classList.remove("pl-9","pr-4"),e.classList.add("justify-center"),e.style.width="36px"))})}function Es(){const e=document.querySelector("#home-calendar")||document.querySelector("#home-view .week-calendar");e&&(it=wo({container:e,stateKey:"selectedDate",onDateChange:Ee}))}function Ss(){const e=document.getElementById("group-pill");if(e){let s=0;e.addEventListener("pointerdown",i=>{s=i.touches?i.touches[0].clientX:i.clientX}),e.addEventListener("pointerup",i=>{const l=(i.changedTouches?i.changedTouches[0].clientX:i.clientX)-s;if(Math.abs(l)<40)return;const c=l<0?1:-1;C(d=>{const g=t(d.selectedGroup,c);d.selectedGroup=g,d.selectedDate=new Date().toISOString()})}),e.addEventListener("click",i=>i.preventDefault()),e.style.touchAction="pan-y"}function t(s,i){const r=Ne.indexOf(s);new Date(f.selectedDate);for(let l=1;l<=Ne.length;l++){const c=(r+i*l+Ne.length)%Ne.length,d=Ne[c];if(d==="daily"?!0:f.habits.some(y=>wt(y,d)&&!y.paused))return d}return s}document.querySelectorAll("#home-view .dropdown-item").forEach(s=>{s.addEventListener("click",i=>{const r=s.dataset.action;r==="add-habit"&&M(()=>Promise.resolve().then(()=>Jn),void 0).then(l=>l.openModal("add-habit-modal")),r==="manage-holidays"&&M(()=>import("./manage-F14kbn2A.js"),[]).then(l=>l.openHolidayModal()),r==="toggle-completed"&&(ee.Completed=!ee.Completed,An(),Ee(),n()),r==="toggle-skipped"&&(ee.Skipped=!ee.Skipped,An(),Ee(),n())})});function n(){const s=document.querySelector('[data-action="toggle-completed"] span:last-child'),i=document.querySelector('[data-action="toggle-skipped"] span:last-child'),r='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke-width="2"/></svg>',l='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17.94 17.94A10.37 10.37 0 0 1 12 20c-7 0-11-8-11-8a19.77 19.77 0 0 1 5-5" stroke-width="2"/><path d="M1 1l22 22" stroke-width="2"/></svg>';if(s){const c=s.parentElement.querySelector("span:first-child");c&&(c.innerHTML=ee.Completed?l:r),s.textContent=(ee.Completed?"Hide":"Show")+" Completed"}if(i){const c=i.parentElement.querySelector("span:first-child");c&&(c.innerHTML=ee.Skipped?l:r),i.textContent=(ee.Skipped?"Hide":"Show")+" Skipped"}}n();const o=document.getElementById("menu-toggle"),a=document.getElementById("dropdown-menu");o&&a&&(a.classList.add("hidden"),o.addEventListener("click",s=>{s.stopPropagation(),a.classList.toggle("hidden")}),document.addEventListener("click",s=>{!a.contains(s.target)&&!o.contains(s.target)&&a.classList.add("hidden")})),an()}function Ee(){if(typeof window<"u"&&window._skipHomeRefresh)return;const e=document.getElementById("group-title"),t=document.getElementById("group-icon");e&&(e.textContent=`${W(f.selectedGroup)} Habits`),t&&(t.classList.add("material-icons"),t.textContent=Eo[f.selectedGroup]),document.querySelectorAll("#home-calendar .day-item, #home-view .week-calendar .day-item").forEach(s=>{const i=Ht(new Date(s.dataset.date),new Date(f.selectedDate));s.classList.toggle("current-day",i);const r=Ht(new Date(s.dataset.date),new Date);s.classList.toggle("today",r&&!i)});const o=Is();lo(o),vs(),Lo();const a=document.querySelector("#home-calendar .day-item.current-day, #home-view .week-calendar .day-item.current-day");a&&vo(a),it&&typeof it.refresh=="function"&&it.refresh(),an(),Io()}function Is(){const e=new Date(f.selectedDate),n=f.habits.filter(s=>wt(s,f.selectedGroup)&&on(s,e)).filter(s=>!je(s,e)),o=n.filter(s=>he(s,e));return n.length?o.length/n.length*100:0}function Ls(e,t,n){C(o=>{const a=o.habits.find(l=>l.id===e);if(!a)return;const s=yt(a,new Date(f.selectedDate));(typeof a.progress!="object"||a.progress===null)&&(a.progress={});let r=(a.progress[s]||0)+n;r<0&&(r=0),r>t&&(r=t),a.progress[s]=r})}function At(e,t,n){ko(e,t,n,{onRestore:()=>{C(o=>{const a=o.habits.find(s=>s.id===n.id);if(a&&(So(a,new Date(f.selectedDate),!1),a.target)){const s=yt(a,new Date(f.selectedDate));a.progress&&delete a.progress[s]}})}})}typeof window<"u"&&(window.renderHabitsForHome=Lo,window.belongsToSelectedGroup=wt,window.isHabitScheduledOnDate=on);function Co(e){var n;const t={id:We(),name:e.name,categoryId:e.categoryId,icon:e.icon||((n=f.activityCategories.find(o=>o.id===e.categoryId))==null?void 0:n.icon)||"üéØ",createdAt:new Date().toISOString(),...e};return C(o=>{o.activities.push(t)}),t}function Do(e,t,n={}){const o=f.activities.find(i=>i.id===e);if(!o)return null;const a=t.slice(0,10),s={id:We(),activityId:e,activityName:o.name,categoryId:o.categoryId,date:a,timestamp:new Date().toISOString(),duration:n.duration||null,intensity:n.intensity||null,notes:n.notes||"",...n};return C(i=>{i.recordedActivities[a]||(i.recordedActivities[a]=[]),i.recordedActivities[a].push(s)}),s}function Ft(e){const t=e.slice(0,10);return f.recordedActivities[t]||[]}function Bo(){const e={};return f.activityCategories.forEach(t=>{e[t.id]={category:t,activities:f.activities.filter(n=>n.categoryId===t.id)}}),e}function Pt(e){if(!e||e.trim()==="")return f.activities;const t=e.toLowerCase().trim();return f.activities.filter(n=>n.name.toLowerCase().includes(t))}function To(e,t){const n=t.slice(0,10);C(o=>{o.recordedActivities[n]&&(o.recordedActivities[n]=o.recordedActivities[n].filter(a=>a.id!==e),o.recordedActivities[n].length===0&&delete o.recordedActivities[n])})}function Cs(e,t,n={}){const o=t.slice(0,10);C(a=>{if(a.recordedActivities[o]){const s=a.recordedActivities[o].findIndex(i=>i.id===e);s!==-1&&(a.recordedActivities[o][s]={...a.recordedActivities[o][s],...n})}})}function ye(e){return f.activityCategories.find(t=>t.id===e)}function X(e){return f.activities.find(t=>t.id===e)}var Gn,Yn;if(typeof window<"u"&&((Yn=(Gn=window.process)==null?void 0:Gn.env)==null?void 0:Yn.NODE_ENV)==="test"){console.group("üß™ Testing activities utility...");const e=Co({name:"Test Running",categoryId:"cardio",icon:"üèÉ‚Äç‚ôÇÔ∏è"});console.assert(e.id,"Activity should have an ID"),console.assert(e.name==="Test Running","Activity should have correct name"),console.assert(e.categoryId==="cardio","Activity should have correct category");const t="2024-01-15",n=Do(e.id,t,{duration:30,intensity:"moderate",notes:"Great run!"});console.assert(n,"Should create activity record"),console.assert(n.duration===30,"Record should have correct duration"),console.assert(n.intensity==="moderate","Record should have correct intensity");const o=Ft(t);console.assert(o.length>0,"Should find activities for date"),console.assert(o[0].activityName==="Test Running","Should find correct activity");const a=Pt("running");console.assert(a.length>0,"Should find activities by search"),console.assert(a[0].name.toLowerCase().includes("running"),"Search should match activity name");const s=Bo();console.assert(s.cardio,"Should have cardio category"),console.assert(s.cardio.activities.length>0,"Cardio category should have activities");const i=X(e.id);console.assert(i,"Should retrieve activity by ID"),console.assert(i.name==="Test Running","Retrieved activity should match");const r=ye("cardio");console.assert(r,"Should retrieve category by ID"),console.assert(r.name==="Cardio","Category should have correct name");const l=n.id;To(l,t);const c=Ft(t);console.assert(c.length===0,"Activity should be deleted"),console.assert(!X("invalid-id"),"Should return null for invalid activity ID"),console.assert(!ye("invalid-category"),"Should return undefined for invalid category"),console.assert(Pt("").length===f.activities.length,"Empty search should return all activities"),C(d=>{d.activities=d.activities.filter(g=>g.id!==e.id)}),console.log("‚úÖ All activities utility tests passed!"),console.groupEnd()}let V={isRunning:!1,elapsedSeconds:0,startTime:null,pausedTime:0},be=null,ft=null;function Ge(e){const t=Math.floor(e/60),n=e%60;return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function Ie(){return{...V}}function Ds(e){V.isRunning||(V.isRunning=!0,V.startTime=Date.now()-V.elapsedSeconds*1e3,be=setInterval(()=>{const t=Date.now();V.elapsedSeconds=Math.floor((t-V.startTime)/1e3),ft&&ft()},1e3),e&&e())}function Ao(e){V.isRunning&&(V.isRunning=!1,be&&(clearInterval(be),be=null),e&&e())}function Bs(e){V.isRunning&&Ao(),V.elapsedSeconds=0,V.startTime=null,V.pausedTime=0,e&&e()}function Ts(e){ft=e}function As(){V={isRunning:!1,elapsedSeconds:0,startTime:null,pausedTime:0},be&&(clearInterval(be),be=null),ft=null}let te=!1;function $s(){Vs();const e=new Date;e.setHours(0,0,0,0);const t=ie(e)+"T00:00:00.000Z";C(n=>{n.fitnessSelectedDate=t}),Ms(),ii(),ri(),ci(),di(),wi(),Ci(),Ue(()=>{ce(),Rt(),xe()}),ce(),typeof window<"u"&&(window.addEventListener("resize",()=>{Mo(),Hn(),te&&setTimeout(()=>{const n=document.querySelector("#activities-search-section .activities-search-content");if(n){const o=sn();n.style.maxHeight=`${o}px`}},100)}),window.addEventListener("orientationchange",()=>{setTimeout(()=>{te&&Hn()},500)}))}function Ms(){const e=document.getElementById("fitness-view");e&&(e.innerHTML="",Hs(),qs(),_s(),ni(),si())}function Hs(){const e=document.getElementById("fitness-view");if(!e)return;const t=document.createElement("header");t.className="app-header flex justify-between items-center h-11 px-4 sm:px-6 lg:px-8 border-b border-gray-200 dark:border-gray-700 border-opacity-50 w-full",t.innerHTML=`
    <div></div>
    <h1 class="app-title text-center flex-grow text-[36px] font-extrabold leading-none flex items-end">Fitness</h1>
    <div></div>
  `,e.appendChild(t)}function qs(){const e=document.getElementById("fitness-view");if(!e)return;const t=document.createElement("div");t.className="action-buttons flex gap-3 mb-1 px-4 pt-1",t.innerHTML=`
    <button id="new-activity-btn" class="flex-1 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 py-1.5 px-4 rounded-xl font-medium flex items-center justify-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      New Activity
    </button>
    <button id="start-timer-btn" class="flex-1 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 py-1.5 px-4 rounded-xl font-medium flex items-center justify-center gap-2">
      <span class="material-icons text-xl">schedule</span>
      Timer
    </button>
  `,e.appendChild(t),t.querySelectorAll("#new-activity-btn, #start-timer-btn").forEach(n=>{n.classList.add("font-semibold")})}function _s(){const e=document.getElementById("fitness-view");if(!e)return;const t=document.createElement("div");t.className="search-container px-4",t.innerHTML=`
    <div class="search-input relative border-2 border-gray-300 dark:border-gray-500 rounded-xl">
      <svg class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <input id="fitness-activity-search" type="text" placeholder="Search activities..." class="w-full pl-10 pr-10 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl border-none outline-none focus:bg-white dark:focus:bg-gray-600 transition-colors cursor-pointer" autocomplete="off" spellcheck="false">
      <button id="close-search-btn" class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 flex items-center justify-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors hidden">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    
    <!-- Expandable Activities Section -->
    <div id="activities-search-section" class="activities-search-section hidden bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-500 rounded-xl mt-2 overflow-hidden transition-all duration-300 ease-in-out">
      <div class="activities-search-content overflow-y-auto">
        <!-- Content will be populated dynamically -->
      </div>
    </div>
  `,e.appendChild(t),Fs()}function Fs(){const e=document.getElementById("fitness-activity-search"),t=document.getElementById("activities-search-section"),n=document.getElementById("close-search-btn");if(!e||!t)return;const o=a=>{te||(a.preventDefault(),Ps())};e.addEventListener("click",o),e.addEventListener("focus",o),e.addEventListener("input",a=>{const s=a.target.value;te&&kt(s)}),n&&n.addEventListener("click",a=>{a.stopPropagation(),a.preventDefault(),e.value="",Ve()}),document.addEventListener("click",a=>{te&&!e.contains(a.target)&&!t.contains(a.target)&&Ve()}),e.addEventListener("keydown",a=>{if(a.key==="Escape")Ve(),e.blur();else if(a.key==="ArrowDown"&&te){a.preventDefault();const s=t.querySelector(".search-activity-item");s&&s.focus()}}),te&&$o()}function Ps(){const e=document.getElementById("activities-search-section"),t=document.getElementById("close-search-btn");if(!e)return;t&&t.classList.remove("hidden"),e.classList.remove("hidden");const n=sn(),o=e.querySelector(".activities-search-content");o&&(o.style.maxHeight=`${n}px`,o.style.overflowY="auto");const a=document.getElementById("fitness-activity-search"),s=a?a.value:"";kt(s),e.classList.add("expanded"),te=!0}function Ve(){const e=document.getElementById("activities-search-section"),t=document.getElementById("close-search-btn"),n=document.getElementById("fitness-activity-search");e&&(t&&t.classList.add("hidden"),n&&n.value!==""&&(n.value=""),e.classList.remove("expanded"),setTimeout(()=>{e.classList.add("hidden")},800),te=!1)}function sn(){const e=document.querySelector("#fitness-view .search-container");if(!e)return 300;const t=e.getBoundingClientRect(),n=window.innerHeight,o=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--tab-bar-height").replace("px",""))||83,a=parseInt(getComputedStyle(document.documentElement).getPropertyValue("padding-bottom").replace("px",""))||0,s=t.bottom,i=n-s-o-a-20;return Math.max(200,Math.min(i,600))}function kt(e=""){const t=document.querySelector("#activities-search-section .activities-search-content");if(!t)return;let n="";if(e.trim()===""){const o=Bo();Object.values(o).forEach(({category:a,activities:s})=>{if(s.length!==0)if(a.id==="strength"){const i=Nt(s);n+=tt(a,null,i)}else n+=tt(a,s)})}else{const o=Pt(e);if(o.length>0){const a={};o.forEach(s=>{const i=ye(s.categoryId);a[i.id]||(a[i.id]={category:i,activities:[]}),a[i.id].activities.push(s)}),Object.values(a).forEach(({category:s,activities:i})=>{if(s.id==="strength"){const r=Nt(i);n+=tt(s,null,r)}else n+=tt(s,i)})}}n===""&&(e.trim()===""?n=`
        <div class="flex flex-col items-center justify-center py-8 text-center space-y-2">
          <span class="material-icons text-4xl text-gray-400">fitness_center</span>
          <p class="text-gray-600 dark:text-gray-400">No activities available</p>
          <p class="text-sm text-gray-500">Tap "New Activity" to create your first activity</p>
        </div>
      `:n=`
        <div class="flex flex-col items-center justify-center py-8 text-center space-y-2">
          <span class="material-icons text-4xl text-gray-400">search_off</span>
          <p class="text-gray-600 dark:text-gray-400">No activities found</p>
          <p class="text-sm text-gray-500">Try a different search term or create a new activity</p>
        </div>
      `),t.innerHTML=n,Rs(),$o()}function tt(e,t=null,n=null){const o=`search-category-${e.id}`,a=`
    <button class="search-expand-btn h-5 w-5 flex items-center justify-center text-black" data-category-id="${e.id}">
      <span class="material-icons transition-transform leading-none">expand_more</span>
    </button>
  `,s=`
    <button class="search-edit-category-btn w-8 h-8 rounded-full flex items-center justify-center ml-2" data-category-id="${e.id}" style="background-color:${e.color}">
      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2"/>
        <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
      </svg>
    </button>
  `;let i="";return n?i=Object.entries(n).map(([r,l])=>`
      <div class="muscle-group mb-2">
        <div class="muscle-header pl-3 py-1 text-sm font-semibold text-gray-700 dark:text-gray-300">${qo(r)}</div>
        <div class="category-activities pl-6">
          ${l.map(c=>$n(c,e)).join("")}
        </div>
      </div>
    `).join(""):t&&(i=`
      <div class="category-activities pl-6">
        ${t.map(r=>$n(r,e)).join("")}
      </div>
    `),`
    <div class="search-category-section mb-4" data-category-id="${e.id}" id="${o}">
      <div class="search-category-header-wrapper flex items-center">
        <div class="search-category-header flex items-center justify-between px-4 py-1 rounded-t-xl cursor-pointer select-none flex-grow" style="background:${e.color}20;">
          <div class="category-title flex items-center gap-2">
            <span class="text-lg" aria-hidden="true">${e.icon}</span>
            <span class="font-semibold text-gray-900 dark:text-white">${e.name}</span>
          </div>
          ${a}
        </div>
        <div class="-ml-2">${s}</div>
      </div>
      <div class="search-category-content">
        ${i}
      </div>
    </div>
  `}function $n(e,t){return`
    <div style="margin-bottom: 0.25rem;">
      <div class="search-activity-item activity-card flex items-center px-3 py-2 rounded-xl w-full transition-colors focus:outline-none focus:ring-2 focus:ring-ios-blue focus:ring-offset-2 dark:focus:ring-offset-gray-800" style="border: 3px solid ${t.color}; background-color: ${Xe(t.color,.05)};" data-activity-id="${e.id}">
        <div class="activity-icon w-9 h-9 flex-shrink-0 rounded-full flex items-center justify-center mr-3 text-xl" style="border: 2px solid ${t.color}; color: ${t.color};" aria-hidden="true">
          ${e.icon||t.icon}
        </div>
        <div class="activity-content flex-grow text-left">
          <div class="activity-name font-semibold leading-tight text-gray-900 dark:text-white">${e.name}</div>
        </div>
        <div class="activity-actions flex items-center gap-2 ml-3">
          <button class="stats-btn w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-600 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors" data-activity-id="${e.id}" title="View Stats">
            <span class="material-icons text-lg">bar_chart</span>
          </button>
          <button class="edit-activity-btn w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" data-activity-id="${e.id}" title="Edit Activity">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2"/>
              <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  `}function Rs(){const e=document.querySelector("#activities-search-section .activities-search-content");e&&(e.querySelectorAll(".search-expand-btn").forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation(),Mn(t.dataset.categoryId)})}),e.querySelectorAll(".search-category-header").forEach(t=>{t.addEventListener("click",n=>{if(n.target.closest(".search-expand-btn")||n.target.closest(".search-edit-category-btn"))return;const o=t.closest(".search-category-section").dataset.categoryId;Mn(o)})}),e.querySelectorAll(".search-edit-category-btn").forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation(),Ns(t)})}),e.querySelectorAll(".stats-btn").forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation(),Gs(t.dataset.activityId)})}),e.querySelectorAll(".edit-activity-btn").forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation(),Js(t.dataset.activityId)})}),e.querySelectorAll(".search-activity-item").forEach(t=>{t.addEventListener("click",n=>{if(n.target.closest(".activity-actions"))return;const o=t.dataset.activityId;zs(o)})}))}function Mn(e){const t=document.querySelector(`#search-category-${e}`);if(!t)return;const n=t.querySelector(".search-category-content"),o=t.querySelector(".search-expand-btn .material-icons");if(!n||!o)return;t.classList.contains("collapsed")?(n.style.maxHeight="0px",n.style.overflow="hidden",n.classList.remove("hidden"),n.offsetHeight,n.style.maxHeight=n.scrollHeight+"px",o.style.transform="rotate(0deg)",t.classList.remove("collapsed"),setTimeout(()=>{t.classList.contains("collapsed")||(n.style.maxHeight="",n.style.overflow="")},800)):(n.style.maxHeight=n.scrollHeight+"px",n.style.overflow="hidden",n.offsetHeight,n.style.maxHeight="0px",o.style.transform="rotate(-90deg)",t.classList.add("collapsed"),setTimeout(()=>{t.classList.contains("collapsed")&&n.classList.add("hidden")},800))}function $o(){const e=document.querySelectorAll("#activities-search-section .search-activity-item");e.forEach((t,n)=>{t.setAttribute("tabindex","0"),t.addEventListener("keydown",o=>{switch(o.key){case"ArrowDown":o.preventDefault();const a=e[n+1];a&&a.focus();break;case"ArrowUp":if(o.preventDefault(),n===0){const i=document.getElementById("fitness-activity-search");i&&i.focus()}else{const i=e[n-1];i&&i.focus()}break;case"Enter":case" ":o.preventDefault(),t.click();break;case"Escape":o.preventDefault(),Ve();const s=document.getElementById("fitness-activity-search");s&&s.focus();break}}),t.addEventListener("focus",()=>{t.style.outline="2px solid #3B82F6",t.style.outlineOffset="2px"}),t.addEventListener("blur",()=>{t.style.outline="",t.style.outlineOffset=""})})}function Hn(){if(te){const e=document.querySelector("#activities-search-section .activities-search-content");if(e){const t=sn();e.style.maxHeight=`${t}px`}}}function Ns(e){const t=e.dataset.categoryId,n=ye(t);if(!n)return;const o=document.querySelector(".category-color-picker");o&&o.remove();const a=document.createElement("div");a.className="category-color-picker bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700",a.style.cssText=`
    position: absolute;
    z-index: 1000;
    border-radius: 12px;
    padding: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    width: 180px;
    max-width: 180px;
  `,[{hex:"#ef4444",gradient:"from-red-500 to-red-600",shadow:"hover:shadow-red-500/25"},{hex:"#f97316",gradient:"from-orange-500 to-orange-600",shadow:"hover:shadow-orange-500/25"},{hex:"#eab308",gradient:"from-yellow-500 to-yellow-600",shadow:"hover:shadow-yellow-500/25"},{hex:"#22c55e",gradient:"from-green-500 to-green-600",shadow:"hover:shadow-green-500/25"},{hex:"#06b6d4",gradient:"from-cyan-500 to-cyan-600",shadow:"hover:shadow-cyan-500/25"},{hex:"#3b82f6",gradient:"from-blue-500 to-blue-600",shadow:"hover:shadow-blue-500/25"},{hex:"#8b5cf6",gradient:"from-violet-500 to-violet-600",shadow:"hover:shadow-violet-500/25"},{hex:"#ec4899",gradient:"from-pink-500 to-pink-600",shadow:"hover:shadow-pink-500/25"},{hex:"#64748b",gradient:"from-slate-500 to-slate-600",shadow:"hover:shadow-slate-500/25"},{hex:"#374151",gradient:"from-gray-700 to-gray-800",shadow:"hover:shadow-gray-500/25"},{hex:"#7c2d12",gradient:"from-red-900 to-red-950",shadow:"hover:shadow-red-900/25"},{hex:"#166534",gradient:"from-green-800 to-green-900",shadow:"hover:shadow-green-800/25"}].forEach(({hex:d,gradient:g,shadow:y})=>{const u=document.createElement("button");u.className=`color-option w-10 h-10 rounded-xl bg-gradient-to-br ${g} shadow-lg hover:scale-110 transition-all duration-200 ${y}`,d===n.color&&u.classList.add("ring-2","ring-black","dark:ring-white","ring-offset-2","ring-offset-white","dark:ring-offset-gray-800"),u.addEventListener("click",()=>{Os(t,d),js(e,d),a.remove()}),a.appendChild(u)});const i=e.getBoundingClientRect(),r=document.querySelector("#activities-search-section"),l=r.getBoundingClientRect();a.style.top=`${i.top-l.top}px`,a.style.right=`${l.right-i.left+8}px`,r.appendChild(a);const c=d=>{!a.contains(d.target)&&d.target!==e&&(a.remove(),document.removeEventListener("click",c))};setTimeout(()=>{document.addEventListener("click",c)},100)}function Os(e,t){const n=f.activityCategories||[],o=n.find(a=>a.id===e);if(o&&(o.color=t,C(a=>{a.activityCategories=n}),te)){const a=document.getElementById("fitness-activity-search"),s=a?a.value:"";kt(s)}}function js(e,t){e.style.backgroundColor=t}function Vs(){const e=["cardio","strength","stretching","sports","other"];C(t=>{const n=t.categories.length;t.categories=t.categories.filter(a=>!e.includes(a.id));const o=n-t.categories.length;o>0&&console.log(`Cleaned up ${o} fitness categories from habits categories`)})}function zs(e){const t=f.fitnessSelectedDate||new Date().toISOString(),n=ie(t);Y(n)||!X(e)||ki(e)}function Gs(e){const t=X(e);if(!t)return;const n=Ys(e);Us(t,n)}function Ys(e){const t=X(e);if(!t)return null;const n=[];if(Object.values(f.recordedActivities||{}).forEach(d=>{d.forEach(g=>{g.activityId===e&&n.push(g)})}),n.length===0)return{totalSessions:0,totalDuration:0,totalSets:0,totalReps:0,totalVolume:0,averageDuration:0,averageSets:0,averageReps:0,mostCommonIntensity:null,lastPerformed:null,bestSession:null,recentFrequency:0,weeklyAverage:0};n.sort((d,g)=>new Date(d.timestamp)-new Date(g.timestamp));const o={totalSessions:n.length,totalDuration:0,totalSets:0,totalReps:0,totalVolume:0,averageDuration:0,averageSets:0,averageReps:0,mostCommonIntensity:null,lastPerformed:n[n.length-1].timestamp,bestSession:null,recentFrequency:0,weeklyAverage:0};if(t.trackingType==="sets-reps"){let d=0,g=null;n.forEach(y=>{y.sets&&y.sets.length>0&&(o.totalSets+=y.sets.length,y.sets.forEach(u=>{if(u.reps&&(o.totalReps+=parseInt(u.reps)||0),u.value&&u.unit&&u.unit!=="none"){const m=parseFloat(u.value)||0,b=parseInt(u.reps)||0,p=m*b;o.totalVolume+=p,p>d&&(d=p,g=y)}}))}),o.averageSets=o.totalSets/o.totalSessions,o.averageReps=o.totalReps/o.totalSessions,o.bestSession=g}else{const d={};let g=0,y=null;n.forEach(u=>{if(u.duration){let m=parseInt(u.duration)||0;u.durationUnit==="hours"?m*=60:u.durationUnit==="seconds"&&(m/=60),o.totalDuration+=m,m>g&&(g=m,y=u)}u.intensity&&(d[u.intensity]=(d[u.intensity]||0)+1)}),o.averageDuration=o.totalDuration/o.totalSessions,o.bestSession=y,Object.keys(d).length>0&&(o.mostCommonIntensity=Object.entries(d).sort(([,u],[,m])=>m-u)[0][0])}const a=new Date;a.setDate(a.getDate()-30);const s=n.filter(d=>new Date(d.timestamp)>a);o.recentFrequency=s.length;const i=new Date(n[0].timestamp),c=Math.max(1,(new Date-i)/(1e3*60*60*24))/7;return o.weeklyAverage=o.totalSessions/c,o}function Us(e,t){const n=ye(e.categoryId),o=`
    <div id="activity-stats-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="modal-content bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-hidden">
        <div class="modal-header flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
          <div class="flex items-center gap-3">
            <div class="activity-icon w-10 h-10 rounded-full flex items-center justify-center text-xl" style="background-color: ${n.color}20; color: ${n.color};">
              ${e.icon||n.icon}
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">${e.name}</h3>
              <p class="text-sm text-gray-500 dark:text-gray-400">Activity Statistics</p>
            </div>
          </div>
          <button id="close-stats-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        
        <div class="modal-body p-4 overflow-y-auto">
          ${Ws(e,t,n)}
        </div>
      </div>
    </div>
  `,a=document.getElementById("activity-stats-modal");a&&a.remove(),document.body.insertAdjacentHTML("beforeend",o);const s=document.getElementById("activity-stats-modal"),i=document.getElementById("close-stats-modal"),r=()=>{s&&(s.classList.add("hidden"),setTimeout(()=>s.remove(),300))};i&&i.addEventListener("click",r),s&&s.addEventListener("click",l=>{l.target===s&&r()}),s&&s.classList.remove("hidden")}function Ws(e,t,n){if(t.totalSessions===0)return`
      <div class="text-center py-8">
        <span class="material-icons text-4xl text-gray-400 mb-4">bar_chart</span>
        <p class="text-gray-600 dark:text-gray-400">No recorded sessions yet</p>
        <p class="text-sm text-gray-500 mt-2">Start tracking this activity to see statistics</p>
      </div>
    `;let o=`
    <div class="stats-grid space-y-4">
      <!-- Overview Stats -->
      <div class="stats-section">
        <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Overview</h4>
        <div class="grid grid-cols-2 gap-4">
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-2xl font-bold text-gray-900 dark:text-white">${t.totalSessions}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Total Sessions</div>
          </div>
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-2xl font-bold text-gray-900 dark:text-white">${t.weeklyAverage.toFixed(1)}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Per Week Average</div>
          </div>
        </div>
      </div>
  `;return e.trackingType==="sets-reps"?o+=`
      <div class="stats-section">
        <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Strength Metrics</h4>
        <div class="grid grid-cols-2 gap-4">
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.totalSets}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Total Sets</div>
          </div>
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.totalReps}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Total Reps</div>
          </div>
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.averageSets.toFixed(1)}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Avg Sets/Session</div>
          </div>
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.averageReps.toFixed(1)}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Avg Reps/Session</div>
          </div>
        </div>
        ${t.totalVolume>0?`
          <div class="mt-4">
            <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
              <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.totalVolume.toFixed(1)}</div>
              <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Total Volume (weight √ó reps)</div>
            </div>
          </div>
        `:""}
      </div>
    `:o+=`
      <div class="stats-section">
        <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Duration Metrics</h4>
        <div class="grid grid-cols-2 gap-4">
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${qn(t.totalDuration)}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Total Duration</div>
          </div>
          <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
            <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${qn(t.averageDuration)}</div>
            <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Avg Duration</div>
          </div>
        </div>
        ${t.mostCommonIntensity?`
          <div class="mt-4">
            <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
              <div class="stat-value text-lg font-bold text-gray-900 dark:text-white capitalize">${t.mostCommonIntensity}</div>
              <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Most Common Intensity</div>
            </div>
          </div>
        `:""}
      </div>
    `,o+=`
    <div class="stats-section">
      <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Recent Activity</h4>
      <div class="grid grid-cols-2 gap-4">
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-xl font-bold text-gray-900 dark:text-white">${t.recentFrequency}</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Last 30 Days</div>
        </div>
        <div class="stat-card bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
          <div class="stat-value text-sm font-bold text-gray-900 dark:text-white">${Xs(t.lastPerformed)}</div>
          <div class="stat-label text-xs text-gray-500 dark:text-gray-400">Last Performed</div>
        </div>
      </div>
    </div>
  `,t.bestSession&&(o+=`
      <div class="stats-section">
        <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">Best Session</h4>
        <div class="stat-card bg-gradient-to-r from-${n.color.slice(1)} to-${n.color.slice(1)} bg-opacity-10 p-4 rounded-lg border-2" style="border-color: ${n.color}40;">
          ${Ks(t.bestSession,e)}
          <div class="text-xs text-gray-500 dark:text-gray-400 mt-2">
            ${new Date(t.bestSession.timestamp).toLocaleDateString()}
          </div>
        </div>
      </div>
    `),o+="</div>",o}function qn(e){if(e<60)return`${Math.round(e)}m`;{const t=Math.floor(e/60),n=Math.round(e%60);return n>0?`${t}h ${n}m`:`${t}h`}}function Xs(e){const t=new Date(e),o=Math.floor((new Date-t)/(1e3*60*60*24));return o===0?"Today":o===1?"Yesterday":o<7?`${o} days ago`:o<30?`${Math.floor(o/7)} weeks ago`:t.toLocaleDateString()}function Ks(e,t){var n,o;if(t.trackingType==="sets-reps"&&e.sets){const a=e.sets.reduce((i,r)=>{const l=parseFloat(r.value)||0,c=parseInt(r.reps)||0;return i+l*c},0),s=Math.max(...e.sets.map(i=>parseFloat(i.value)||0));return`
      <div class="text-sm font-semibold text-gray-900 dark:text-white">
        ${e.sets.length} sets ‚Ä¢ ${a.toFixed(1)} volume
      </div>
      <div class="text-xs text-gray-600 dark:text-gray-300">
        Max weight: ${s}${((n=e.sets[0])==null?void 0:n.unit)!=="none"&&((o=e.sets[0])==null?void 0:o.unit)||""}
      </div>
    `}else{let a="";if(e.duration){let s=e.duration,i=e.durationUnit||"minutes";i==="hours"?(s=s*60,i="minutes"):i==="seconds"&&(s=Math.round(s/60),i="minutes"),a=`${s} ${i==="minutes"?"min":i}`}return`
      <div class="text-sm font-semibold text-gray-900 dark:text-white">
        ${a}${e.intensity?` ‚Ä¢ ${e.intensity} intensity`:""}
      </div>
      <div class="text-xs text-gray-600 dark:text-gray-300">
        Longest duration session
      </div>
    `}}function Js(e){X(e)&&(Ve(),Qs(e))}function Zs(e){const t=X(e);t&&M(()=>Promise.resolve().then(()=>Zn),void 0).then(n=>{n.showConfirm({title:"Delete Activity?",message:`Are you sure you want to delete "${t.name}"? This action cannot be undone.`,okText:"Delete",onOK:()=>{ei(e);const o=document.getElementById("add-activity-modal");o&&o.dataset.editMode==="true"&&M(()=>Promise.resolve().then(()=>Jn),void 0).then(a=>{a.closeModal("add-activity-modal")}),kt(),typeof ce=="function"&&ce()}})})}function Qs(e){const t=X(e);if(!t)return;const n=document.getElementById("add-activity-form");n&&n.reset();const o=document.getElementById("activity-name-input"),a=document.getElementById("activity-category-select"),s=document.getElementById("muscle-group-select"),i=document.getElementById("muscle-group-section");o&&(o.value=t.name),a&&(a.innerHTML='<option value="" disabled>Select a category</option>'+f.activityCategories.map(u=>`<option value="${u.id}" ${u.id===t.categoryId?"selected":""}>${u.icon} ${u.name}</option>`).join("")),t.categoryId==="strength"&&t.muscleGroup?(i&&i.classList.remove("hidden"),s&&(s.value=t.muscleGroup)):i&&i.classList.add("hidden"),Ye(t.icon||"üèÉ‚Äç‚ôÇÔ∏è");const r=document.getElementById("activity-selected-icon-display");r&&(r.textContent=He());const l=t.trackingType||"time-intensity";if(Te(l),t.units){const u=document.getElementById("units-select"),m=document.getElementById("units-section");u&&(u.value=t.units),m&&l==="sets-reps"&&m.classList.remove("hidden")}const c=document.querySelector("#add-activity-modal h2");c&&(c.textContent="Edit Activity");const d=document.getElementById("save-add-activity");d&&(d.textContent="Update Activity");const g=document.getElementById("add-activity-modal");g&&(g.dataset.editActivityId=e,g.dataset.editMode="true");const y=ti();y&&y.classList.remove("hidden"),Z("add-activity-modal"),setTimeout(()=>{Ro(),Po(),Fo(),typeof se=="function"&&se()},50)}function ei(e){C(t=>{var n;t.activities=((n=t.activities)==null?void 0:n.filter(o=>o.id!==e))||[],Object.keys(t.recordedActivities||{}).forEach(o=>{t.recordedActivities[o]=t.recordedActivities[o].filter(a=>a.activityId!==e),t.recordedActivities[o].length===0&&delete t.recordedActivities[o]})})}function ti(){const e=document.getElementById("add-activity-modal");if(!e||!e.querySelector(".flex.flex-col"))return null;let n=document.getElementById("delete-activity-btn");if(!n){n=document.createElement("button"),n.id="delete-activity-btn",n.textContent="Delete Activity",n.className="w-full py-3 px-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl text-red-600 dark:text-red-400 font-medium hover:bg-red-100 dark:hover:bg-red-900/30 transition-all duration-200 mt-4",n.addEventListener("click",()=>{const a=document.getElementById("add-activity-modal");a&&a.dataset.editActivityId&&Zs(a.dataset.editActivityId)});const o=e.querySelector("#add-activity-form");if(o){const a=o.querySelector(".h-4:last-child");a?a.before(n):o.appendChild(n)}}return n}function ni(){const e=document.getElementById("fitness-view");if(!e)return;const t=document.createElement("div");t.className="week-calendar overflow-x-auto no-scrollbar m-0 p-0",t.id="fitness-calendar",e.appendChild(t)}function oi(){const e=document.getElementById("fitness-calendar");if(!e||e.querySelector(".calendar-nav"))return;const t=document.createElement("div");t.className="calendar-nav flex justify-center items-center gap-4 lg:gap-6 relative -top-1.5",t.innerHTML=`
    <button class="nav-arrow prev-week text-ios-blue p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors spring font-bold lg:p-3 lg:text-lg">‚Äπ‚Äπ</button>
    <button class="nav-arrow prev-day text-ios-blue p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors spring font-bold lg:p-3 lg:text-lg">‚Äπ</button>
    <button class="today-btn bg-ios-blue text-white rounded-full font-medium hover:bg-blue-600 transition-colors spring lg:px-6 lg:text-lg">Today</button>
    <button class="nav-arrow next-day text-ios-blue p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors spring font-bold lg:p-3 lg:text-lg">‚Ä∫</button>
    <button class="nav-arrow next-week text-ios-blue p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors spring font-bold lg:p-3 lg:text-lg">‚Ä∫‚Ä∫</button>
  `;const n=e.querySelector(".week-days");n?n.insertAdjacentElement("afterend",t):e.appendChild(t)}function ai(e){function t(){return new Date(f.fitnessSelectedDate)}function n(s){C(i=>{const r=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0"),d=`${r}-${l}-${c}T00:00:00.000Z`;i.fitnessSelectedDate=d}),ce(),window.fitnessCalendarApi&&window.fitnessCalendarApi.refresh()}function o(){const s=e.querySelector(".week-days .day-item");return s&&s.dataset.date?new Date(s.dataset.date):new Date}e.querySelectorAll(".nav-arrow").forEach(s=>{s.addEventListener("click",()=>{let i=t();const r=new Date(i),l=f.selectedGroup||"daily",c=s.classList.contains("prev-week"),d=s.classList.contains("next-week"),g=s.classList.contains("prev-day"),y=s.classList.contains("next-day");if(c||d){const m=c?-1:1;switch(l){case"weekly":i.setDate(i.getDate()+m*28);break;case"monthly":i.setMonth(i.getMonth()+m*6);break;case"yearly":i.setFullYear(i.getFullYear()+m*5);break;case"daily":default:i.setDate(i.getDate()+m*7);break}}else if(g||y){const m=g?-1:1;switch(l){case"weekly":i.setDate(i.getDate()+m*7);break;case"monthly":i.setMonth(i.getMonth()+m);break;case"yearly":i.setFullYear(i.getFullYear()+m);break;case"daily":default:i.setDate(i.getDate()+m)}}const u=o();i<u&&(c&&l==="daily"?Math.floor((r-u)/864e5)<7?i=new Date(u):i=new Date(u):i=new Date(u)),n(i)})});const a=e.querySelector(".today-btn");a&&a.addEventListener("click",()=>{n(new Date)})}function si(){const e=document.getElementById("fitness-view");if(!e)return;const t=document.createElement("div");t.className="flex items-center justify-between px-4 py-2",t.innerHTML=`
    <div id="activities-label" class="bg-blue-50 dark:bg-gray-800 text-gray-900 dark:text-white px-6 py-1.5 rounded-full text-xl font-bold flex items-center justify-center gap-2">
      <span class="material-icons text-xl">fitness_center</span>
      Activities
    </div>
    <button id="rest-toggle" class="relative flex items-center justify-center h-9 bg-gray-200 text-gray-500 rounded-full overflow-hidden select-none transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-ios-orange focus:ring-offset-2 dark:focus:ring-offset-gray-900" style="width: 36px;" aria-label="Toggle rest day for selected date" aria-pressed="false">
      <span class="bed material-icons absolute left-2 top-1/2 -translate-y-1/2 transition-transform text-2xl" aria-hidden="true">bed</span>
      <span class="label whitespace-nowrap ml-1 text-sm font-medium opacity-0 transition-opacity">Rest Day</span>
    </button>
  `,e.appendChild(t)}function ii(){const e=document.getElementById("fitness-calendar");e&&(window.fitnessCalendarApi=wo({container:e,stateKey:"fitnessSelectedDate",onDateChange:()=>{ce()}}),oi(),ai(e))}function ri(){const e=document.getElementById("fitness-view");if(!e)return;const t=document.createElement("div");t.className="activities-container flex-grow overflow-y-auto px-4 pb-8",t.style.overflowX="visible",t.id="activities-list",e.appendChild(t)}function Mo(){if(typeof window>"u")return;const e=document.querySelector("#activities-list");if(!e)return;const t=e.getBoundingClientRect();let n=0;const o=document.querySelector("#fitness-view").closest(".content-area");if(o){const s=window.getComputedStyle(o);n=parseFloat(s.paddingBottom)||0}const a=window.innerHeight-t.top-n;a>0&&(e.style.maxHeight=a+"px",e.style.overflowY="auto")}function ce(){const e=document.getElementById("activities-list");if(!e)return;const t=f.fitnessSelectedDate||new Date().toISOString(),n=ie(t),o=Y(n),a=Ft(n);if(a.length===0){o?e.innerHTML=`
        <div class="flex flex-col items-center justify-center py-20 text-center space-y-2">
          <span class="material-icons text-5xl text-orange-500">bed</span>
          <h2 class="text-lg font-bold text-gray-900 dark:text-white">Enjoy your rest day</h2>
        </div>
      `:e.innerHTML=`
        <div class="flex flex-col items-center justify-center py-20 text-center space-y-2">
          <span class="material-icons text-5xl text-gray-400">fitness_center</span>
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white">No activities recorded</h2>
          <p class="text-sm text-gray-600 dark:text-gray-400">Tap "Record Activity" to log your fitness activities for this day.</p>
        </div>
      `;return}const s={};a.forEach(r=>{const l=ye(r.categoryId);s[l.id]||(s[l.id]={category:l,records:[]}),s[l.id].records.push(r)});let i="";Object.values(s).forEach(({category:r,records:l})=>{if(l.length!==0)if(r.id==="strength"){const c=Nt(l);i+=`
        <div class="category-group mb-4">
          <div class="category-header flex items-center gap-2 px-4 py-2 rounded-t-xl" style="background:${r.color}20;">
            <div class="category-title flex items-center gap-2">
              <span class="text-lg" aria-hidden="true">${r.icon}</span>
              <span class="font-semibold text-gray-900 dark:text-white">${r.name}</span>
            </div>
          </div>
          ${Object.entries(c).map(([d,g])=>`
            <div class="muscle-group mb-2">
              <div class="muscle-header pl-3 py-1 text-sm font-semibold text-gray-700 dark:text-gray-300">${qo(d)}</div>
              <div class="category-activities pl-6">
                ${g.map(y=>_n(y,r)).join("")}
              </div>
            </div>`).join("")}
        </div>
      `}else i+=`
        <div class="category-group mb-4" style="overflow: visible;">
          <div class="category-header flex items-center gap-2 px-4 py-2 rounded-t-xl" style="background:${r.color}20;">
            <div class="category-title flex items-center gap-2">
              <span class="text-lg" aria-hidden="true">${r.icon}</span>
              <span class="font-semibold text-gray-900 dark:text-white">${r.name}</span>
            </div>
          </div>
          <div class="category-activities pl-6" style="overflow: visible;">
            ${l.map(c=>`<div style="margin-bottom: 0.25rem; overflow: visible;">${_n(c,r)}</div>`).join("")}
          </div>
        </div>
      `}),e.innerHTML=i,e.querySelectorAll(".swipe-container").forEach(r=>{const l=r.querySelector(".swipe-slide"),c=r.dataset.recordId,d=a.find(g=>g.id===c);if(l&&d){ko(r,l,d,{onRestore:()=>{To(c,n),ce()}});const g=l.querySelector(".activity-card");g&&d.activityId&&(g.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation(),Ei(d.activityId,d)}),g.style.cursor="pointer")}}),Mo()}function _n(e,t){const n=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),o=li(e,t);return`
    <div class="swipe-container relative overflow-visible" data-record-id="${e.id}">
      <button class="restore-btn absolute top-0 right-0 h-full bg-red-600 text-white font-semibold rounded-xl w-1/5 touch-manipulation" aria-label="Delete ${e.activityName} activity">Delete</button>
      <div class="swipe-slide transition-transform bg-white dark:bg-gray-800 rounded-xl w-full relative z-1 touch-pan-y">
        <div class="activity-card relative flex items-start px-3 py-2 rounded-xl w-full mb-0" style="border: 3px solid ${t.color}; background-color: ${Xe(t.color,.05)};">
          <div class="activity-icon w-9 h-9 flex-shrink-0 rounded-full flex items-center justify-center mr-3 text-xl" style="border: 2px solid ${t.color}; color: ${t.color};" aria-hidden="true">
            ${t.icon}
          </div>
          <div class="activity-content flex-grow text-left">
            <div class="activity-name font-semibold leading-tight text-gray-900 dark:text-white mb-1">${e.activityName}</div>
            ${e.notes?`<div class="activity-notes text-xs text-gray-500 dark:text-gray-400 my-1 p-2 bg-gray-100 dark:bg-gray-700 rounded-lg w-fit max-w-full">${e.notes}</div>`:""}
            ${o}
          </div>
          <!-- Time placed absolutely so it doesn't restrict content width -->
          <div class="activity-meta absolute top-2 right-3 text-xs text-gray-500 dark:text-gray-400" aria-label="Activity recorded at ${n}">${n}</div>
        </div>
      </div>
    </div>
  `}function li(e,t){if(e.sets&&e.sets.length>0){let s=function(r,l){let c=`Set ${l+1}: ${r.reps} reps`;if(r.value&&r.unit&&r.unit!=="none"){let d="";r.unit==="seconds"?d="s":r.unit==="minutes"?d=" Mins":r.unit==="kg"?d="kg":d=r.unit,c+=` √ó ${r.value}${d}`}else r.value&&(c+=` √ó ${r.value}`);return`<span class="inline-block text-white text-xs px-2 py-1 rounded-lg mr-1 mb-1 font-medium" style="background-color: ${t.color};">${c}</span>`};const n=e.sets.length,o=Math.ceil(n/2),a=[];for(let r=0;r<o;r++){a.push(r);const l=o+r;l<n&&a.push(l)}return`<div class="set-pills grid grid-cols-2 gap-1">${a.map(r=>s(e.sets[r],r)).join("")}</div>`}else{let n=[];if(e.duration){const o=e.durationUnit||"minutes";let a="";o==="minutes"?a=e.duration>1?"Mins":"Min":o==="hours"?a=e.duration>1?"Hrs":"Hr":a="s",n.push(`<span class="inline-block text-white text-xs px-2 py-1 rounded-lg mr-1 mb-1 font-medium" style="background-color: ${t.color};">${e.duration} ${a}</span>`)}if(e.intensity){const o=e.intensity.charAt(0).toUpperCase()+e.intensity.slice(1);n.push(`<span class="inline-block text-white text-xs px-2 py-1 rounded-lg mr-1 mb-1 font-medium" style="background-color: ${t.color};">${o}</span>`)}return n.join("")}}function ci(){const e=document.getElementById("rest-toggle");e&&(Rt(),e.addEventListener("click",()=>{const t=f.fitnessSelectedDate||new Date().toISOString(),n=ie(t);pe(n),Rt(),xe(),ce(),window.fitnessCalendarApi&&typeof window.fitnessCalendarApi.refresh=="function"&&window.fitnessCalendarApi.refresh()}))}function di(){const e=document.getElementById("new-activity-btn");e&&e.addEventListener("click",()=>{xi()});const t=document.getElementById("start-timer-btn");t&&t.addEventListener("click",()=>{ui()}),As(),Ts(()=>{xe()}),xe(),hi()}function xe(){const e=document.getElementById("start-timer-btn");if(!e)return;Ie().isRunning?(e.classList.remove("bg-blue-100","dark:bg-blue-900","text-blue-600","dark:text-blue-300"),e.classList.add("bg-orange-100","dark:bg-orange-900","text-orange-600","dark:text-orange-300")):(e.classList.remove("bg-orange-100","dark:bg-orange-900","text-orange-600","dark:text-orange-300"),e.classList.add("bg-blue-100","dark:bg-blue-900","text-blue-600","dark:text-blue-300"))}function ui(){Ie().elapsedSeconds===0&&(J=[]),Be(),Z("timer-modal"),gi()}function $t(){Ho();const e=document.getElementById("timer-modal");e&&e._escapeHandler&&(document.removeEventListener("keydown",e._escapeHandler),e._escapeHandler=null),z("timer-modal")}let rt=null,J=[];function gi(){Ho(),Be(),rt=setInterval(()=>{Be()},1e3)}function Ho(){rt&&(clearInterval(rt),rt=null)}function Be(){const e=Ie(),t=document.getElementById("timer-time-display"),n=document.getElementById("timer-status"),o=document.getElementById("timer-start-stop-btn");if(document.getElementById("record-timer-btn"),t){const s=fi();t.textContent=Ge(s)}if(n&&(e.isRunning?n.textContent="Running...":e.elapsedSeconds>0?n.textContent="Paused":n.textContent="Ready to start"),o){const s=o.querySelector(".material-icons");e.isRunning?(s.textContent="pause",o.classList.remove("bg-ios-blue"),o.classList.add("bg-red-500")):(s.textContent="play_arrow",o.classList.remove("bg-red-500"),o.classList.add("bg-ios-blue"))}const a=document.getElementById("record-lap-btn");a&&(a.disabled=e.elapsedSeconds===0),Et()}function Et(){const e=document.getElementById("lap-times-container"),t=document.getElementById("lap-times-list"),n=document.getElementById("total-session-time");if(!e||!t)return;if(n){const l=pi();n.textContent=Ge(l)}if(J.length===0){e.classList.add("hidden");return}e.classList.remove("hidden"),t.innerHTML="";const o=J.length,a=Math.ceil(o/2),s=[];for(let l=0;l<a;l++){s.push(l);const c=a+l;c<o&&s.push(c)}const i=document.createElement("div");i.className="lap-times-grid grid grid-cols-2 gap-2",s.forEach(l=>{const c=J[l],d=document.createElement("div");d.className="flex justify-between items-center py-2 px-3 bg-white dark:bg-gray-600 rounded-lg border border-gray-200 dark:border-gray-500",d.innerHTML=`
      <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Lap ${c.number}</span>
      <div class="flex items-center gap-2">
        <span class="text-sm font-mono text-gray-900 dark:text-white">${Ge(c.duration)}</span>
        <button class="delete-lap-btn text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 p-1 rounded transition-colors" data-lap-index="${l}">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path d="M6 18L18 6M6 6l12 12" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
          </div>
        `,i.appendChild(d)}),t.appendChild(i),setTimeout(()=>{if(t.scrollHeight>t.clientHeight){if(!t.querySelector(".scroll-fade")){const c=document.createElement("div");c.className="scroll-fade absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-gray-50 dark:from-gray-700 to-transparent pointer-events-none",t.appendChild(c)}}else{const c=t.querySelector(".scroll-fade");c&&c.remove()}},0),t.querySelectorAll(".delete-lap-btn").forEach(l=>{l.addEventListener("click",c=>{c.stopPropagation();const d=parseInt(l.dataset.lapIndex);yi(d)})})}function mi(){const e=Ie();if(!e.isRunning&&e.elapsedSeconds===0)return;const t=e.elapsedSeconds,n=J.reduce((s,i)=>s+i.duration,0),o=t-n,a={number:J.length+1,duration:o,totalTime:t,timestamp:new Date().toISOString()};J.push(a),Et(),console.log(`Lap ${a.number}: ${Ge(o)} (Total: ${Ge(t)})`)}function yi(e){e<0||e>=J.length||(J.splice(e,1),J.forEach((t,n)=>{t.number=n+1}),Et(),console.log(`Deleted lap ${e+1}`))}function fi(){const e=Ie(),t=J.reduce((n,o)=>n+o.duration,0);return e.elapsedSeconds-t}function pi(){return Ie().elapsedSeconds}function hi(){const e=document.getElementById("close-timer-modal");e&&e.addEventListener("click",$t);const t=document.getElementById("timer-start-stop-btn");t&&t.addEventListener("click",()=>{Ie().isRunning?Ao(()=>{Be(),xe()}):Ds(()=>{Be(),xe()})});const n=document.getElementById("timer-reset-btn");n&&n.addEventListener("click",()=>{Bs(()=>{J=[],Be(),xe(),Et()})});const o=document.getElementById("record-lap-btn");o&&o.addEventListener("click",mi);const a=document.getElementById("timer-modal");a&&a.addEventListener("click",i=>{i.target===a&&$t()});const s=i=>{if(i.key==="Escape"){const r=document.getElementById("timer-modal");r&&!r.classList.contains("hidden")&&$t()}};document.addEventListener("keydown",s),a._escapeHandler=s}function Rt(){const e=document.getElementById("rest-toggle");if(!e)return;const t=f.fitnessSelectedDate||new Date().toISOString(),n=ie(t),o=Y(n);e.classList.toggle("bg-ios-orange",o),e.classList.toggle("bg-gray-200",!o),e.classList.toggle("text-white",o),e.classList.toggle("text-gray-500",!o),e.setAttribute("aria-pressed",o.toString());const a=e.querySelector(".bed"),s=e.querySelector(".label");a&&(o?(a.style.left="8px",a.style.transform="translateY(-50%)"):(a.style.left="50%",a.style.transform="translate(-50%, -50%)")),s&&(o?(s.classList.add("opacity-100"),e.classList.add("pl-9","pr-4"),e.classList.remove("justify-center"),e.style.width="110px"):(s.classList.remove("opacity-100"),e.classList.remove("pl-9","pr-4"),e.classList.add("justify-center"),e.style.width="36px"))}function qo(e){return e?e.replace(/\b\w/g,t=>t.toUpperCase()).replace(/_/g," "):"Other"}let se=null,_o="üèÉ‚Äç‚ôÇÔ∏è";function He(){return _o}function Ye(e){_o=e}function vi(){const e=document.getElementById("sets-reps-toggle"),t=document.getElementById("time-toggle");return!e||!t?"time":e.classList.contains("bg-white")||e.classList.contains("dark:bg-gray-700")?"sets-reps":"time"}function bi(e){const t=e.querySelector("#icon-grid");if(!t)return;t.innerHTML="";const n=["üí™","üèÉ","üö¥","üèä","üßò","‚öñÔ∏è","üçé","ü•ó","üíß","‚òï","ü•õ","üçä","üìö","üìñ","‚úèÔ∏è","üéì","üí°","üß†","üíº","üíª","üì±","üìä","üìù","üìã","üò¥","üõèÔ∏è","üåô","‚è∞","üïê","‚è±Ô∏è","üéµ","üé∏","üé®","üì∑","üéÆ","üéØ","üå±","üå≥","üå∏","üåû","üåç","‚ôªÔ∏è","üë•","üë™","‚ù§Ô∏è","ü§ù","üìû","üí¨","üßº","ü™•","üöø","üíä","üß¥","üéØ","‚úàÔ∏è","üöó","üö∂","üó∫Ô∏è","üéí","üìç","üí∞","üí≥","üíé","üìà","üè¶","üí∏","‚≠ê","üéâ","üî•","‚ö°","‚ú®","üöÄ"],o=document.createDocumentFragment();n.forEach(a=>{const s=document.createElement("button");s.className="icon-option w-12 h-12 rounded-xl bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-xl hover:bg-ios-blue hover:text-white transition-all duration-200 hover:scale-105",s.dataset.icon=a,s.textContent=a,o.appendChild(s)}),t.appendChild(o)}function Fo(){const e=document.getElementById("activity-category-select"),t=document.getElementById("activity-selected-icon-display"),n=document.getElementById("muscle-group-section"),o=document.getElementById("muscle-group-select");if(!e||!t)return;const a=e.value;if(a){const s=f.activityCategories.find(i=>i.id===a);s&&(Ye(s.icon),t.textContent=He()),a==="strength"?n==null||n.classList.remove("hidden"):(n==null||n.classList.add("hidden"),o&&(o.value="")),Fn(a)}else Ye("üèÉ‚Äç‚ôÇÔ∏è"),t.textContent=He(),n==null||n.classList.add("hidden"),o&&(o.value=""),Fn(null);typeof se=="function"&&se()}function Fn(e){const t=document.getElementById("sets-reps-toggle"),n=document.getElementById("time-toggle"),o=document.getElementById("units-section"),a=document.getElementById("units-select");!t||!n||!o||(e==="sports"?(Te("time"),t.disabled=!0,t.classList.add("opacity-50","cursor-not-allowed"),t.classList.remove("hover:text-gray-900","dark:hover:text-white")):(t.disabled=!1,t.classList.remove("opacity-50","cursor-not-allowed"),t.classList.add("hover:text-gray-900","dark:hover:text-white"),Te("time")),a&&(a.value="none"))}function Te(e){const t=document.getElementById("sets-reps-toggle"),n=document.getElementById("time-toggle"),o=document.getElementById("units-section");if(!t||!n||!o)return;const a=["bg-white","dark:bg-gray-700","text-gray-900","dark:text-white","border","border-gray-200","dark:border-gray-600","shadow-sm"],s=["text-gray-600","dark:text-gray-400"];e==="sets-reps"?(t.classList.add(...a),t.classList.remove(...s),n.classList.remove(...a),n.classList.add(...s),o.classList.remove("hidden")):(n.classList.add(...a),n.classList.remove(...s),t.classList.remove(...a),t.classList.add(...s),o.classList.add("hidden"))}function Po(){const e=document.getElementById("sets-reps-toggle"),t=document.getElementById("time-toggle");!e||!t||(e.addEventListener("click",()=>{e.disabled||Te("sets-reps")}),t.addEventListener("click",()=>{Te("time")}),Te("time"))}function xi(){const e=document.getElementById("add-activity-form");e&&e.reset();const t=document.getElementById("delete-activity-btn");t&&t.classList.add("hidden");const n=document.querySelector("#add-activity-modal h2");n&&(n.textContent="New Activity");const o=document.getElementById("save-add-activity");o&&(o.textContent="Add");const a=document.getElementById("add-activity-modal");a&&(delete a.dataset.editActivityId,delete a.dataset.editMode),Ye("üèÉ‚Äç‚ôÇÔ∏è");let s=document.getElementById("activity-selected-icon-display");s&&(s.textContent=He());const i=document.getElementById("muscle-group-section"),r=document.getElementById("muscle-group-select");i&&i.classList.add("hidden"),r&&(r.value="");const l=document.getElementById("units-section"),c=document.getElementById("units-select");l&&l.classList.add("hidden"),c&&(c.value="none");const d=document.getElementById("activity-category-select");d&&(d.innerHTML='<option value="" disabled selected>Select a category</option>'+f.activityCategories.map(g=>`<option value="${g.id}">${g.icon} ${g.name}</option>`).join("")),Z("add-activity-modal"),setTimeout(()=>{Ro(),Po()},50),typeof se=="function"&&se()}function wi(){const e=document.getElementById("cancel-add-activity");e&&e.addEventListener("click",()=>{z("add-activity-modal")})}function Ro(){const e=document.getElementById("activity-icon-selector-btn"),t=document.getElementById("icon-selection-modal");let n=document.getElementById("activity-selected-icon-display");if(!e||!t||!n)return;const o=e.cloneNode(!0);e.parentNode.replaceChild(o,e),n=o.querySelector("#activity-selected-icon-display")||document.getElementById("activity-selected-icon-display"),o.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),bi(t),Z("icon-selection-modal")}),t.addEventListener("click",u=>{u.target===t&&z("icon-selection-modal")});const s=document.getElementById("select-icon"),i=document.getElementById("cancel-icon");function r(){t.querySelectorAll(".icon-option").forEach(u=>u.classList.remove("ring","ring-ios-blue","ring-2"))}t.addEventListener("click",u=>{const m=u.target.closest(".icon-option");if(!m)return;const b=m.dataset.icon||"üèÉ‚Äç‚ôÇÔ∏è";Ye(b),n.textContent=b,r(),m.classList.add("ring","ring-ios-blue","ring-2"),s&&(s.disabled=!1)}),s&&s.addEventListener("click",()=>{n.textContent=He(),z("icon-selection-modal")}),i&&i.addEventListener("click",()=>{z("icon-selection-modal")});const l=document.getElementById("add-activity-form"),c=document.getElementById("activity-name-input"),d=document.getElementById("activity-category-select"),g=document.getElementById("save-add-activity");se=function(){const m=c&&c.value.trim().length>0,b=d&&d.value,p=d&&d.value==="strength",v=document.getElementById("muscle-group-select"),x=!p||v&&v.value,L=m&&b&&x;g&&(g.disabled=!L,g.classList.toggle("opacity-50",g.disabled))},c&&c.addEventListener("input",se),d&&(d.addEventListener("change",se),d.addEventListener("change",Fo));const y=document.getElementById("muscle-group-select");y&&y.addEventListener("change",se),l&&!l.dataset.listenerAttached&&(l.addEventListener("submit",u=>{var E;if(u.preventDefault(),!c||!d)return;const m=c.value.trim(),b=d.value,p=He(),v=b==="strength"&&y?y.value:null,x=vi(),L=x==="sets-reps"?((E=document.getElementById("units-select"))==null?void 0:E.value)||"none":null;!m||!b||b==="strength"&&!v||(Co({name:m,categoryId:b,icon:p,muscleGroup:v,trackingType:x,units:L}),z("add-activity-modal"))}),l.dataset.listenerAttached="true"),g&&!g.dataset.listenerAttached&&(g.addEventListener("click",u=>{l&&l.requestSubmit()}),g.dataset.listenerAttached="true")}function ki(e){const t=X(e);if(!t)return;const n=ye(t.categoryId),o=document.getElementById("activity-details-icon"),a=document.getElementById("activity-details-name"),s=document.getElementById("activity-details-category");o&&(o.textContent=t.icon||n.icon,o.style.backgroundColor=`${n.color}20`),a&&(a.textContent=t.name),s&&(s.textContent=n.name);const i=document.getElementById("activity-details-form");i&&i.reset(),No(t);const r=document.getElementById("activity-details-modal");r&&(r.dataset.activityId=e),Z("activity-details-modal")}function Ei(e,t){const n=X(e);if(!n)return;const o=ye(n.categoryId),a=document.getElementById("activity-details-icon"),s=document.getElementById("activity-details-name"),i=document.getElementById("activity-details-category");a&&(a.textContent=n.icon||o.icon,a.style.backgroundColor=`${o.color}20`),s&&(s.textContent=n.name),i&&(i.textContent=o.name);const r=document.getElementById("activity-details-form");r&&r.reset(),No(n);const l=document.getElementById("activity-details-modal");if(l&&(l.dataset.activityId=e,l.dataset.recordId=t.id,l.dataset.editMode="true"),t.sets&&t.sets.length>0)t.sets.forEach((y,u)=>{if(u===0){const m=document.querySelector('[data-set-id="set-1"]');if(m){const b=m.querySelector('input[name="reps-set-1"]'),p=m.querySelector('input[name="value-set-1"]'),v=m.querySelector('select[name="unit-set-1"]');b&&(b.value=y.reps||""),p&&(p.value=y.value||""),v&&(v.value=y.unit||"none")}}else{rn(y.unit||"none");const m=`set-${u+1}`,b=document.querySelector(`[data-set-id="${m}"]`);if(b){const p=b.querySelector(`input[name="reps-${m}"]`),v=b.querySelector(`input[name="value-${m}"]`),x=b.querySelector(`select[name="unit-${m}"]`);p&&(p.value=y.reps||""),v&&(v.value=y.value||""),x&&(x.value=y.unit||"none")}}});else{const y=document.getElementById("activity-duration-input"),u=document.getElementById("duration-unit-select"),m=document.getElementById("activity-intensity-select");y&&(y.value=t.duration||""),u&&(u.value=t.durationUnit||"minutes"),m&&(m.value=t.intensity||"")}const c=document.getElementById("activity-notes-input");c&&(c.value=t.notes||"");const d=document.querySelector("#activity-details-modal .modal-header span");d&&(d.textContent="Edit Activity");const g=document.getElementById("save-activity-details");g&&(g.textContent="Update"),Z("activity-details-modal")}function No(e){const t=document.getElementById("time-tracking-section"),n=document.getElementById("sets-reps-tracking-section");!t||!n||(e.trackingType==="sets-reps"?(t.classList.add("hidden"),n.classList.remove("hidden"),Si(),rn(e.units||"none")):(n.classList.add("hidden"),t.classList.remove("hidden")))}function Si(){const e=document.getElementById("sets-container");e&&(e.innerHTML="")}function rn(e="none"){const t=document.getElementById("sets-container");if(!t)return;const n=t.children.length+1,o=`set-${n}`,a=document.createElement("div");a.className="set-item p-4 bg-gray-50 dark:bg-gray-700 rounded-xl space-y-3",a.dataset.setId=o,a.innerHTML=`
    <div class="flex items-center justify-between">
      <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Set ${n}</label>
      ${n>1?`<button type="button" class="remove-set-btn text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 p-1" data-set-id="${o}">
        <span class="material-icons text-red-600 text-base">delete</span>
      </button>`:""}
    </div>
    <div class="grid grid-cols-3 gap-2">
      <div>
        <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Reps</label>
        <input type="number" name="reps-${o}" min="1" max="999" placeholder="12" class="w-full px-3 py-2 bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded-lg text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-ios-blue/50 h-10 text-center">
      </div>
      <div>
        <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Value</label>
        <input type="number" name="value-${o}" min="0" step="0.1" placeholder="50" class="w-full px-3 py-2 bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded-lg text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-ios-blue/50 h-10 text-center">
      </div>
      <div>
        <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Unit</label>
        <select name="unit-${o}" class="w-full px-3 py-2 bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded-lg text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-ios-blue/50 h-10" style="text-align: center; text-align-last: center;">
          <option value="none" ${e==="none"?"selected":""}>None</option>
          <option value="kg" ${e==="kg"?"selected":""}>Kg</option>
          <option value="seconds" ${e==="seconds"?"selected":""}>s</option>
          <option value="minutes" ${e==="minutes"?"selected":""}>Mins</option>
        </select>
      </div>
    </div>
  `,t.appendChild(a);const s=a.querySelector(".remove-set-btn");s&&s.addEventListener("click",()=>{Ii(o)})}function Ii(e){const t=document.querySelector(`[data-set-id="${e}"]`);t&&(t.remove(),Li())}function Li(){const e=document.getElementById("sets-container");if(!e)return;e.querySelectorAll(".set-item").forEach((n,o)=>{const a=o+1,s=`set-${a}`;n.dataset.setId=s;const i=n.querySelector("label");i&&(i.textContent=`Set ${a}`);const r=n.querySelector('input[name^="reps-"]'),l=n.querySelector('input[name^="value-"]'),c=n.querySelector('select[name^="unit-"]');r&&(r.name=`reps-${s}`),l&&(l.name=`value-${s}`),c&&(c.name=`unit-${s}`);const d=n.querySelector(".remove-set-btn");d&&(d.dataset.setId=s),a===1?d&&(d.style.display="none"):d&&(d.style.display="block")})}function Ci(){const e=document.getElementById("cancel-activity-details");e&&e.addEventListener("click",()=>{z("activity-details-modal")});const t=document.getElementById("add-set-btn");t&&t.addEventListener("click",()=>{const a=document.getElementById("activity-details-modal"),s=a?a.dataset.activityId:null;if(!s)return;const i=X(s);i&&rn(i.units||"none")});const n=document.getElementById("save-activity-details");n&&n.addEventListener("click",()=>{const a=document.getElementById("activity-details-modal"),s=a?a.dataset.activityId:null,i=a?a.dataset.recordId:null,r=a?a.dataset.editMode==="true":!1;if(!s)return;const l=X(s);if(!l)return;const c=document.getElementById("activity-notes-input");let g={notes:c&&c.value.trim()?c.value.trim():""};if(l.trackingType==="sets-reps"){const u=Di();if(u.length===0)return;g.sets=u}else{const u=document.getElementById("activity-duration-input"),m=document.getElementById("duration-unit-select"),b=document.getElementById("activity-intensity-select"),p=u&&u.value?parseInt(u.value):null,v=m?m.value:"minutes",x=b&&b.value?b.value:null;if(!p)return;g.duration=p,g.durationUnit=v,g.intensity=x}if(r&&i){const u=f.fitnessSelectedDate||new Date().toISOString(),m=ie(u);Cs(i,m,g)}else{const u=f.fitnessSelectedDate||new Date().toISOString(),m=ie(u);Do(s,m,g)}a&&(delete a.dataset.recordId,delete a.dataset.editMode);const y=document.querySelector("#activity-details-modal .modal-header span");y&&(y.textContent="Activity Details"),n&&(n.textContent="Record"),z("activity-details-modal"),ce()});const o=document.getElementById("activity-details-form");o&&o.addEventListener("submit",a=>{a.preventDefault(),n&&n.click()})}function Di(){const e=document.getElementById("sets-container");if(!e)return[];const t=[];return e.querySelectorAll(".set-item").forEach((o,a)=>{const s=`set-${a+1}`,i=o.querySelector(`input[name="reps-${s}"]`),r=o.querySelector(`input[name="value-${s}"]`),l=o.querySelector(`select[name="unit-${s}"]`),c=i&&i.value?parseInt(i.value):null,d=r&&r.value?parseFloat(r.value):null,g=l?l.value:"none";c&&t.push({reps:c,value:d,unit:g})}),t}function Nt(e){const t={};return e.forEach(n=>{let o=n.muscleGroup;if(!o&&n.activityId){const a=X(n.activityId);o=a==null?void 0:a.muscleGroup}o||(o="Other"),t[o]||(t[o]=[]),t[o].push(n)}),t}let we="habits",ae=null;function Bi(){Ti(),$i(),Ue(()=>{Pn()}),Pn()}function Ti(){const e=document.getElementById("stats-view");e&&(e.innerHTML="",Ai())}function Ai(){const e=document.getElementById("stats-view");if(!e)return;const t=document.createElement("header");t.className="app-header flex justify-between items-center h-11 px-4 sm:px-6 lg:px-8 border-b border-gray-200 dark:border-gray-700 border-opacity-50 w-full",t.innerHTML=`
    <div></div>
    <h1 class="app-title text-left flex-grow text-[36px] font-extrabold leading-none flex items-end">Statistics</h1>
    <div></div>
  `,e.appendChild(t)}function $i(){const e=document.getElementById("stats-view");if(!e)return;const t=document.createElement("div");t.className="stats-container flex-1 overflow-y-auto overscroll-behavior-contain px-4 py-4 pb-8",t.id="stats-container",e.appendChild(t)}function Pn(){const e=document.getElementById("stats-container");if(e){e.innerHTML='<div class="loading-state p-8 text-center"><div class="loading-shimmer h-32 rounded-xl mb-4"></div><div class="loading-shimmer h-24 rounded-xl"></div></div>';try{const t=Oo(),n=Vo();e.innerHTML="",Pi(e,t,n),Ri(e),Ni(e,t,n),t.totalHabits===0&&n.totalActivities===0&&Vi(e)}catch(t){e.innerHTML=`
      <div class="error-state p-8 text-center">
        <div class="w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full mx-auto mb-4 flex items-center justify-center">
          <svg class="w-8 h-8 text-red-600 dark:text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-2.694-.833-3.464 0L3.349 16.5c-.77.833.192 2.5 1.732 2.5z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Error Loading Statistics</h3>
        <p class="text-gray-600 dark:text-gray-400">Please try refreshing the page</p>
      </div>
    `,console.error("[Stats] Error rendering statistics:",t)}}}function Oo(){const e=(f.habits||[]).filter(ln),t=new Date,n={totalHabits:e.length,activeHabits:e.filter(s=>!s.paused).length,pausedHabits:e.filter(s=>s.paused).length,completedToday:0,streaks:[],categoryBreakdown:new Map,completionRates:new Map,longestStreak:0,currentStreak:0,averageCompletionRate:0};e.forEach(s=>{if(!s.paused)try{const i=Mt(()=>jo(s,30),0);n.completionRates.set(s.id,{habitName:s.name,rate:i,categoryId:s.categoryId});const r=Mt(()=>_i(s),0),l=Mt(()=>Fi(s),0);n.streaks.push({habitName:s.name,currentStreak:r,longestStreak:l,categoryId:s.categoryId}),l>n.longestStreak&&(n.longestStreak=l),G(s,t)&&n.completedToday++;const c=s.categoryId;n.categoryBreakdown.has(c)||n.categoryBreakdown.set(c,{count:0,completionRate:0,habits:[]});const d=n.categoryBreakdown.get(c);d.count++,d.habits.push({name:s.name,completionRate:i})}catch(i){console.warn(`[Stats] Error processing habit ${s.name}:`,i)}}),n.categoryBreakdown.forEach((s,i)=>{const r=s.habits.reduce((l,c)=>l+(c.completionRate||0),0);s.completionRate=s.habits.length>0?r/s.habits.length:0});const o=Array.from(n.completionRates.values()),a=o.reduce((s,i)=>s+(i.rate||0),0);return n.averageCompletionRate=o.length>0?a/o.length:0,n}function jo(e,t=30){const n=new Date;let o=0,a=0;const s=parseInt(e.id.toString(),10),i=new Date(s),r=Math.floor((n-i)/(1e3*60*60*24))+1,l=Math.min(t,r);for(let c=0;c<l;c++){const d=new Date(n);d.setDate(n.getDate()-c),!(d<i)&&K(e,d)&&(a++,G(e,d)&&o++)}return a>0?o/a*100:0}function Mi(){const e=(f.habits||[]).filter(ln).filter(s=>!s.paused),t=new Date;let n=0;e.forEach(s=>{try{const i=parseInt(s.id.toString(),10),r=new Date(i),l=Math.floor((t-r)/(1e3*60*60*24))+1;n=Math.max(n,l)}catch{n=Math.max(n,30)}});const o=[],a=Math.min(30,n);return o.push({days:a,label:zi(),rate:nt(e,a)}),n>=7&&a!==7&&o.push({days:7,label:"7d",rate:nt(e,7)}),n>=30&&a!==30&&o.push({days:30,label:"30d",rate:nt(e,30)}),n>=365&&o.push({days:365,label:"1y",rate:nt(e,365)}),o}function nt(e,t){if(e.length===0)return 0;const n=e.map(a=>jo(a,t));return n.reduce((a,s)=>a+s,0)/n.length}function Hi(e){if(e.length===1){const o=e[0];return`
      <div class="completion-rates">
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <div class="text-2xl font-bold text-center mb-1 text-gray-900 dark:text-white">
            ${o.rate.toFixed(1)}%
          </div>
          <div class="text-center text-sm text-gray-600 dark:text-gray-400">
            Avg completion (${o.label})
          </div>
        </div>
      </div>
    `}const t=e.map((o,a)=>`
    <div class="carousel-slide ${a===0?"active":""}" data-slide="${a}">
      <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
        <div class="text-2xl font-bold text-center mb-1 text-gray-900 dark:text-white">
          ${o.rate.toFixed(1)}%
        </div>
        <div class="text-center text-sm text-gray-600 dark:text-gray-400">
          Avg completion (${o.label})
        </div>
      </div>
    </div>
  `).join(""),n=e.map((o,a)=>`
    <div class="carousel-dot ${a===0?"active":""}" data-slide="${a}"></div>
  `).join("");return`
    <div class="completion-rates">
      <div class="completion-carousel" id="completion-carousel">
        <div class="carousel-container">
          <div class="carousel-track" id="carousel-track">
            ${t}
          </div>
        </div>
        <div class="carousel-dots" id="carousel-dots">
          ${n}
        </div>
      </div>
    </div>
  `}function qi(){ae&&(clearInterval(ae),ae=null);const e=document.getElementById("completion-carousel"),t=document.getElementById("carousel-track"),n=document.getElementById("carousel-dots");if(!e||!t||!n)return;const o=t.querySelectorAll(".carousel-slide"),a=n.querySelectorAll(".carousel-dot");if(o.length<=1)return;let s=0,i=0,r=0;function l(p){p<0||p>=o.length||(s=p,o.forEach((v,x)=>{v.classList.toggle("active",x===s)}),a.forEach((v,x)=>{v.classList.toggle("active",x===s)}))}function c(){const p=(s+1)%o.length;l(p)}function d(){const p=(s-1+o.length)%o.length;l(p)}function g(){y(),ae=setInterval(c,4e3)}function y(){ae&&(clearInterval(ae),ae=null)}a.forEach((p,v)=>{p.addEventListener("click",()=>{l(v),y(),setTimeout(g,5e3)})}),e.addEventListener("touchstart",p=>{i=p.touches[0].clientX,y()}),e.addEventListener("touchend",p=>{r=p.changedTouches[0].clientX,b(),setTimeout(g,2e3)});let u=!1,m=0;e.addEventListener("mousedown",p=>{u=!0,m=p.clientX,y(),e.style.cursor="grabbing"}),e.addEventListener("mousemove",p=>{u&&p.preventDefault()}),e.addEventListener("mouseup",p=>{if(!u)return;u=!1,e.style.cursor="grab";const v=p.clientX,x=m-v;Math.abs(x)>50&&(x>0?c():d()),setTimeout(g,2e3)}),e.addEventListener("mouseleave",()=>{u&&(u=!1,e.style.cursor="grab",setTimeout(g,1e3))});function b(){const v=i-r;Math.abs(v)>50&&(v>0?c():d())}e.addEventListener("mouseenter",y),e.addEventListener("mouseleave",()=>{u||setTimeout(g,1e3)}),g(),e.style.cursor="grab"}function _i(e){const t=new Date;let n=0,o=new Date(t);for(;;){if(K(e,o))if(G(e,o))n++;else break;if(o.setDate(o.getDate()-1),n>365)break}return n}function Fi(e){const t=new Date;let n=0,o=0;for(let a=365;a>=0;a--){const s=new Date(t);s.setDate(t.getDate()-a),K(e,s)&&(G(e,s)?(o++,n=Math.max(n,o)):o=0)}return n}function Vo(){const e=f.activities||[],t=f.recordedActivities||{},n={totalActivities:e.length,totalSessions:0,categoriesUsed:new Set,recentSessions:0,totalDuration:0,averageSessionDuration:0};Object.values(t).forEach(a=>{a.forEach(s=>{if(n.totalSessions++,s.categoryId&&n.categoriesUsed.add(s.categoryId),s.duration){let i=parseInt(s.duration)||0;s.durationUnit==="hours"?i*=60:s.durationUnit==="seconds"&&(i/=60),n.totalDuration+=i}})});const o=new Date;return o.setDate(o.getDate()-30),Object.entries(t).forEach(([a,s])=>{new Date(a)>=o&&(n.recentSessions+=s.length)}),n.averageSessionDuration=n.totalSessions>0?n.totalDuration/n.totalSessions:0,n}function Pi(e,t,n){const o=document.createElement("div");o.className="overview-section mb-6",o.innerHTML=`
    <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Overview</h2>
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
      <div class="stat-card bg-blue-50 dark:bg-blue-900 p-4 rounded-lg hover:scale-105 transition-transform">
        <div class="stat-value text-2xl font-bold text-blue-600 dark:text-blue-300">${Ce(t.totalHabits)}</div>
        <div class="stat-label text-sm text-blue-600 dark:text-blue-300">Total Habits</div>
      </div>
      <div class="stat-card bg-green-50 dark:bg-green-900 p-4 rounded-lg hover:scale-105 transition-transform">
        <div class="stat-value text-2xl font-bold text-green-600 dark:text-green-300">${Ce(t.completedToday)}</div>
        <div class="stat-label text-sm text-green-600 dark:text-green-300">Completed Today</div>
      </div>
      <div class="stat-card bg-purple-50 dark:bg-purple-900 p-4 rounded-lg hover:scale-105 transition-transform">
        <div class="stat-value text-2xl font-bold text-purple-600 dark:text-purple-300">${Ce(n.recentSessions)}</div>
        <div class="stat-label text-sm text-purple-600 dark:text-purple-300">Fitness Sessions</div>
        <div class="text-sm text-purple-600 dark:text-purple-300 mt-1">Last 30 days</div>
      </div>
      <div class="stat-card bg-orange-50 dark:bg-orange-900 p-4 rounded-lg hover:scale-105 transition-transform">
        <div class="stat-value text-2xl font-bold text-orange-600 dark:text-orange-300">${Ce(t.longestStreak)}</div>
        <div class="stat-label text-sm text-orange-600 dark:text-orange-300">Longest Streak</div>
        <div class="text-sm text-orange-600 dark:text-orange-300 mt-1">Days</div>
      </div>
    </div>
  `,e.appendChild(o)}function zo(e,t){const n=document.createElement("div");n.className="habit-stats-section mb-6";let o="";t.categoryBreakdown.forEach((i,r)=>{const l=f.categories.find(g=>g.id===r),c=l?l.name:"Unknown",d=l?l.color:"#888";o+=`
      <div class="category-stat mb-3 p-3 rounded-lg border-l-4 bg-gray-50 dark:bg-gray-800" style="border-left-color: ${d};">
        <div class="flex justify-between items-center">
          <span class="font-medium text-sm">${c}</span>
          <span class="text-sm text-gray-600 dark:text-gray-400">${i.count} habits</span>
        </div>
        <div class="text-sm text-gray-600 dark:text-gray-400">
          Avg: ${i.completionRate.toFixed(1)}%
        </div>
      </div>
    `});const a=Mi(),s=Hi(a);n.innerHTML=`
    <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Habit Stats</h2>
    
    <div class="grid grid-cols-2 gap-3 mb-4">
      ${s}
      
      <div class="streaks">
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <div class="text-2xl font-bold text-center mb-1 text-gray-900 dark:text-white">
            ${t.longestStreak}
          </div>
          <div class="text-center text-sm text-gray-600 dark:text-gray-400">
            Longest streak (days)
          </div>
        </div>
      </div>
    </div>
    
    ${o?`<div class="category-breakdown">
      <h3 class="text-lg font-medium mb-3 text-gray-900 dark:text-white">By Category</h3>
      ${o}
    </div>`:""}
  `,e.appendChild(n),a.length>1&&qi()}function Go(e,t){const n=document.createElement("div");n.className="fitness-stats-section mb-8 pb-6",n.innerHTML=`
    <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Fitness Stats</h2>
    
    <div class="grid grid-cols-2 gap-3">
      <div class="stat-card bg-red-50 dark:bg-red-900 p-4 rounded-lg hover:scale-105 transition-transform">
        <div class="stat-value text-2xl font-bold text-red-600 dark:text-red-300">${Ce(t.totalActivities)}</div>
        <div class="stat-label text-sm text-red-600 dark:text-red-300">Total Activities</div>
      </div>
      <div class="stat-card bg-indigo-50 dark:bg-indigo-900 p-4 rounded-lg hover:scale-105 transition-transform">
        <div class="stat-value text-2xl font-bold text-indigo-600 dark:text-indigo-300">${Ce(t.recentSessions)}</div>
        <div class="stat-label text-sm text-indigo-600 dark:text-indigo-300">Recent Sessions</div>
        <div class="text-sm text-indigo-600 dark:text-indigo-300 mt-1">Last 30 days</div>
      </div>
      <div class="stat-card bg-teal-50 dark:bg-teal-900 p-4 rounded-lg hover:scale-105 transition-transform">
        <div class="stat-value text-2xl font-bold text-teal-600 dark:text-teal-300">${Nn(t.totalDuration)}</div>
        <div class="stat-label text-sm text-teal-600 dark:text-teal-300">Total Time</div>
      </div>
      <div class="stat-card bg-pink-50 dark:bg-pink-900 p-4 rounded-lg hover:scale-105 transition-transform">
        <div class="stat-value text-2xl font-bold text-pink-600 dark:text-pink-300">${Nn(t.averageSessionDuration)}</div>
        <div class="stat-label text-sm text-pink-600 dark:text-pink-300">Avg Session</div>
      </div>
    </div>
  `,e.appendChild(n)}function Ri(e){const t=document.createElement("div");t.className="stats-toggle-section mb-6",t.innerHTML=`
    <div class="toggle-container bg-gray-100 dark:bg-gray-800 p-1 rounded-xl inline-flex w-full max-w-md mx-auto">
      <button 
        id="habits-toggle" 
        class="toggle-btn flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all duration-300 ${we==="habits"?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"}"
        data-view="habits"
      >
        Habits
      </button>
      <button 
        id="fitness-toggle" 
        class="toggle-btn flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all duration-300 ${we==="fitness"?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"}"
        data-view="fitness"
      >
        Fitness
      </button>
    </div>
  `,e.appendChild(t),Oi()}function Ni(e,t,n){const o=document.createElement("div");o.className="detailed-stats-section",o.id="detailed-stats-container",o.style.transition="opacity 0.3s ease, transform 0.3s ease",o.style.opacity="1",o.style.transform="translateY(0)",we==="habits"?(o.innerHTML="",zo(o,t)):(o.innerHTML="",Go(o,n)),e.appendChild(o)}function Oi(){const e=document.getElementById("habits-toggle"),t=document.getElementById("fitness-toggle");!e||!t||(e.addEventListener("click",()=>Rn("habits")),t.addEventListener("click",()=>Rn("fitness")))}function Rn(e){if(we===e)return;we=e;const t=document.getElementById("detailed-stats-container");t&&(t.style.opacity="0",t.style.transform="translateY(10px)",setTimeout(()=>{ae&&(clearInterval(ae),ae=null);const n=Oo(),o=Vo();t.innerHTML="",we==="habits"?zo(t,n):Go(t,o),ji(),t.style.opacity="1",t.style.transform="translateY(0)"},150))}function ji(){const e=document.getElementById("habits-toggle"),t=document.getElementById("fitness-toggle");!e||!t||(e.className="toggle-btn flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all duration-300",t.className="toggle-btn flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all duration-300",we==="habits"?(e.className+=" bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm",t.className+=" text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"):(t.className+=" bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm",e.className+=" text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"))}function Vi(e){e.innerHTML=`
    <div class="empty-state flex flex-col items-center justify-center py-16 px-4 text-center">
      <div class="w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-6">
        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-3">No Data Yet</h3>
      <p class="text-gray-600 dark:text-gray-400 max-w-sm mx-auto mb-6">
        Start tracking habits and fitness activities to see your personalized statistics here.
      </p>
      <button class="bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition-colors" onclick="document.querySelector('[data-view=\\"home-view\\"]').click()">
        Start Tracking
      </button>
    </div>
  `}function Ce(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}function Nn(e){if(e<60)return`${Math.round(e)}m`;if(e<1440){const t=Math.floor(e/60),n=Math.round(e%60);return n>0?`${t}h ${n}m`:`${t}h`}else{const t=Math.floor(e/1440),n=Math.floor(e%1440/60);return n>0?`${t}d ${n}h`:`${t}d`}}function ln(e){return e&&typeof e.id=="string"&&typeof e.name=="string"&&typeof e.paused=="boolean"}function zi(){const e=(f.habits||[]).filter(ln).filter(o=>!o.paused);if(e.length===0)return"30d";const t=new Date;let n=0;return e.forEach(o=>{try{const a=parseInt(o.id.toString(),10),s=new Date(a),i=Math.floor((t-s)/(1e3*60*60*24))+1,r=Math.min(30,i);n=Math.max(n,r)}catch{n=Math.max(n,30)}}),n===1?"today":n<=7?`${n}d`:n>=30?"30d":`${n}d`}function Mt(e,t=0){try{const n=e();return isNaN(n)?t:n}catch(n){return console.warn("[Stats] Calculation error:",n),t}}let ve=null;function Gi(){if(document.getElementById("install-banner"))return;const e=document.createElement("div");e.id="install-banner",e.className="fixed inset-x-4 bottom-4 md:inset-x-auto md:right-4 md:bottom-4 z-50 flex items-center justify-between gap-4 px-4 py-3 rounded-xl shadow-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700";const t=document.createElement("span");t.className="text-sm font-medium text-gray-900 dark:text-gray-100",t.textContent="Add Healthy Habits Tracker to your Home Screen?";const n=document.createElement("div");n.className="flex items-center gap-2";const o=document.createElement("button");o.id="install-btn",o.className="px-3 py-1.5 rounded-lg text-sm font-semibold text-white bg-ios-blue hover:bg-ios-blue/90 focus:outline-none focus:ring-2 focus:ring-ios-blue/50",o.textContent="Install";const a=document.createElement("button");a.id="dismiss-install-btn",a.className="px-3 py-1.5 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400/50",a.textContent="Not now",n.appendChild(o),n.appendChild(a),e.appendChild(t),e.appendChild(n),document.body.appendChild(e),o.addEventListener("click",async()=>{if(ve){e.remove(),ve.prompt();try{await ve.userChoice}finally{ve=null}}}),a.addEventListener("click",()=>{e.remove(),ve=null})}function Yi(){const e=document.getElementById("install-banner");e&&e.remove()}function Ui(){"beforeinstallprompt"in window&&(window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),ve=e,Gi()}),window.addEventListener("appinstalled",()=>{Yi(),ve=null}))}function Wi(){if(document.getElementById("update-banner"))return null;const e=document.createElement("div");e.id="update-banner",e.className="fixed inset-x-4 bottom-4 md:inset-x-auto md:right-4 md:bottom-4 z-50 flex items-center justify-between gap-4 px-4 py-3 rounded-xl shadow-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700";const t=document.createElement("span");t.className="text-sm font-medium text-gray-900 dark:text-gray-100",t.textContent="A new version is available.";const n=document.createElement("button");return n.className="px-3 py-1.5 rounded-lg text-sm font-semibold text-white bg-ios-blue hover:bg-ios-blue/90 focus:outline-none focus:ring-2 focus:ring-ios-blue/50",n.textContent="Refresh",n.addEventListener("click",()=>location.reload()),e.appendChild(t),e.appendChild(n),document.body.appendChild(e),e}function On(){Wi()}function Yo(){const e=new Date,t=f.selectedGroup||"daily",n=new Date(f.selectedDate);Le(e,n,t)||C(o=>{o.selectedDate=e.toISOString()})}Yo();setInterval(Yo,60*60*1e3);Jo();typeof window<"u"&&new URLSearchParams(window.location.search).get("test")==="true"&&(window.process=window.process||{},window.process.env=window.process.env||{},window.process.env.NODE_ENV="test",console.log("üß™ Test mode enabled! Console assertions will run."));function Xi(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>{e.waiting&&On(),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&On()})})}).catch(e=>console.error("[sw] registration failed",e))})}function jn(){Xi(),ia().then(()=>{localStorage.removeItem("activeHabitTrackerTab"),M(async()=>{const{appData:t}=await Promise.resolve().then(()=>ea);return{appData:t}},void 0).then(({appData:t})=>{t.selectedGroup="daily"}),ca(),da(),ga(),po(),xs(),$s(),Bi(),Ui();const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",ua)}).catch(e=>{console.error("[DEBUG] Bootstrap failed:",e)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",jn):jn();export{M as _,f as a,Ca as b,z as c,Da as d,La as e,no as f,en as l,C as m,Z as o,qe as r,Gt as s};
