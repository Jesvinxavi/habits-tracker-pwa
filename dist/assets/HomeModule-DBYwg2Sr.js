const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-CM0JCX04.js","assets/chunk-D8P7fKnl.js","assets/chunk-97VqPUVn.js","assets/chunk-1sPJXvOa.js","assets/chunk-Dwp9fxXX.js","assets/chunk-jPjFmsdb.js","assets/manage-Cx5UEkQk.js"])))=>i.map(i=>d[i]);
import{g as e,b as t,_ as n,d as o,A as s,u as i,f as a,j as l,h as r,t as d,s as c}from"./chunk-D8P7fKnl.js";import{e as p,b as h}from"./chunk-CM0JCX04.js";import{j as u,m}from"./chunk-1sPJXvOa.js";import{g,u as y,i as b}from"./index-CYs5l4CO.js";import"./chunk-97VqPUVn.js";import"./chunk-Dwp9fxXX.js";import"./chunk-jPjFmsdb.js";const f={daily:"today",weekly:"view_week",monthly:"date_range",yearly:"event"},v={mount(e,t={}){this.container=e,this.callbacks=t,this._createHeader(),this._bindEvents()},_createHeader(){this.titleContainer=this.container,this.headerEl=this.container.closest(".habits-header"),this._buildGroupPill(),this._buildHolidayToggle()},_buildGroupPill(){if(!this.titleContainer)return;if(this.titleContainer.querySelector("#group-pill"))return;this.titleContainer.innerHTML="";const t=document.createElement("div");t.id="group-pill",t.className="flex items-center gap-2 px-4 py-1.5 bg-blue-50 dark:bg-gray-800 rounded-full cursor-pointer select-none w-full justify-center text-lg font-bold home-inset",this.titleContainer.style.display="flex",this.titleContainer.style.justifyContent="center",t.innerHTML=`\n      <span id="group-icon" class="material-icons text-xl">${f[e().selectedGroup]}</span>\n      <span id="group-title" class="text-xl font-bold">${p(e().selectedGroup)} Habits</span>\n    `,this.titleContainer.appendChild(t),this.headerEl&&(this.headerEl.style.paddingBottom="8px")},_buildHolidayToggle(){if(!this.headerEl)return;this.headerEl.classList.add("justify-between");let e=document.getElementById("holiday-toggle");e||(e=document.createElement("button"),e.id="holiday-toggle",e.className="relative flex items-center justify-center h-9 bg-gray-200 text-gray-500 rounded-full overflow-hidden select-none mr-4",e.style.width="36px",e.innerHTML='<span class="plane material-icons absolute left-2 top-1/2 -translate-y-1/2 transition-transform text-2xl">flight</span><span class="label whitespace-nowrap ml-1 text-sm font-medium opacity-0 transition-opacity">Holiday Mode</span>',this.headerEl.appendChild(e)),this._updateHolidayToggle()},_updateHolidayToggle(){const t=document.getElementById("holiday-toggle");t&&n(async()=>{const{isHoliday:e}=await import("./chunk-CM0JCX04.js").then(e=>e.B);return{isHoliday:e}},__vite__mapDeps([0,1,2,3,4])).then(({isHoliday:n})=>{if("daily"!==(e().selectedGroup||"daily"))return void(t.style.display="none");t.style.display="";const o=n(h(new Date(e().selectedDate)));t.classList.toggle("bg-ios-orange",o),t.classList.toggle("bg-gray-200",!o),t.classList.toggle("text-white",o),t.classList.toggle("text-gray-500",!o);const s=t.querySelector(".plane"),i=t.querySelector(".label");s&&(o?(s.style.left="8px",s.style.transform="translateY(-50%) rotate(-90deg)"):(s.style.left="50%",s.style.transform="translate(-50%, -50%) rotate(-90deg)")),i&&(o?(i.classList.add("opacity-100"),t.classList.add("pl-9","pr-4"),t.classList.remove("justify-center"),t.style.width="140px"):(i.classList.remove("opacity-100"),t.classList.remove("pl-9","pr-4"),t.classList.add("justify-center"),t.style.width="36px"))})},_bindEvents(){const e=document.getElementById("holiday-toggle");e&&e.addEventListener("click",this._handleHolidayToggle.bind(this));const t=document.getElementById("group-pill");t&&this._bindGroupPillEvents(t)},_handleHolidayToggle(){const t=h(new Date(e().selectedDate));Promise.all([n(()=>import("./chunk-CM0JCX04.js").then(e=>e.B),__vite__mapDeps([0,1,2,3,4])),n(()=>import("./chunk-97VqPUVn.js").then(e=>e.C),__vite__mapDeps([2,3,1,0,4]))]).then(([n,{showConfirm:o}])=>{const{toggleSingleHoliday:s}=n;e().holidayPeriods.some(e=>t>=e.startISO&&t<=e.endISO)?o({title:"Managed by Holiday Period",message:"This date is set as a holiday through a holiday period. Please edit using the Holiday Period manager.",okText:"OK",cancelText:"",onOK:()=>{}}):(s(t),this.callbacks.onHolidayToggle&&this.callbacks.onHolidayToggle(!0))})},_bindGroupPillEvents(t){let i=0,a=!1,l=!1,r=!1;const d=e=>{"BUTTON"!==e.target.tagName&&(i=e.touches?e.touches[0].clientX:e.clientX,a=!0,l=!1,r=!0)},c=e=>{if(!a||!r)return;const t=e.touches?e.touches[0].clientX:e.clientX;Math.abs(t-i)>5&&(l=!0,e.preventDefault())},p=async t=>{if(!a)return;const d=(t.changedTouches?t.changedTouches[0].clientX:t.clientX)-i;if(l&&Math.abs(d)>=40){const t=d<0?1:-1,i=this._findNextGroupWithHabits(e().selectedGroup,t);o(s.setSelectedGroup(i));const a=new Date;let l;switch(i){case"weekly":{const e=(a.getDay()+6)%7;l=new Date(a),l.setDate(a.getDate()-e),l.setHours(0,0,0,0);break}case"monthly":l=new Date(a.getFullYear(),a.getMonth(),1),l.setHours(0,0,0,0);break;case"yearly":l=new Date(a.getFullYear(),0,1),l.setHours(0,0,0,0);break;default:l=new Date(a),l.setHours(0,0,0,0)}const{getLocalMidnightISOString:r}=await n(async()=>{const{getLocalMidnightISOString:e}=await import("./chunk-CM0JCX04.js").then(e=>e.A);return{getLocalMidnightISOString:e}},__vite__mapDeps([0,1,2,3,4]));o(s.setSelectedDate(r(l))),this.callbacks.onGroupChange&&this.callbacks.onGroupChange(i)}a=!1,l=!1,r=!1};t.addEventListener("touchstart",d,{passive:!0}),t.addEventListener("touchmove",c,{passive:!1}),t.addEventListener("touchend",p,{passive:!0}),t.addEventListener("mousedown",d),t.addEventListener("mousemove",c),t.addEventListener("mouseup",p),t.addEventListener("mouseleave",p)},_findNextGroupWithHabits(n,o){const s=["daily","weekly","monthly","yearly"],i=s.indexOf(n);for(let a=1;a<=s.length;a++){const n=s[(i+o*a+s.length)%s.length];if("daily"===n||e().habits.some(e=>t(e,n)&&!e.paused))return n}return n},render(){this._updateGroupPill(),this._updateHolidayToggle()},_updateGroupPill(){const t=document.getElementById("group-title"),n=document.getElementById("group-icon");t&&(t.textContent=`${p(e().selectedGroup)} Habits`),n&&(n.classList.add("material-icons"),n.textContent=f[e().selectedGroup])},unmount(){const e=document.getElementById("holiday-toggle");e&&e.removeEventListener("click",this._handleHolidayToggle),this.container&&(this.container.innerHTML="")}},C={mount(e,t={}){this.container=e,this.callbacks=t,e.innerHTML="";const n=document.createElement("hh-calendar");return n.setAttribute("state-key","selectedDate"),n.addEventListener("select",e=>{this.callbacks.onDateChange&&this.callbacks.onDateChange(e.detail.date)}),e.appendChild(n),this.calendarEl=n,u(n),n},render(){this.calendarEl?.refresh?.(),this._updateSelectedDay()},_updateSelectedDay(){this.calendarEl&&n(async()=>{const{isSameDay:e}=await import("./chunk-CM0JCX04.js").then(e=>e.A);return{isSameDay:e}},__vite__mapDeps([0,1,2,3,4])).then(({isSameDay:e})=>{n(async()=>{const{getState:e}=await import("./chunk-D8P7fKnl.js").then(e=>e.k);return{getState:e}},__vite__mapDeps([1,2,3,0,4])).then(({getState:t})=>{this.calendarEl.querySelectorAll(".day-item").forEach(n=>{const o=e(new Date(n.dataset.date),new Date(t().selectedDate));n.classList.toggle("current-day",o);const s=e(new Date(n.dataset.date),new Date);n.classList.toggle("today",s&&!o)}),this.calendarEl.scrollToSelected&&setTimeout(()=>{this.calendarEl.scrollToSelected()},10)})})},unmount(){this.container&&(this.container.innerHTML=""),this.calendarEl=null}},w={mount(e){this.container=e,this.render()},render(){const e=g();i(e),y()},unmount(){}};let x={Completed:!0,Skipped:!0};try{const e=localStorage.getItem("homeSectionVisibility");e&&(x={...x,...JSON.parse(e)})}catch(P){console.warn("Failed to load section visibility:",P)}function k(e,t){x.Completed=e,x.Skipped=t}const{belongsToSelectedGroup:E,isHabitScheduledOnDate:S,isHabitCompleted:_,isHabitSkippedToday:H}=l,L={Completed:!1,Skipped:!1},D={test:()=>!0,mount(e,t={}){this.container=e,this.callbacks=t,this.isInEditMode=!1,this._createContainer(),this.render()},_createContainer(){this.container&&(this.container.classList.remove("bg-white","dark:bg-gray-800","shadow-ios","rounded-2xl"),this.container.style.background="transparent",this.container.style.boxShadow="none",this.container.style.borderRadius="0"),this.container.querySelectorAll(".habit-card").forEach(e=>e.remove())},render(){if(!this.container)return;this.container.innerHTML="";const t=new Date(e().selectedDate),n=e().selectedGroup,o=e().habits.filter(e=>E(e,n)&&S(e,t));if(0===o.length)return void this._renderEmptyPlaceholder(n);const s=o.filter(e=>!_(e,t)&&H(e,t)),i=o.filter(e=>!_(e,t)&&!H(e,t)),a=i.filter(e=>!e.scheduledTime),l=i.filter(e=>e.scheduledTime),r=o.filter(e=>_(e,t)),d=document.createDocumentFragment(),c=this._buildSection("Anytime",a),p=this._buildSection("Scheduled",l),h=this._buildSection("Completed",r),u=this._buildSection("Skipped",s);c&&d.appendChild(c),p&&d.appendChild(p),h&&d.appendChild(h),u&&d.appendChild(u),this.container.appendChild(d),this._adjustContainerHeight()},_adjustContainerHeight(){if("undefined"==typeof window)return;const e=this.container.getBoundingClientRect();let t=0;const n=this.container.closest(".content-area");if(n){const e=window.getComputedStyle(n);t=parseFloat(e.paddingBottom)||0}const o=window.innerHeight-e.top-t;o>0&&(this.container.style.maxHeight=o+"px",this.container.style.overflowY="auto")},_renderEmptyPlaceholder(e){const t=document.createElement("div");t.className="empty-placeholder flex flex-col items-center justify-center py-10 mt-6 text-gray-400";const n={daily:"No Scheduled Habits Today",weekly:"No Scheduled Habits This Week",monthly:"No Scheduled Habits This Month",yearly:"No Scheduled Habits This Year"}[e]||"No Scheduled Habits";t.innerHTML=`\n      <div class="w-[4.5rem] h-[4.5rem] rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4">\n        <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24">\n          <path d="M9 17l-4-4 1.41-1.41L9 14.17l8.59-8.59L19 7l-10 10z"/>\n        </svg>\n      </div>\n      <p class="text-lg font-medium">${n}</p>`,this.container.appendChild(t)},_buildSection(t,n){if("Completed"===t&&!x.Completed||"Skipped"===t&&!x.Skipped)return null;const o=document.createElement("div"),s="Completed"===t||"Skipped"===t;o.className="habits-section"+(s?" collapsible":""),s&&(o.id=t.toLowerCase()+"-section"),o.style.paddingTop="0.5rem",o.style.paddingBottom="0.5rem";let i=`<h3 class="section-label text-base font-semibold m-0">${t}${s?` <span class="opacity-60">(${n.length})</span>`:""}</h3>`;if(s){const e=L[t]||!1;i+=`<button class="toggle-section flex items-center gap-1 text-sm font-medium select-none ml-auto self-start p-0 bg-none border-none outline-none cursor-pointer" style="user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;"><span style="user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;">${e?"Show":"Hide"}</span><svg class="w-4 h-4 transition-transform duration-200" viewBox="0 0 24 24" stroke="currentColor" fill="none" ${e?"transform rotate-180":""}>\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />\n        </svg>\n      </button>`}if(o.innerHTML=`<div class="section-header flex items-center mb-0.5 home-inset">${i}</div>`,0===n.length)return null;if(s&&L[t]&&o.classList.add("collapsed"),n.forEach(t=>{const n=this._buildHabitCard(t);if(n){const s=new Date(e().selectedDate);let i=n;i=_(t,s)||H(t,s)?this._createSwipeToRestoreContainer(n,t):this._createSwipeToSkipContainer(n,t),o.appendChild(i)}}),s){const e=o.querySelector(".toggle-section");e&&e.addEventListener("click",n=>{n.stopPropagation();const s=o.classList.toggle("collapsed");L[t]=s;const i=e.querySelector("svg");i&&(i.style.transform=s?"rotate(180deg)":"rotate(0deg)");const a=e.querySelector("span");a&&(a.textContent=s?"Show":"Hide")})}return o},_buildHabitCard(t){const n=new Date(e().selectedDate),i="number"==typeof t.target&&t.target>0,l=e().categories.find(e=>e.id===t.categoryId)||{color:"#888",name:""},c=document.createElement("div");c.className="habit-card flex items-center px-4 py-2 rounded-xl",c.style.marginBottom="0.25rem",c.dataset.habitId=t.id,c.style.width="100%";const p=a(t,n);let h=i&&t.progress&&t.progress[p]||0;const u=`<div class="habit-icon w-9 h-9 flex-shrink-0 rounded-full flex items-center justify-center mr-1 text-xl" style="border:2px solid ${l.color}; color:${l.color}">${t.icon||"üìã"}</div>`;let m=`<div class="habit-content flex-grow">\n        <div class="habit-name font-semibold leading-tight">${t.name}</div>`;m+=`<span class="category-pill inline-block whitespace-nowrap px-2 py-0.5 rounded-lg text-xs font-medium mt-0" style="display:inline-block;width:max-content;background:${l.color};color:#fff;border-radius:8px;">${l.name||""}</span>`;let g="",y=null;if(i){c.style.position="relative";const e=e=>{c.style.background=d(l.color,e)};e(t.target?Math.min(h/t.target,1):0);const i=document.createElement("div");i.className="progress-box px-2 py-0.5 text-xs font-bold rounded-md mb-1",i.style.border=`1px solid ${l.color}`,i.style.color="#000",i.style.background="#FFFFFF",i.textContent=`${h}/${t.target}`;const r=t.targetUnit&&"none"!==t.targetUnit?t.targetUnit:null;if(y=document.createElement("div"),y.className="ml-auto flex flex-col items-end",y.style.position="relative",y.style.zIndex="1",y.appendChild(i),r){const e=document.createElement("span");e.className="unit-pill whitespace-nowrap px-2 py-0.5 rounded-lg text-xs font-medium",e.style.background=`${l.color}`,e.style.color="#fff",e.textContent=r,y.appendChild(e)}const u=()=>{if("1"===c.dataset.editing)return;c.dataset.editing="1",this.isInEditMode=!0;const l=c.querySelector(".habit-content");l&&(l.style.display="none"),y.style.display="none";const r=document.createElement("div");r.className="edit-controls flex items-center gap-2 mx-auto",r.style.transform="translateX(-28px)";const d=document.createElement("button");d.className="minus-edit rounded-full flex items-center justify-center font-extrabold text-white border-2 border-black",d.style.background="#DC2626",d.style.fontSize="1.8rem",d.style.width="44px",d.style.height="44px",d.textContent="‚àí";let u=t.defaultIncrement||1;const m=document.createElement("div");m.className="value-box px-4 border-2 border-black bg-white text-xl font-bold rounded-lg cursor-pointer select-none flex items-center justify-center",m.textContent=h,m.style.height="44px";const g=(e=>{const t=document.createElement("span");t.style.visibility="hidden",t.style.font="inherit",t.textContent=e,document.body.appendChild(t);const n=t.getBoundingClientRect().width;return t.remove(),n})("88")+16;let b=g;m.style.minWidth=b+"px",m.classList.add("text-center","font-mono"),m.onclick=e=>{if(e.stopPropagation(),m.querySelector("input"))return;const n=m.getBoundingClientRect();b=n.width,m.style.width=b+"px",m.style.minWidth=b+"px";const o=document.createElement("input");o.type="text",o.inputMode="numeric",o.pattern="[0-9]*",o.className="w-full text-center outline-none",o.placeholder=h,o.style.MozAppearance="textfield",o.style.WebkitAppearance="none",o.style.appearance="textfield",o.style.border="none",o.style.background="transparent",m.textContent="",m.appendChild(o),o.focus(),u=0;const s=()=>{const e=parseInt(o.value,10);u=!isNaN(e)&&e>0?e:t.defaultIncrement||1,m.textContent=h};o.addEventListener("keydown",e=>{"Enter"===e.key&&s()}),o.addEventListener("blur",s);const i=()=>{const e=document.createElement("span");e.style.visibility="hidden",e.style.position="absolute",e.style.whiteSpace="pre",e.style.font=getComputedStyle(o).font,e.textContent=o.value||"0",document.body.appendChild(e);const t=e.getBoundingClientRect().width;e.remove();const n=getComputedStyle(m),s=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight),i=parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth),a=Math.max(g,t+s+i+4);m.style.width=a+"px"};o.addEventListener("input",()=>requestAnimationFrame(i))};const f=document.createElement("button");f.className="plus-edit rounded-full flex items-center justify-center font-extrabold text-white border-2 border-black",f.style.background="#16A34A",f.style.fontSize="1.8rem",f.style.width="44px",f.style.height="44px",f.textContent="+";const v=document.createElement("button");v.className="confirm-edit w-8 h-8 rounded-full flex items-center justify-center text-white border-2 border-black absolute right-0",v.style.background="#16A34A",v.textContent="‚úî",r.appendChild(d),r.appendChild(m),r.appendChild(f);const C=document.createElement("div");C.className="flex items-center relative w-full",C.appendChild(r),C.appendChild(v),c.appendChild(C);const w=n=>{if(0===u)return;const o=n*u;h+=o,h<0&&(h=0),h>t.target&&(h=t.target),(n=>{m.textContent=n,i.textContent=`${n}/${t.target}`;const o=m.scrollWidth+1;o>b&&(b=o,m.style.minWidth=b+"px");const s=t.target?Math.min(n/t.target,1):0;e(s)})(h),this._adjustProgress(t.id,t.target,o),u=t.defaultIncrement||1};f.addEventListener("click",e=>{e.stopPropagation(),w(1)}),d.addEventListener("click",e=>{e.stopPropagation(),w(-1)}),v.addEventListener("click",e=>{e.stopPropagation(),c.dataset.editing="0",this.isInEditMode=!1,C.remove();const i=c.querySelector(".habit-content");i&&(i.style.display=""),y.style.display="",o(s.setHabitProgress(t.id,p,h)),t.target&&h>=t.target&&o(s.toggleHabitCompleted(t.id,a(t,n))),this.callbacks.onHabitComplete&&this.callbacks.onHabitComplete(t.id,h>=t.target)});const x=m.offsetHeight,k=x+"px";[d,f].forEach(e=>{e.style.width=k,e.style.height=k,e.style.fontSize=.6*x+"px"}),m.style.pointerEvents="auto",m.style.zIndex="5"};y.addEventListener("click",e=>{e.stopPropagation(),u()})}else{const e=_(t,n)?"‚úîÔ∏è":"";let o="";t.scheduledTime&&(o=`<span class="time-pill whitespace-nowrap px-3 py-1 rounded-lg text-sm font-semibold mr-1" style="background:${l.color}; color:#fff;border-radius:8px;font-size:0.875rem;">${t.scheduledTime}</span>`),g=`<div class="ml-auto flex items-center gap-1">${o}<button class="complete-toggle w-8 h-8 rounded-full flex items-center justify-center" style="border:2px solid ${l.color}; color:${l.color}">${e}</button></div>`}if(m+="</div>",c.innerHTML=u+m+g,y&&c.appendChild(y),i||(c.style.background=r(l.color,.07)),c.style.border=`3px solid ${l.color}`,!i){const e=c.querySelector(".complete-toggle");e&&e.addEventListener("click",e=>{e.stopPropagation(),o(s.toggleHabitCompleted(t.id,a(t,n))),b(),this.callbacks.onHabitComplete&&this.callbacks.onHabitComplete(t.id,!_(t,n))})}return _(t,n)?this._applyCompletedStyling(c,t):H(t,n)&&this._applySkippedStyling(c,t),c},_applyCompletedStyling(e,t){e.style.border="3px solid #4B5563",e.style.background="#F3F4F6";const n=e.querySelector(".category-pill");n&&(n.style.background="#9CA3AF",n.style.color="#fff"),e.querySelectorAll(".ml-auto, .habit-counter, .target-pill, .complete-toggle, .time-pill, .progress-box").forEach(e=>e.remove());const o=document.createElement("div");o.className="completed-pill flex items-center gap-1 px-3 py-1 rounded-lg",o.style.border="2px solid #16A34A",o.style.background="#DCFCE7",o.style.color="#16A34A",o.innerHTML='<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M9 16.2l-3.5-3.5 1.42-1.42L9 13.34 17.59 4.75 19 6.17z"/></svg><span class="text-sm font-semibold">Completed</span>',e.appendChild(o);const s=e.querySelector(".habit-icon");s&&(s.style.border="2px solid #9CA3AF",s.style.color="#9CA3AF")},_applySkippedStyling(e,t){e.style.border="3px solid #4B5563",e.style.background="#F3F4F6";const n=e.querySelector(".habit-icon");n&&(n.style.border="2px solid #9CA3AF",n.style.color="#9CA3AF");const o=e.querySelector(".category-pill");o&&(o.style.background="#9CA3AF",o.style.color="#fff"),e.querySelectorAll(".ml-auto, .habit-counter, .target-pill, .complete-toggle, .time-pill, .progress-box").forEach(e=>e.remove());const s=document.createElement("div");s.className="skipped-pill flex items-center gap-1 px-3 py-1 rounded-lg",s.style.border="2px solid #F97316",s.style.background="#FFEDD5",s.style.color="#F97316",s.innerHTML='<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6 18l8.5-6L6 6v12zm9-12v12h2V6h-2z"/></svg><span class="text-sm font-semibold">Skipped</span>',e.appendChild(s)},_createSwipeToRestoreContainer(t,n){const i=document.createElement("div");i.className="swipe-container relative overflow-visible home-inset";const l=document.createElement("button");l.className="restore-btn absolute top-0 right-0 h-full",l.style.width="20%",l.style.background="#16A34A",l.style.color="#fff",l.style.borderRadius="0.75rem",l.style.fontWeight="600",l.textContent="Restore";const r=document.createElement("div");r.className="swipe-slide transition-transform",r.style.width="100%",r.style.position="relative",r.style.zIndex="1",r.style.background="#FFFFFF",r.style.borderRadius="0.75rem",i.appendChild(l),i.appendChild(r),r.appendChild(t);const d=new Date(e().selectedDate),c=_(n,d),p=H(n,d);return c?m(i,r,n,{onRestore:()=>{o(s.toggleHabitCompleted(n.id,a(n,new Date(e().selectedDate))));const t=a(n,new Date(e().selectedDate));o(s.updateHabit(n.id,{progress:{[t]:0}})),b()}}):p&&m(i,r,n,{onRestore:()=>{const t=h(new Date(e().selectedDate));o(s.updateHabit(n.id,{skippedDates:e().habits.find(e=>e.id===n.id).skippedDates.filter(e=>e!==t)}));const i=a(n,new Date(e().selectedDate));o(s.updateHabit(n.id,{progress:{[i]:0}})),b()}}),i},_createSwipeToSkipContainer(t,n){const i=document.createElement("div");i.className="swipe-container relative overflow-visible home-inset";const a=document.createElement("button");a.className="skip-btn absolute top-0 right-0 h-full",a.style.width="20%",a.style.background="#F97316",a.style.color="#fff",a.style.borderRadius="0.75rem",a.style.fontWeight="600",a.textContent="Skip";const l=document.createElement("div");return l.className="swipe-slide transition-transform",l.style.width="100%",l.style.position="relative",l.style.zIndex="1",l.style.background="#FFFFFF",l.style.borderRadius="0.75rem",i.appendChild(a),i.appendChild(l),l.appendChild(t),m(i,l),a.addEventListener("click",()=>{const t=h(new Date(e().selectedDate));o(s.updateHabit(n.id,{skippedDates:[...e().habits.find(e=>e.id===n.id).skippedDates,t]})),b()}),i},unmount(){this.container&&(this.container.innerHTML="")},_adjustProgress(t,n,i){if(this.isInEditMode){const o=e(),s=o.habits.find(e=>e.id===t);if(!s)return;const l=a(s,new Date(o.selectedDate));"object"==typeof s.progress&&null!==s.progress||(s.progress={});let r=(s.progress[l]||0)+i;return r<0&&(r=0),r>n&&(r=n),void(s.progress[l]=r)}const l=e().habits.find(e=>e.id===t);if(!l)return;const r=a(l,new Date(e().selectedDate));let d=(l.progress?.[r]||0)+i;d<0&&(d=0),d>n&&(d=n),o(s.updateHabit(l.id,{progress:{[r]:d}}))}},T={mount(e,t={}){this.container=e,this.callbacks=t},render(){},unmount(){this.container&&(this.container.innerHTML="")}},M={mount(e,t={}){this.container=e,this.callbacks=t,this._createStructure(),this._mountComponents(),this.setupResponsiveBehavior()},_createStructure(){this.headerContainer=this.container.querySelector(".habits-header .habits-title"),this.calendarContainer=this.container.querySelector(".week-calendar"),this.progressContainer=this.container.querySelector(".progress-section"),this.habitsContainer=this.container.querySelector(".habits-container"),this.controlsContainer=this.container.querySelector(".habits-header")},_mountComponents(){v.mount(this.headerContainer,{onGroupChange:this.callbacks.onGroupChange,onHolidayToggle:this.callbacks.onHolidayToggle}),C.mount(this.calendarContainer,{onDateChange:this.callbacks.onDateChange}),w.mount(this.progressContainer),D.mount(this.habitsContainer,{onHabitComplete:this.callbacks.onHabitComplete,onHabitEdit:this.callbacks.onHabitEdit,onSectionToggle:this.callbacks.onSectionToggle}),T.mount(this.controlsContainer,{onHabitComplete:this.callbacks.onHabitComplete,onHabitEdit:this.callbacks.onHabitEdit})},render(){v.render(),C.render(),w.render(),D.render()},setupResponsiveBehavior(){this._adjustHabitsContainerHeight(),window.addEventListener("resize",()=>{this._adjustHabitsContainerHeight()})},_adjustHabitsContainerHeight(){if("undefined"==typeof window)return;const e=this.habitsContainer;if(!e)return;const t=e.getBoundingClientRect();let n=0;const o=this.container.closest(".content-area");if(o){const e=window.getComputedStyle(o);n=parseFloat(e.paddingBottom)||0}const s=window.innerHeight-t.top-n;s>0&&(e.style.maxHeight=s+"px",e.style.overflowY="auto")},unmount(){v.unmount(),C.unmount(),w.unmount(),D.unmount(),T.unmount(),this.container&&(this.container.innerHTML="")}};function F(n,i,a,l){if(!l.value||!i.value)return;const r=("touchend"===n.type?n.changedTouches[0].clientX:n.clientX)-i.value;if(Math.abs(r)>50){const n=r>0?-1:1,i=function(n,o){const s=["health","productivity","learning","social","finance","spiritual"],i=s.indexOf(n);let a=i;for(let l=1;l<=6;l++){a=(i+o*l+s.length)%s.length;const n=s[a];if(e().habits.some(e=>t(e,n)))return n}return n}(e().selectedGroup,n);i!==e().selectedGroup&&o(s.setSelectedGroup(i))}i.value=0,a.value=0,l.value=!1}function A(){const e=document.getElementById("group-pill");if(e){const t={value:0},n={value:0},o={value:!1},s=e=>function(e,t,n,o){t.value="touchstart"===e.type?e.touches[0].clientX:e.clientX,n.value="touchstart"===e.type?e.touches[0].clientY:e.clientY,o.value=!1}(e,t,n,o),i=e=>function(e,t,n,o){if(!t.value)return;const s="touchmove"===e.type?e.touches[0].clientX:e.clientX,i="touchmove"===e.type?e.touches[0].clientY:e.clientY,a=Math.abs(s-t.value),l=Math.abs(i-n.value);a>50&&a>2*l&&(o.value=!0,e.preventDefault())}(e,t,n,o),a=e=>F(e,t,n,o);e.addEventListener("touchstart",s,{passive:!1}),e.addEventListener("touchmove",i,{passive:!1}),e.addEventListener("touchend",a),e.addEventListener("mousedown",s),e.addEventListener("mousemove",i),e.addEventListener("mouseup",a),e.addEventListener("mouseleave",a)}}function j(e){localStorage.setItem("homeSectionVisibility",JSON.stringify(e))}function I(e=x){const t=document.querySelector('[data-action="toggle-completed"] span:last-child'),n=document.querySelector('[data-action="toggle-skipped"] span:last-child'),o='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke-width="2"/></svg>',s='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17.94 17.94A10.37 10.37 0 0 1 12 20c-7 0-11-8-11-8a19.77 19.77 0 0 1 5-5" stroke-width="2"/><path d="M1 1l22 22" stroke-width="2"/></svg>';if(t){const n=t.parentElement.querySelector("span:first-child");n&&(n.innerHTML=e.Completed?s:o),t.textContent=(e.Completed?"Hide":"Show")+" Completed"}if(n){const t=n.parentElement.querySelector("span:first-child");t&&(t.innerHTML=e.Skipped?s:o),n.textContent=(e.Skipped?"Hide":"Show")+" Skipped"}}const N={async init(){const e=document.getElementById("home-view");var t;e?(M.mount(e,{onHabitComplete:this._handleHabitComplete,onHabitEdit:this._handleHabitEdit,onGroupChange:this._handleGroupChange,onDateChange:this._handleDateChange,onHolidayToggle:this._handleHolidayToggle,onSectionToggle:this._handleSectionToggle}),A(),function(){const e=document.getElementById("menu-toggle"),t=document.getElementById("dropdown-menu");if(e&&t){t.classList.add("hidden");const o=async()=>{const e=t.querySelector('[data-action="add-habit"]');if(!e)return;const{getState:o}=await n(async()=>{const{getState:e}=await import("./chunk-D8P7fKnl.js").then(e=>e.k);return{getState:e}},__vite__mapDeps([1,2,3,0,4]));o().categories.length>0?(e.classList.remove("opacity-50","cursor-not-allowed","pointer-events-none"),e.title=""):(e.classList.add("opacity-50","cursor-not-allowed","pointer-events-none"),e.title="Create a category first before adding habits")};o(),n(()=>import("./chunk-D8P7fKnl.js").then(e=>e.k),__vite__mapDeps([1,2,3,0,4])).then(e=>{e.subscribe(()=>{o()})}),e.addEventListener("click",e=>{e.stopPropagation(),o(),t.classList.toggle("hidden")}),document.addEventListener("click",n=>{t.contains(n.target)||e.contains(n.target)||t.classList.add("hidden")}),t.addEventListener("click",async e=>{const o=e.target.closest(".dropdown-item");if(!o)return;const s=o.dataset.action;if(s&&!o.classList.contains("pointer-events-none"))switch(t.classList.add("hidden"),s){case"add-habit":n(()=>import("./chunk-jPjFmsdb.js").then(e=>e.H),__vite__mapDeps([5,1,2,3,0,4])).then(e=>e.openAddHabitModal());break;case"manage-holidays":n(()=>import("./manage-Cx5UEkQk.js"),__vite__mapDeps([6,1,2,3,0,4])).then(e=>e.openHolidayModal());break;case"toggle-completed":k(!x.Completed,x.Skipped),j(x),I(),D.render?.();break;case"toggle-skipped":k(x.Completed,!x.Skipped),j(x),I(),D.render?.()}})}}(),t=x,"undefined"!=typeof window&&(window.sectionVisibility=t),I(),c(()=>{this._handleStateChange()}),M.setupResponsiveBehavior(),this._handleStateChange()):console.error("Home view container not found")},_handleHabitComplete(){},_handleHabitEdit(){},_handleGroupChange(){},_handleDateChange(){},_handleHolidayToggle(){this._handleStateChange()},_handleSectionToggle(e,t){"completed"===e?x.Completed=!t:"skipped"===e&&(x.Skipped=!t),I()},_handleStateChange(){M.render()}};async function B(){await N.init(),"undefined"!=typeof window&&(window.HomeModule=N,window.HomeView=M)}export{N as HomeModule,B as init};
