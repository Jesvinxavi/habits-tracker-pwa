const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunk-1sPJXvOa.js","assets/chunk-D8P7fKnl.js","assets/chunk-97VqPUVn.js","assets/chunk-CM0JCX04.js","assets/chunk-Dwp9fxXX.js","assets/HomeModule-DBYwg2Sr.js","assets/chunk-jPjFmsdb.js","assets/stats-CBuCmbWe.js"])))=>i.map(i=>d[i]);
import{s as e,d as t,A as o,g as n,_ as s,b as a,i as r,a as i,c as l,e as c}from"./chunk-D8P7fKnl.js";import{s as d,g as u,o as m,p as h,q as f,r as g,e as w,j as p,t as y}from"./chunk-CM0JCX04.js";import{i as v}from"./chunk-jPjFmsdb.js";import{i as b}from"./chunk-97VqPUVn.js";import{f as S}from"./chunk-1sPJXvOa.js";import"./chunk-Dwp9fxXX.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),document.documentElement.classList.add("js-loading");const _=Object.freeze(Object.defineProperty({__proto__:null,removeLoadingState:function(){document.documentElement.classList.remove("js-loading")}},Symbol.toStringTag,{value:"Module"})),E="healthyHabitsData";function k(){try{if("undefined"==typeof localStorage)return!1;const e="__storage_test__";return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(e){return!1}}const D=(()=>{let e={};return{getItem:t=>e[t]??null,setItem:(t,o)=>{e[t]=o},removeItem:t=>{delete e[t]}}})(),L=k()?localStorage:D,M="state";let I=null;function j(){return I||(I=new Promise((e,t)=>{if(!("indexedDB"in window))return e(null);const o=indexedDB.open("healthyHabitsDB",1);o.onupgradeneeded=()=>{const e=o.result;e.objectStoreNames.contains(M)||e.createObjectStore(M)},o.onsuccess=()=>e(o.result),o.onerror=()=>e(null)}),I)}let O=!1;function H(){return new Promise(e=>{const n=L.getItem(E);if(n)try{const e=d(n,{});t(o.importData(e));const s=u(new Date);t(o.setSelectedDate(s)),t(o.setFitnessSelectedDate(s)),t(o.setSelectedGroup("daily"))}catch(s){console.error("[storage] Error parsing stored data:",s)}O=!0,async function(e){const t=await j();return t?new Promise(o=>{const n=t.transaction(M,"readonly").objectStore(M).get(e);n.onsuccess=()=>o(n.result||null),n.onerror=()=>o(null)}):null}("appData").then(n=>{if(n&&"object"==typeof n){t(o.importData(n));const e=u(new Date);t(o.setSelectedDate(e)),t(o.setFitnessSelectedDate(e)),t(o.setSelectedGroup("daily"))}e()}).catch(t=>{e()})})}function A(){try{const e=h(n(),"{}");L.setItem(E,e),async function(e,t){const o=await j();if(o)new Promise(n=>{const s=o.transaction(M,"readwrite");s.objectStore(M).put(t,e),s.oncomplete=()=>n(),s.onerror=()=>n()})}("appData",n())}catch(e){console.error("[storage] Error saving data to localStorage:",e)}}function T(){t(o.toggleDarkMode(!n().settings.darkMode)),x(),localStorage.setItem("theme",n().settings.darkMode?"dark":"light")}function x(){const e=n().settings.darkMode?"dark":"light";document.documentElement.setAttribute("data-theme",e);const t=document.getElementById("theme-toggle");if(t){const e=t.querySelector("svg");if(!e)return;n().settings.darkMode?e.innerHTML='<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" fill="none"/>':e.innerHTML='<circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>'}}function P(){const e=document.querySelectorAll(".tab-item"),n=document.querySelectorAll(".view"),a={"fitness-view":"fitness-view-placeholder","stats-view":"stats-view-placeholder"},r={home:{loaded:!1,loading:!1,error:null},habits:{loaded:!1,loading:!1,error:null},fitness:{loaded:!1,loading:!1,error:null},stats:{loaded:!1,loading:!1,error:null}},i=Object.assign({"../features/fitness/FitnessModule.js":()=>s(()=>import("./chunk-1sPJXvOa.js").then(e=>e.F),__vite__mapDeps([0,1,2,3,4])),"../features/habits/HabitsModule.js":()=>s(()=>import("./chunk-D8P7fKnl.js").then(e=>e.l),__vite__mapDeps([1,2,0,3,4])),"../features/home/HomeModule.js":()=>s(()=>import("./HomeModule-DBYwg2Sr.js"),__vite__mapDeps([5,1,2,0,3,4,6]))});async function l(e){if(r[e].loaded||r[e].loading)return;let t,o,n;r[e].loading=!0;const a="../features/home/HomeModule.js",l="../features/habits/HabitsModule.js",c="../features/fitness/FitnessModule.js";switch(e){case"home":t="home-view",o="home-loading",n="home-loading-spinner";try{const{HomeModule:e}=await i[a]();await e.init()}catch(u){console.error("Error loading home module:",u),r[e].error=u}break;case"habits":t="habits-view",o="habits-loading",n="habits-loading-spinner";try{const{HabitsModule:e}=await i[l]();await e.init()}catch(u){console.error("Error loading habits module:",u),r[e].error=u}break;case"fitness":t="fitness-view",o=null,n=null;try{const{FitnessModule:e}=await i[c]();await e.init()}catch(u){console.error("Error loading fitness module:",u),r[e].error=u}break;case"stats":t="stats-view",o=null,n=null;try{const e=await s(()=>import("./stats-CBuCmbWe.js"),__vite__mapDeps([7,1,2,0,3,4]));await e.initializeStats()}catch(u){console.error("Error loading stats module:",u),r[e].error=u}break;default:return}const d=document.getElementById(t);if(d&&o&&!d.querySelector(`#${o}`)&&n){const e=document.getElementById(n);if(e){const t=e.content.cloneNode(!0).firstElementChild;d.appendChild(t),setTimeout(()=>t.remove(),500)}}r[e].loaded=!0,r[e].loading=!1}async function c(r){!function(e){let t=document.getElementById(e);if(t||(t=document.createElement("div"),t.id=e,t.className="view w-full h-full flex flex-col overflow-hidden",document.querySelector("main.content-area")?.appendChild(t)),0===t.childElementCount&&a[e]){const o=document.getElementById(a[e]);o&&t.appendChild(o.content.cloneNode(!0))}}(r);if(requestAnimationFrame(()=>{n.forEach(e=>{e.id===r?(e.classList.add("active-view"),e.classList.remove("hidden"),e.classList.add("block")):(e.classList.remove("active-view"),e.classList.add("hidden"),e.classList.remove("block"),"fitness-view"===e.id&&e.classList.remove("search-expanded"))}),e.forEach(e=>{e.classList.toggle("active",e.dataset.view===r)})}),localStorage.setItem("activeHabitTrackerTab",r),"home-view"===r||"fitness-view"===r){const e=new Date;if(e.setHours(0,0,0,0),"home-view"===r){const t=document.querySelector('#home-view hh-calendar[state-key="selectedDate"]');t?.setDate?.(e,{smooth:!0}),window.HomeModule?.refresh?.()}else if("fitness-view"===r){const{getLocalMidnightISOString:n}=await s(async()=>{const{getLocalMidnightISOString:e}=await import("./chunk-CM0JCX04.js").then(e=>e.A);return{getLocalMidnightISOString:e}},__vite__mapDeps([3,1,2,0,4])),a=n(e);t(o.setFitnessSelectedDate(a)),document.querySelector('#fitness-view hh-calendar[state-key="fitnessSelectedDate"]')?.refresh?.()}}"home-view"===r?await l("home"):"habits-view"===r?await l("habits"):"fitness-view"===r?await l("fitness"):"stats-view"===r&&await l("stats")}function d(e){const t=`_${e}Prefetched`;window[t]||r[e]?.loaded||(window[t]=!0,i[{home:"../features/home/HomeModule.js",habits:"../features/habits/HabitsModule.js",fitness:"../features/fitness/FitnessModule.js",stats:"../features/stats/stats.js"}[e]]().catch(o=>{console.warn(`Failed to prefetch ${e} module:`,o),window[t]=!1}))}c(localStorage.getItem("activeHabitTrackerTab")||"home-view"),e.forEach(e=>{e.addEventListener("click",async t=>{const o=e.dataset.view;o?(t.preventDefault(),await c(o)):console.error("No view ID found in dataset!")})}),document.querySelectorAll(".tab-item[data-view]").forEach(e=>{const t=e.dataset.view.replace("-view","");t&&e.addEventListener("pointerenter",()=>d(t),{once:!0})}),window.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(d("home"),d("habits"),d("fitness"),d("stats"))}),"requestIdleCallback"in window&&requestIdleCallback(()=>{d("home"),d("habits")},{timeout:2e3})}e(m(()=>{O&&A()},250)),"undefined"!=typeof window&&k()&&window.addEventListener("storage",e=>{if(e.key===E&&e.newValue&&O)try{t(o.importData(JSON.parse(e.newValue)))}catch(n){}});let q={selectedDate:null,selectedGroup:null,habitsHash:null,holidayHash:null,result:null};function N(e,{start:t,end:o}){if("number"==typeof e.target&&e.target>0){let n=!1,s=0;for(const a of g(t,o)){const t=new Date(a);if(r(e,t)&&!i(e,t)&&(n=!0,l(e,t))){s=1;break}}return{completed:s,active:n?1:0}}let n=0,s=0;for(const a of g(t,o)){const t=new Date(a);if(r(e,t)&&!i(e,t)&&(s++,l(e,t)&&n++,s>0&&n===s))break}return{completed:n,active:s}}function C(){const e=new Date(n().selectedDate),t=JSON.stringify(n().habits.map(e=>({id:e.id,completed:e.completed,skipped:e.skipped}))),o=JSON.stringify(n().holidayDates);if(q.selectedDate===n().selectedDate&&q.selectedGroup===n().selectedGroup&&q.habitsHash===t&&q.holidayHash===o)return q.result;const s=n().habits.filter(t=>a(t,n().selectedGroup)&&r(t,e)).filter(t=>!i(t,e)),c=s.filter(t=>l(t,e)),d=s.length?c.length/s.length*100:0;return q={selectedDate:n().selectedDate,selectedGroup:n().selectedGroup,habitsHash:t,holidayHash:o,result:d},d}const B=["daily","weekly","monthly","yearly"];function V(){const e=document.querySelector("#home-view .progress-section");if(!e)return;let t=e.querySelector(".progress-pills");t||(t=document.createElement("div"),t.className="progress-pills absolute right-4 top-1/2 -translate-y-1/2 flex flex-col items-center gap-1",e.appendChild(t)),t.innerHTML="";const o=new Date;B.forEach(e=>{if(e===n().selectedGroup)return;const s=function(e,t=new Date){const o={daily:"day",weekly:"week",monthly:"month",yearly:"year"}[e];if(!o)throw new Error(`Unknown group: ${e}`);const s=f(o,t),r=n().habits.filter(t=>a(t,e));let i=0,l=0;for(const n of r){const{completed:e,active:t}=N(n,s);i+=e,l+=t}return{percentage:l>0?Math.round(i/l*100):0,completed:i,active:l}}(e,o);if(0===s.active)return;const r=document.createElement("span");r.setAttribute("data-group",e),r.className="progress-pill relative overflow-hidden py-1.5 rounded-full text-xs font-medium",r.textContent=`${w(e)} (${s.percentage}%)`;const i=c(s.percentage);r.style.background=`linear-gradient(to right, ${i} ${s.percentage}%, #e5e5e7 ${s.percentage}%)`,r.style.color="#000",r.style.border="1px solid #4B5563",r.style.width="110px",r.style.minWidth="110px",r.style.maxWidth="110px",r.style.whiteSpace="nowrap",r.style.textAlign="center",r.style.fontSize="11px",r.style.lineHeight="1.2",r.style.paddingLeft="0",r.style.paddingRight="0",t.appendChild(r)}),t.style.display=t.children.length?"flex":"none"}function R(){V()}async function F(){try{await H(),await function(){const e=localStorage.getItem("theme"),n="dark"===e;t(o.setDarkMode(n)),null===e&&localStorage.setItem("theme","light"),x()}(),await P(),await v(),await s(()=>import("./chunk-CM0JCX04.js").then(e=>e.B),__vite__mapDeps([3,1,2,0,4])).then(e=>e.initializeHolidays()),await S(),await s(()=>import("./stats-CBuCmbWe.js"),__vite__mapDeps([7,1,2,0,3,4])).then(e=>e.initializeStats()),await b();const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",T),s(async()=>{const{removeLoadingState:e}=await Promise.resolve().then(()=>_);return{removeLoadingState:e}},void 0).then(({removeLoadingState:e})=>e())}catch(e){console.error("Bootstrap failed:",e)}}!function e(){const a=n(),r=new Date,i=a.selectedGroup||"daily",l=new Date(a.selectedDate);p(r,l,i)||s(async()=>{const{getLocalMidnightISOString:e}=await import("./chunk-CM0JCX04.js").then(e=>e.A);return{getLocalMidnightISOString:e}},__vite__mapDeps([3,1,2,0,4])).then(({getLocalMidnightISOString:e})=>{t(o.setSelectedDate(e(r))),R()});const c=y(r,i).getTime()-r.getTime()+1e3;setTimeout(e,c)}(),"undefined"!=typeof window&&"true"===new URLSearchParams(window.location.search).get("test")&&(window.process=window.process||{},window.process.env=window.process.env||{},window.process.env.NODE_ENV="test"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",F):F();export{C as g,R as i,V as u};
